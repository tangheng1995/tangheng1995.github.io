I"`¾<ul id="markdown-toc">
  <li><a href="#ä»‹ç»" id="markdown-toc-ä»‹ç»">ä»‹ç»</a></li>
  <li><a href="#uber-go-è¯­è¨€ç¼–ç è§„èŒƒ" id="markdown-toc-uber-go-è¯­è¨€ç¼–ç è§„èŒƒ">Uber Go è¯­è¨€ç¼–ç è§„èŒƒ</a>    <ul>
      <li><a href="#uber-goguide-çš„ä¸­æ–‡ç¿»è¯‘" id="markdown-toc-uber-goguide-çš„ä¸­æ–‡ç¿»è¯‘">uber-go/guide çš„ä¸­æ–‡ç¿»è¯‘</a></li>
      <li><a href="#english" id="markdown-toc-english">English</a></li>
    </ul>
  </li>
  <li><a href="#uber-go-è¯­è¨€ç¼–ç è§„èŒƒ-1" id="markdown-toc-uber-go-è¯­è¨€ç¼–ç è§„èŒƒ-1">Uber Go è¯­è¨€ç¼–ç è§„èŒƒ</a>    <ul>
      <li><a href="#ç›®å½•" id="markdown-toc-ç›®å½•">ç›®å½•</a></li>
      <li><a href="#ä»‹ç»-1" id="markdown-toc-ä»‹ç»-1">ä»‹ç»</a></li>
      <li><a href="#æŒ‡å¯¼åŸåˆ™" id="markdown-toc-æŒ‡å¯¼åŸåˆ™">æŒ‡å¯¼åŸåˆ™</a>        <ul>
          <li><a href="#æŒ‡å‘-interface-çš„æŒ‡é’ˆ" id="markdown-toc-æŒ‡å‘-interface-çš„æŒ‡é’ˆ">æŒ‡å‘ interface çš„æŒ‡é’ˆ</a></li>
          <li><a href="#interface-åˆç†æ€§éªŒè¯" id="markdown-toc-interface-åˆç†æ€§éªŒè¯">Interface åˆç†æ€§éªŒè¯</a></li>
          <li><a href="#æ¥æ”¶å™¨-receiver-ä¸æ¥å£" id="markdown-toc-æ¥æ”¶å™¨-receiver-ä¸æ¥å£">æ¥æ”¶å™¨ (receiver) ä¸æ¥å£</a></li>
          <li><a href="#é›¶å€¼-mutex-æ˜¯æœ‰æ•ˆçš„" id="markdown-toc-é›¶å€¼-mutex-æ˜¯æœ‰æ•ˆçš„">é›¶å€¼ Mutex æ˜¯æœ‰æ•ˆçš„</a></li>
          <li><a href="#åœ¨è¾¹ç•Œå¤„æ‹·è´-slices-å’Œ-maps" id="markdown-toc-åœ¨è¾¹ç•Œå¤„æ‹·è´-slices-å’Œ-maps">åœ¨è¾¹ç•Œå¤„æ‹·è´ Slices å’Œ Maps</a>            <ul>
              <li><a href="#æ¥æ”¶-slices-å’Œ-maps" id="markdown-toc-æ¥æ”¶-slices-å’Œ-maps">æ¥æ”¶ Slices å’Œ Maps</a></li>
              <li><a href="#è¿”å›-slices-æˆ–-maps" id="markdown-toc-è¿”å›-slices-æˆ–-maps">è¿”å› slices æˆ– maps</a></li>
            </ul>
          </li>
          <li><a href="#ä½¿ç”¨-defer-é‡Šæ”¾èµ„æº" id="markdown-toc-ä½¿ç”¨-defer-é‡Šæ”¾èµ„æº">ä½¿ç”¨ defer é‡Šæ”¾èµ„æº</a></li>
          <li><a href="#channel-çš„-size-è¦ä¹ˆæ˜¯-1è¦ä¹ˆæ˜¯æ— ç¼“å†²çš„" id="markdown-toc-channel-çš„-size-è¦ä¹ˆæ˜¯-1è¦ä¹ˆæ˜¯æ— ç¼“å†²çš„">Channel çš„ size è¦ä¹ˆæ˜¯ 1ï¼Œè¦ä¹ˆæ˜¯æ— ç¼“å†²çš„</a></li>
          <li><a href="#æšä¸¾ä»-1-å¼€å§‹" id="markdown-toc-æšä¸¾ä»-1-å¼€å§‹">æšä¸¾ä» 1 å¼€å§‹</a></li>
          <li><a href="#ä½¿ç”¨-time-å¤„ç†æ—¶é—´" id="markdown-toc-ä½¿ç”¨-time-å¤„ç†æ—¶é—´">ä½¿ç”¨ time å¤„ç†æ—¶é—´</a>            <ul>
              <li><a href="#ä½¿ç”¨-timetime-è¡¨è¾¾ç¬æ—¶æ—¶é—´" id="markdown-toc-ä½¿ç”¨-timetime-è¡¨è¾¾ç¬æ—¶æ—¶é—´">ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">time.Time</code> è¡¨è¾¾ç¬æ—¶æ—¶é—´</a></li>
              <li><a href="#ä½¿ç”¨-timeduration-è¡¨è¾¾æ—¶é—´æ®µ" id="markdown-toc-ä½¿ç”¨-timeduration-è¡¨è¾¾æ—¶é—´æ®µ">ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">time.Duration</code> è¡¨è¾¾æ—¶é—´æ®µ</a></li>
              <li><a href="#å¯¹å¤–éƒ¨ç³»ç»Ÿä½¿ç”¨-timetime-å’Œ-timeduration" id="markdown-toc-å¯¹å¤–éƒ¨ç³»ç»Ÿä½¿ç”¨-timetime-å’Œ-timeduration">å¯¹å¤–éƒ¨ç³»ç»Ÿä½¿ç”¨ <code class="language-plaintext highlighter-rouge">time.Time</code> å’Œ <code class="language-plaintext highlighter-rouge">time.Duration</code></a></li>
            </ul>
          </li>
          <li><a href="#é”™è¯¯ç±»å‹" id="markdown-toc-é”™è¯¯ç±»å‹">é”™è¯¯ç±»å‹</a></li>
          <li><a href="#é”™è¯¯åŒ…è£…-error-wrapping" id="markdown-toc-é”™è¯¯åŒ…è£…-error-wrapping">é”™è¯¯åŒ…è£… (Error Wrapping)</a></li>
          <li><a href="#å¤„ç†ç±»å‹æ–­è¨€å¤±è´¥" id="markdown-toc-å¤„ç†ç±»å‹æ–­è¨€å¤±è´¥">å¤„ç†ç±»å‹æ–­è¨€å¤±è´¥</a></li>
          <li><a href="#ä¸è¦-panic" id="markdown-toc-ä¸è¦-panic">ä¸è¦ panic</a></li>
          <li><a href="#ä½¿ç”¨-gouberorgatomic" id="markdown-toc-ä½¿ç”¨-gouberorgatomic">ä½¿ç”¨ go.uber.org/atomic</a></li>
          <li><a href="#é¿å…å¯å˜å…¨å±€å˜é‡" id="markdown-toc-é¿å…å¯å˜å…¨å±€å˜é‡">é¿å…å¯å˜å…¨å±€å˜é‡</a></li>
          <li><a href="#é¿å…åœ¨å…¬å…±ç»“æ„ä¸­åµŒå…¥ç±»å‹" id="markdown-toc-é¿å…åœ¨å…¬å…±ç»“æ„ä¸­åµŒå…¥ç±»å‹">é¿å…åœ¨å…¬å…±ç»“æ„ä¸­åµŒå…¥ç±»å‹</a></li>
        </ul>
      </li>
      <li><a href="#æ€§èƒ½" id="markdown-toc-æ€§èƒ½">æ€§èƒ½</a>        <ul>
          <li><a href="#ä¼˜å…ˆä½¿ç”¨-strconv-è€Œä¸æ˜¯-fmt" id="markdown-toc-ä¼˜å…ˆä½¿ç”¨-strconv-è€Œä¸æ˜¯-fmt">ä¼˜å…ˆä½¿ç”¨ strconv è€Œä¸æ˜¯ fmt</a></li>
          <li><a href="#é¿å…å­—ç¬¦ä¸²åˆ°å­—èŠ‚çš„è½¬æ¢" id="markdown-toc-é¿å…å­—ç¬¦ä¸²åˆ°å­—èŠ‚çš„è½¬æ¢">é¿å…å­—ç¬¦ä¸²åˆ°å­—èŠ‚çš„è½¬æ¢</a></li>
          <li><a href="#å°½é‡åˆå§‹åŒ–æ—¶æŒ‡å®š-map-å®¹é‡" id="markdown-toc-å°½é‡åˆå§‹åŒ–æ—¶æŒ‡å®š-map-å®¹é‡">å°½é‡åˆå§‹åŒ–æ—¶æŒ‡å®š Map å®¹é‡</a></li>
        </ul>
      </li>
      <li><a href="#è§„èŒƒ" id="markdown-toc-è§„èŒƒ">è§„èŒƒ</a>        <ul>
          <li><a href="#ä¸€è‡´æ€§" id="markdown-toc-ä¸€è‡´æ€§">ä¸€è‡´æ€§</a></li>
          <li><a href="#ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€ç»„" id="markdown-toc-ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€ç»„">ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€ç»„</a></li>
          <li><a href="#import-åˆ†ç»„" id="markdown-toc-import-åˆ†ç»„">import åˆ†ç»„</a></li>
          <li><a href="#åŒ…å" id="markdown-toc-åŒ…å">åŒ…å</a></li>
          <li><a href="#å‡½æ•°å" id="markdown-toc-å‡½æ•°å">å‡½æ•°å</a></li>
          <li><a href="#å¯¼å…¥åˆ«å" id="markdown-toc-å¯¼å…¥åˆ«å">å¯¼å…¥åˆ«å</a></li>
          <li><a href="#å‡½æ•°åˆ†ç»„ä¸é¡ºåº" id="markdown-toc-å‡½æ•°åˆ†ç»„ä¸é¡ºåº">å‡½æ•°åˆ†ç»„ä¸é¡ºåº</a></li>
          <li><a href="#å‡å°‘åµŒå¥—" id="markdown-toc-å‡å°‘åµŒå¥—">å‡å°‘åµŒå¥—</a></li>
          <li><a href="#ä¸å¿…è¦çš„-else" id="markdown-toc-ä¸å¿…è¦çš„-else">ä¸å¿…è¦çš„ else</a></li>
          <li><a href="#é¡¶å±‚å˜é‡å£°æ˜" id="markdown-toc-é¡¶å±‚å˜é‡å£°æ˜">é¡¶å±‚å˜é‡å£°æ˜</a></li>
          <li><a href="#å¯¹äºæœªå¯¼å‡ºçš„é¡¶å±‚å¸¸é‡å’Œå˜é‡ä½¿ç”¨_ä½œä¸ºå‰ç¼€" id="markdown-toc-å¯¹äºæœªå¯¼å‡ºçš„é¡¶å±‚å¸¸é‡å’Œå˜é‡ä½¿ç”¨_ä½œä¸ºå‰ç¼€">å¯¹äºæœªå¯¼å‡ºçš„é¡¶å±‚å¸¸é‡å’Œå˜é‡ï¼Œä½¿ç”¨_ä½œä¸ºå‰ç¼€</a></li>
          <li><a href="#ç»“æ„ä½“ä¸­çš„åµŒå…¥" id="markdown-toc-ç»“æ„ä½“ä¸­çš„åµŒå…¥">ç»“æ„ä½“ä¸­çš„åµŒå…¥</a></li>
          <li><a href="#ä½¿ç”¨å­—æ®µååˆå§‹åŒ–ç»“æ„ä½“" id="markdown-toc-ä½¿ç”¨å­—æ®µååˆå§‹åŒ–ç»“æ„ä½“">ä½¿ç”¨å­—æ®µååˆå§‹åŒ–ç»“æ„ä½“</a></li>
          <li><a href="#æœ¬åœ°å˜é‡å£°æ˜" id="markdown-toc-æœ¬åœ°å˜é‡å£°æ˜">æœ¬åœ°å˜é‡å£°æ˜</a></li>
          <li><a href="#nil-æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„-slice" id="markdown-toc-nil-æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„-slice">nil æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ slice</a></li>
          <li><a href="#ç¼©å°å˜é‡ä½œç”¨åŸŸ" id="markdown-toc-ç¼©å°å˜é‡ä½œç”¨åŸŸ">ç¼©å°å˜é‡ä½œç”¨åŸŸ</a></li>
          <li><a href="#é¿å…å‚æ•°è¯­ä¹‰ä¸æ˜ç¡®avoid-naked-parameters" id="markdown-toc-é¿å…å‚æ•°è¯­ä¹‰ä¸æ˜ç¡®avoid-naked-parameters">é¿å…å‚æ•°è¯­ä¹‰ä¸æ˜ç¡®(Avoid Naked Parameters)</a></li>
          <li><a href="#ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼é¿å…è½¬ä¹‰" id="markdown-toc-ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼é¿å…è½¬ä¹‰">ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼ï¼Œé¿å…è½¬ä¹‰</a></li>
          <li><a href="#åˆå§‹åŒ–-struct-å¼•ç”¨" id="markdown-toc-åˆå§‹åŒ–-struct-å¼•ç”¨">åˆå§‹åŒ– Struct å¼•ç”¨</a></li>
          <li><a href="#åˆå§‹åŒ–-maps" id="markdown-toc-åˆå§‹åŒ–-maps">åˆå§‹åŒ– Maps</a></li>
          <li><a href="#å­—ç¬¦ä¸²-string-format" id="markdown-toc-å­—ç¬¦ä¸²-string-format">å­—ç¬¦ä¸² string format</a></li>
          <li><a href="#å‘½å-printf-æ ·å¼çš„å‡½æ•°" id="markdown-toc-å‘½å-printf-æ ·å¼çš„å‡½æ•°">å‘½å Printf æ ·å¼çš„å‡½æ•°</a></li>
        </ul>
      </li>
      <li><a href="#ç¼–ç¨‹æ¨¡å¼" id="markdown-toc-ç¼–ç¨‹æ¨¡å¼">ç¼–ç¨‹æ¨¡å¼</a>        <ul>
          <li><a href="#è¡¨é©±åŠ¨æµ‹è¯•" id="markdown-toc-è¡¨é©±åŠ¨æµ‹è¯•">è¡¨é©±åŠ¨æµ‹è¯•</a></li>
          <li><a href="#åŠŸèƒ½é€‰é¡¹" id="markdown-toc-åŠŸèƒ½é€‰é¡¹">åŠŸèƒ½é€‰é¡¹</a></li>
        </ul>
      </li>
      <li><a href="#stargazers-over-time" id="markdown-toc-stargazers-over-time">Stargazers over time</a>        <ul>
          <li><a href="#å¼•ç”¨" id="markdown-toc-å¼•ç”¨">å¼•ç”¨</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="ä»‹ç»">ä»‹ç»</h2>

<p>Uber æ˜¯ä¸€å®¶ç¾å›½ç¡…è°·çš„ç§‘æŠ€å…¬å¸ï¼Œä¹Ÿæ˜¯ Go è¯­è¨€çš„æ—©æœŸ adopterã€‚å…¶å¼€æºäº†å¾ˆå¤š golang é¡¹ç›®ï¼Œè¯¸å¦‚è¢« Gopher åœˆç†ŸçŸ¥çš„ zapã€jaeger ç­‰ã€‚2018 å¹´å¹´æœ« Uber å°†å†…éƒ¨çš„ Go é£æ ¼è§„èŒƒ å¼€æºåˆ° GitHubï¼Œç»è¿‡ä¸€å¹´çš„ç§¯ç´¯å’Œæ›´æ–°ï¼Œè¯¥è§„èŒƒå·²ç»åˆå…·è§„æ¨¡ï¼Œå¹¶å—åˆ°å¹¿å¤§ Gopher çš„å…³æ³¨ã€‚æœ¬æ–‡æ˜¯è¯¥è§„èŒƒçš„ä¸­æ–‡ç‰ˆæœ¬ã€‚æœ¬ç‰ˆæœ¬ä¼šæ ¹æ®åŸç‰ˆå®æ—¶æ›´æ–°ã€‚</p>

<h2 id="uber-go-è¯­è¨€ç¼–ç è§„èŒƒ">Uber Go è¯­è¨€ç¼–ç è§„èŒƒ</h2>

<h3 id="uber-goguide-çš„ä¸­æ–‡ç¿»è¯‘"><a href="https://github.com/uber-go/guide">uber-go/guide</a> çš„ä¸­æ–‡ç¿»è¯‘</h3>

<h3 id="english"><a href="https://github.com/uber-go/guide/blob/master/style.md">English</a></h3>

<h1 id="uber-go-è¯­è¨€ç¼–ç è§„èŒƒ-1">Uber Go è¯­è¨€ç¼–ç è§„èŒƒ</h1>

<p><a href="https://www.uber.com/">Uber</a> æ˜¯ä¸€å®¶ç¾å›½ç¡…è°·çš„ç§‘æŠ€å…¬å¸ï¼Œä¹Ÿæ˜¯ Go è¯­è¨€çš„æ—©æœŸ adopterã€‚å…¶å¼€æºäº†å¾ˆå¤š golang é¡¹ç›®ï¼Œè¯¸å¦‚è¢« Gopher åœˆç†ŸçŸ¥çš„ <a href="https://github.com/uber-go/zap">zap</a>ã€<a href="https://github.com/jaegertracing/jaeger">jaeger</a> ç­‰ã€‚2018 å¹´å¹´æœ« Uber å°†å†…éƒ¨çš„ <a href="https://github.com/uber-go/guide">Go é£æ ¼è§„èŒƒ</a> å¼€æºåˆ° GitHubï¼Œç»è¿‡ä¸€å¹´çš„ç§¯ç´¯å’Œæ›´æ–°ï¼Œè¯¥è§„èŒƒå·²ç»åˆå…·è§„æ¨¡ï¼Œå¹¶å—åˆ°å¹¿å¤§ Gopher çš„å…³æ³¨ã€‚æœ¬æ–‡æ˜¯è¯¥è§„èŒƒçš„ä¸­æ–‡ç‰ˆæœ¬ã€‚æœ¬ç‰ˆæœ¬ä¼šæ ¹æ®åŸç‰ˆå®æ—¶æ›´æ–°ã€‚</p>

<p>## ç‰ˆæœ¬</p>

<ul>
  <li>å½“å‰æ›´æ–°ç‰ˆæœ¬ï¼š2020-05-30 ç‰ˆæœ¬åœ°å€ï¼š<a href="https://github.com/uber-go/guide/commit/85179803b3f299b0ad762a8ff51e40ab7edd0112">commit:#91</a></li>
  <li>å¦‚æœæ‚¨å‘ç°ä»»ä½•æ›´æ–°ã€é—®é¢˜æˆ–æ”¹è¿›ï¼Œè¯·éšæ—¶ fork å’Œ PR</li>
  <li>Please feel free to fork and PR if you find any updates, issues or improvement.</li>
</ul>

<h2 id="ç›®å½•">ç›®å½•</h2>

<ul>
  <li><a href="#ä»‹ç»">ä»‹ç»</a></li>
  <li><a href="#æŒ‡å¯¼åŸåˆ™">æŒ‡å¯¼åŸåˆ™</a>
    <ul>
      <li><a href="#æŒ‡å‘-interface-çš„æŒ‡é’ˆ">æŒ‡å‘ interface çš„æŒ‡é’ˆ</a></li>
      <li><a href="#interface-åˆç†æ€§éªŒè¯">Interface åˆç†æ€§éªŒè¯</a></li>
      <li><a href="#æ¥æ”¶å™¨-receiver-ä¸æ¥å£">æ¥æ”¶å™¨ (receiver) ä¸æ¥å£</a></li>
      <li><a href="#é›¶å€¼-Mutex-æ˜¯æœ‰æ•ˆçš„">é›¶å€¼ Mutex æ˜¯æœ‰æ•ˆçš„</a></li>
      <li><a href="#åœ¨è¾¹ç•Œå¤„æ‹·è´-Slices-å’Œ-Maps">åœ¨è¾¹ç•Œå¤„æ‹·è´ Slices å’Œ Maps</a></li>
      <li><a href="#ä½¿ç”¨-defer-é‡Šæ”¾èµ„æº">ä½¿ç”¨ defer é‡Šæ”¾èµ„æº</a></li>
      <li><a href="#Channel-çš„-size-è¦ä¹ˆæ˜¯-1è¦ä¹ˆæ˜¯æ— ç¼“å†²çš„">Channel çš„ size è¦ä¹ˆæ˜¯ 1ï¼Œè¦ä¹ˆæ˜¯æ— ç¼“å†²çš„</a></li>
      <li><a href="#æšä¸¾ä»-1-å¼€å§‹">æšä¸¾ä» 1 å¼€å§‹</a></li>
      <li><a href="#ä½¿ç”¨-time-å¤„ç†æ—¶é—´">ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">"time"</code> å¤„ç†æ—¶é—´</a></li>
      <li><a href="#é”™è¯¯ç±»å‹">é”™è¯¯ç±»å‹</a></li>
      <li><a href="#é”™è¯¯åŒ…è£…-error-wrapping">é”™è¯¯åŒ…è£… (Error Wrapping)</a></li>
      <li><a href="#å¤„ç†ç±»å‹æ–­è¨€å¤±è´¥">å¤„ç†ç±»å‹æ–­è¨€å¤±è´¥</a></li>
      <li><a href="#ä¸è¦-panic">ä¸è¦ panic</a></li>
      <li><a href="#ä½¿ç”¨-gouberorgatomic">ä½¿ç”¨ go.uber.org/atomic</a></li>
      <li><a href="#é¿å…å¯å˜å…¨å±€å˜é‡">é¿å…å¯å˜å…¨å±€å˜é‡</a></li>
      <li><a href="#é¿å…åœ¨å…¬å…±ç»“æ„ä¸­åµŒå…¥ç±»å‹">é¿å…åœ¨å…¬å…±ç»“æ„ä¸­åµŒå…¥ç±»å‹</a></li>
    </ul>
  </li>
  <li><a href="#æ€§èƒ½">æ€§èƒ½</a>
    <ul>
      <li><a href="#ä¼˜å…ˆä½¿ç”¨-strconv-è€Œä¸æ˜¯-fmt">ä¼˜å…ˆä½¿ç”¨ strconv è€Œä¸æ˜¯ fmt</a></li>
      <li><a href="#é¿å…å­—ç¬¦ä¸²åˆ°å­—èŠ‚çš„è½¬æ¢">é¿å…å­—ç¬¦ä¸²åˆ°å­—èŠ‚çš„è½¬æ¢</a></li>
      <li><a href="#å°½é‡åˆå§‹åŒ–æ—¶æŒ‡å®š-Map-å®¹é‡">å°½é‡åˆå§‹åŒ–æ—¶æŒ‡å®š Map å®¹é‡</a></li>
    </ul>
  </li>
  <li><a href="#è§„èŒƒ">è§„èŒƒ</a>
    <ul>
      <li><a href="#ä¸€è‡´æ€§">ä¸€è‡´æ€§</a></li>
      <li><a href="#ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€ç»„">ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€ç»„</a></li>
      <li><a href="#import-åˆ†ç»„">import åˆ†ç»„</a></li>
      <li><a href="#åŒ…å">åŒ…å</a></li>
      <li><a href="#å‡½æ•°å">å‡½æ•°å</a></li>
      <li><a href="#å¯¼å…¥åˆ«å">å¯¼å…¥åˆ«å</a></li>
      <li><a href="#å‡½æ•°åˆ†ç»„ä¸é¡ºåº">å‡½æ•°åˆ†ç»„ä¸é¡ºåº</a></li>
      <li><a href="#å‡å°‘åµŒå¥—">å‡å°‘åµŒå¥—</a></li>
      <li><a href="#ä¸å¿…è¦çš„-else">ä¸å¿…è¦çš„ else</a></li>
      <li><a href="#é¡¶å±‚å˜é‡å£°æ˜">é¡¶å±‚å˜é‡å£°æ˜</a></li>
      <li><a href="#å¯¹äºæœªå¯¼å‡ºçš„é¡¶å±‚å¸¸é‡å’Œå˜é‡ä½¿ç”¨_ä½œä¸ºå‰ç¼€">å¯¹äºæœªå¯¼å‡ºçš„é¡¶å±‚å¸¸é‡å’Œå˜é‡ï¼Œä½¿ç”¨_ä½œä¸ºå‰ç¼€</a></li>
      <li><a href="#ç»“æ„ä½“ä¸­çš„åµŒå…¥">ç»“æ„ä½“ä¸­çš„åµŒå…¥</a></li>
      <li><a href="#ä½¿ç”¨å­—æ®µååˆå§‹åŒ–ç»“æ„ä½“">ä½¿ç”¨å­—æ®µååˆå§‹åŒ–ç»“æ„ä½“</a></li>
      <li><a href="#æœ¬åœ°å˜é‡å£°æ˜">æœ¬åœ°å˜é‡å£°æ˜</a></li>
      <li><a href="#nil-æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„-slice">nil æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ slice</a></li>
      <li><a href="#ç¼©å°å˜é‡ä½œç”¨åŸŸ">ç¼©å°å˜é‡ä½œç”¨åŸŸ</a></li>
      <li><a href="#é¿å…å‚æ•°è¯­ä¹‰ä¸æ˜ç¡®Avoid-Naked-Parameters">é¿å…å‚æ•°è¯­ä¹‰ä¸æ˜ç¡®ï¼ˆAvoid Naked Parametersï¼‰</a></li>
      <li><a href="#ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼é¿å…è½¬ä¹‰">ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼ï¼Œé¿å…è½¬ä¹‰</a></li>
      <li><a href="#åˆå§‹åŒ–-Struct-å¼•ç”¨">åˆå§‹åŒ– Struct å¼•ç”¨</a></li>
      <li><a href="#åˆå§‹åŒ–-maps">åˆå§‹åŒ– Maps</a></li>
      <li><a href="#å­—ç¬¦ä¸²-string-format">å­—ç¬¦ä¸² string format </a></li>
      <li><a href="#å‘½å-Printf-æ ·å¼çš„å‡½æ•°">å‘½å Printf æ ·å¼çš„å‡½æ•°</a></li>
    </ul>
  </li>
  <li><a href="#ç¼–ç¨‹æ¨¡å¼">ç¼–ç¨‹æ¨¡å¼</a>
    <ul>
      <li><a href="#è¡¨é©±åŠ¨æµ‹è¯•">è¡¨é©±åŠ¨æµ‹è¯•</a></li>
      <li><a href="#åŠŸèƒ½é€‰é¡¹">åŠŸèƒ½é€‰é¡¹</a></li>
    </ul>
  </li>
</ul>

<h2 id="ä»‹ç»-1">ä»‹ç»</h2>

<p>æ ·å¼ (style) æ˜¯æ”¯é…æˆ‘ä»¬ä»£ç çš„æƒ¯ä¾‹ã€‚æœ¯è¯­<code class="language-plaintext highlighter-rouge">æ ·å¼</code>æœ‰ç‚¹ç”¨è¯ä¸å½“ï¼Œå› ä¸ºè¿™äº›çº¦å®šæ¶µç›–çš„èŒƒå›´ä¸é™äºç”± gofmt æ›¿æˆ‘ä»¬å¤„ç†çš„æºæ–‡ä»¶æ ¼å¼ã€‚</p>

<p>æœ¬æŒ‡å—çš„ç›®çš„æ˜¯é€šè¿‡è¯¦ç»†æè¿°åœ¨ Uber ç¼–å†™ Go ä»£ç çš„æ³¨æ„äº‹é¡¹æ¥ç®¡ç†è¿™ç§å¤æ‚æ€§ã€‚è¿™äº›è§„åˆ™çš„å­˜åœ¨æ˜¯ä¸ºäº†ä½¿ä»£ç åº“æ˜“äºç®¡ç†ï¼ŒåŒæ—¶ä»ç„¶å…è®¸å·¥ç¨‹å¸ˆæ›´æœ‰æ•ˆåœ°ä½¿ç”¨ Go è¯­è¨€åŠŸèƒ½ã€‚</p>

<p>è¯¥æŒ‡å—æœ€åˆç”± <a href="https://github.com/prashantv">Prashant Varanasi</a> å’Œ <a href="https://github.com/nomis52">Simon Newton</a> ç¼–å†™ï¼Œç›®çš„æ˜¯ä½¿ä¸€äº›åŒäº‹èƒ½å¿«é€Ÿä½¿ç”¨ Goã€‚å¤šå¹´æ¥ï¼Œè¯¥æŒ‡å—å·²æ ¹æ®å…¶ä»–äººçš„åé¦ˆè¿›è¡Œäº†ä¿®æ”¹ã€‚</p>

<p>æœ¬æ–‡æ¡£è®°å½•äº†æˆ‘ä»¬åœ¨ Uber éµå¾ªçš„ Go ä»£ç ä¸­çš„æƒ¯ç”¨çº¦å®šã€‚å…¶ä¸­è®¸å¤šæ˜¯ Go çš„é€šç”¨å‡†åˆ™ï¼Œè€Œå…¶ä»–æ‰©å±•å‡†åˆ™ä¾èµ–äºä¸‹é¢å¤–éƒ¨çš„æŒ‡å—ï¼š</p>

<ol>
  <li><a href="https://golang.org/doc/effective_go.html">Effective Go</a></li>
  <li><a href="https://github.com/golang/go/wiki/CodeReviewComments">The Go common mistakes guide</a></li>
</ol>

<p>æ‰€æœ‰ä»£ç éƒ½åº”è¯¥é€šè¿‡<code class="language-plaintext highlighter-rouge">golint</code>å’Œ<code class="language-plaintext highlighter-rouge">go vet</code>çš„æ£€æŸ¥å¹¶æ— é”™è¯¯ã€‚æˆ‘ä»¬å»ºè®®æ‚¨å°†ç¼–è¾‘å™¨è®¾ç½®ä¸ºï¼š</p>

<ul>
  <li>ä¿å­˜æ—¶è¿è¡Œ <code class="language-plaintext highlighter-rouge">goimports</code></li>
  <li>è¿è¡Œ <code class="language-plaintext highlighter-rouge">golint</code> å’Œ <code class="language-plaintext highlighter-rouge">go vet</code> æ£€æŸ¥é”™è¯¯</li>
</ul>

<p>æ‚¨å¯ä»¥åœ¨ä»¥ä¸‹ Go ç¼–è¾‘å™¨å·¥å…·æ”¯æŒé¡µé¢ä¸­æ‰¾åˆ°æ›´ä¸ºè¯¦ç»†çš„ä¿¡æ¯ï¼š
<a href="https://github.com/golang/go/wiki/IDEsAndTextEditorPlugins">https://github.com/golang/go/wiki/IDEsAndTextEditorPlugins</a></p>

<h2 id="æŒ‡å¯¼åŸåˆ™">æŒ‡å¯¼åŸåˆ™</h2>

<h3 id="æŒ‡å‘-interface-çš„æŒ‡é’ˆ">æŒ‡å‘ interface çš„æŒ‡é’ˆ</h3>

<p>æ‚¨å‡ ä¹ä¸éœ€è¦æŒ‡å‘æ¥å£ç±»å‹çš„æŒ‡é’ˆã€‚æ‚¨åº”è¯¥å°†æ¥å£ä½œä¸ºå€¼è¿›è¡Œä¼ é€’ï¼Œåœ¨è¿™æ ·çš„ä¼ é€’è¿‡ç¨‹ä¸­ï¼Œå®è´¨ä¸Šä¼ é€’çš„åº•å±‚æ•°æ®ä»ç„¶å¯ä»¥æ˜¯æŒ‡é’ˆã€‚</p>

<p>æ¥å£å®è´¨ä¸Šåœ¨åº•å±‚ç”¨ä¸¤ä¸ªå­—æ®µè¡¨ç¤ºï¼š</p>

<ol>
  <li>ä¸€ä¸ªæŒ‡å‘æŸäº›ç‰¹å®šç±»å‹ä¿¡æ¯çš„æŒ‡é’ˆã€‚æ‚¨å¯ä»¥å°†å…¶è§†ä¸ºâ€typeâ€ã€‚</li>
  <li>æ•°æ®æŒ‡é’ˆã€‚å¦‚æœå­˜å‚¨çš„æ•°æ®æ˜¯æŒ‡é’ˆï¼Œåˆ™ç›´æ¥å­˜å‚¨ã€‚å¦‚æœå­˜å‚¨çš„æ•°æ®æ˜¯ä¸€ä¸ªå€¼ï¼Œåˆ™å­˜å‚¨æŒ‡å‘è¯¥å€¼çš„æŒ‡é’ˆã€‚</li>
</ol>

<p>å¦‚æœå¸Œæœ›æ¥å£æ–¹æ³•ä¿®æ”¹åŸºç¡€æ•°æ®ï¼Œåˆ™å¿…é¡»ä½¿ç”¨æŒ‡é’ˆä¼ é€’ã€‚</p>

<h3 id="interface-åˆç†æ€§éªŒè¯">Interface åˆç†æ€§éªŒè¯</h3>

<p>åœ¨ç¼–è¯‘æ—¶éªŒè¯æ¥å£çš„ç¬¦åˆæ€§ã€‚è¿™åŒ…æ‹¬ï¼š</p>

<ul>
  <li>å°†å®ç°ç‰¹å®šæ¥å£æ‰€éœ€çš„å¯¼å‡ºç±»å‹ä½œä¸ºå…¶ API çš„ä¸€éƒ¨åˆ†</li>
  <li>å¯¼å‡ºæˆ–æœªå¯¼å‡ºçš„ç±»å‹æ˜¯å®ç°åŒä¸€æ¥å£çš„ç±»å‹é›†åˆçš„ä¸€éƒ¨åˆ†</li>
  <li>å…¶ä»–è¿åæ¥å£çš„æƒ…å†µä¼šç ´åç”¨æˆ·ã€‚</li>
</ul>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Handler</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="c">// ...</span>
<span class="p">}</span>
<span class="k">func</span> <span class="p">(</span><span class="n">h</span> <span class="o">*</span><span class="n">Handler</span><span class="p">)</span> <span class="n">ServeHTTP</span><span class="p">(</span>
  <span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span>
  <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">,</span>
<span class="p">)</span> <span class="p">{</span>
  <span class="o">...</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Handler</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="c">// ...</span>
<span class="p">}</span>
<span class="k">var</span> <span class="n">_</span> <span class="n">http</span><span class="o">.</span><span class="n">Handler</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">Handler</span><span class="p">)(</span><span class="no">nil</span><span class="p">)</span>
<span class="k">func</span> <span class="p">(</span><span class="n">h</span> <span class="o">*</span><span class="n">Handler</span><span class="p">)</span> <span class="n">ServeHTTP</span><span class="p">(</span>
  <span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span>
  <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">,</span>
<span class="p">)</span> <span class="p">{</span>
  <span class="c">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å¦‚æœ <code class="language-plaintext highlighter-rouge">*Handler</code> æ°¸è¿œä¸ä¼šä¸ <code class="language-plaintext highlighter-rouge">http.Handler</code> æ¥å£åŒ¹é…,é‚£ä¹ˆè¯­å¥ <code class="language-plaintext highlighter-rouge">var _ http.Handler = (*Handler)(nil)</code> å°†æ— æ³•ç¼–è¯‘</p>

<p>èµ‹å€¼çš„å³è¾¹åº”è¯¥æ˜¯æ–­è¨€ç±»å‹çš„é›¶å€¼ã€‚å¯¹äºæŒ‡é’ˆç±»å‹ï¼ˆå¦‚ <code class="language-plaintext highlighter-rouge">*Handler</code>ï¼‰ã€åˆ‡ç‰‡å’Œæ˜ å°„ï¼Œè¿™æ˜¯ <code class="language-plaintext highlighter-rouge">nil</code>ï¼›å¯¹äºç»“æ„ç±»å‹ï¼Œè¿™æ˜¯ç©ºç»“æ„ã€‚</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">LogHandler</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">h</span>   <span class="n">http</span><span class="o">.</span><span class="n">Handler</span>
  <span class="n">log</span> <span class="o">*</span><span class="n">zap</span><span class="o">.</span><span class="n">Logger</span>
<span class="p">}</span>
<span class="k">var</span> <span class="n">_</span> <span class="n">http</span><span class="o">.</span><span class="n">Handler</span> <span class="o">=</span> <span class="n">LogHandler</span><span class="p">{}</span>
<span class="k">func</span> <span class="p">(</span><span class="n">h</span> <span class="n">LogHandler</span><span class="p">)</span> <span class="n">ServeHTTP</span><span class="p">(</span>
  <span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span>
  <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">,</span>
<span class="p">)</span> <span class="p">{</span>
  <span class="c">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="æ¥æ”¶å™¨-receiver-ä¸æ¥å£">æ¥æ”¶å™¨ (receiver) ä¸æ¥å£</h3>

<p>ä½¿ç”¨å€¼æ¥æ”¶å™¨çš„æ–¹æ³•æ—¢å¯ä»¥é€šè¿‡å€¼è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŒ‡é’ˆè°ƒç”¨ã€‚</p>

<p>ä¾‹å¦‚ï¼Œ</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">S</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">data</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="n">S</span><span class="p">)</span> <span class="n">Read</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">data</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span><span class="n">S</span><span class="p">)</span> <span class="n">Write</span><span class="p">(</span><span class="n">str</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">s</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">str</span>
<span class="p">}</span>

<span class="n">sVals</span> <span class="o">:=</span> <span class="k">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="n">S</span><span class="p">{</span><span class="m">1</span><span class="o">:</span> <span class="p">{</span><span class="s">"A"</span><span class="p">}}</span>

<span class="c">// ä½ åªèƒ½é€šè¿‡å€¼è°ƒç”¨ Read</span>
<span class="n">sVals</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">.</span><span class="n">Read</span><span class="p">()</span>

<span class="c">// è¿™ä¸èƒ½ç¼–è¯‘é€šè¿‡ï¼š</span>
<span class="c">//  sVals[1].Write("test")</span>

<span class="n">sPtrs</span> <span class="o">:=</span> <span class="k">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="o">*</span><span class="n">S</span><span class="p">{</span><span class="m">1</span><span class="o">:</span> <span class="p">{</span><span class="s">"A"</span><span class="p">}}</span>

<span class="c">// é€šè¿‡æŒ‡é’ˆæ—¢å¯ä»¥è°ƒç”¨ Readï¼Œä¹Ÿå¯ä»¥è°ƒç”¨ Write æ–¹æ³•</span>
<span class="n">sPtrs</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">.</span><span class="n">Read</span><span class="p">()</span>
<span class="n">sPtrs</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="s">"test"</span><span class="p">)</span>
</code></pre></div></div>

<p>åŒæ ·ï¼Œå³ä½¿è¯¥æ–¹æ³•å…·æœ‰å€¼æ¥æ”¶å™¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŒ‡é’ˆæ¥æ»¡è¶³æ¥å£ã€‚</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">F</span> <span class="k">interface</span> <span class="p">{</span>
  <span class="n">f</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">S1</span> <span class="k">struct</span><span class="p">{}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="n">S1</span><span class="p">)</span> <span class="n">f</span><span class="p">()</span> <span class="p">{}</span>

<span class="k">type</span> <span class="n">S2</span> <span class="k">struct</span><span class="p">{}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span><span class="n">S2</span><span class="p">)</span> <span class="n">f</span><span class="p">()</span> <span class="p">{}</span>

<span class="n">s1Val</span> <span class="o">:=</span> <span class="n">S1</span><span class="p">{}</span>
<span class="n">s1Ptr</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">S1</span><span class="p">{}</span>
<span class="n">s2Val</span> <span class="o">:=</span> <span class="n">S2</span><span class="p">{}</span>
<span class="n">s2Ptr</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">S2</span><span class="p">{}</span>

<span class="k">var</span> <span class="n">i</span> <span class="n">F</span>
<span class="n">i</span> <span class="o">=</span> <span class="n">s1Val</span>
<span class="n">i</span> <span class="o">=</span> <span class="n">s1Ptr</span>
<span class="n">i</span> <span class="o">=</span> <span class="n">s2Ptr</span>

<span class="c">//  ä¸‹é¢ä»£ç æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚å› ä¸º s2Val æ˜¯ä¸€ä¸ªå€¼ï¼Œè€Œ S2 çš„ f æ–¹æ³•ä¸­æ²¡æœ‰ä½¿ç”¨å€¼æ¥æ”¶å™¨</span>
<span class="c">//   i = s2Val</span>
</code></pre></div></div>

<p><a href="https://golang.org/doc/effective_go.html">Effective Go</a> ä¸­æœ‰ä¸€æ®µå…³äº <a href="https://golang.org/doc/effective_go.html#pointers_vs_values">pointers vs. values</a> çš„ç²¾å½©è®²è§£ã€‚</p>

<h3 id="é›¶å€¼-mutex-æ˜¯æœ‰æ•ˆçš„">é›¶å€¼ Mutex æ˜¯æœ‰æ•ˆçš„</h3>

<p>é›¶å€¼ <code class="language-plaintext highlighter-rouge">sync.Mutex</code> å’Œ <code class="language-plaintext highlighter-rouge">sync.RWMutex</code> æ˜¯æœ‰æ•ˆçš„ã€‚æ‰€ä»¥æŒ‡å‘ mutex çš„æŒ‡é’ˆåŸºæœ¬æ˜¯ä¸å¿…è¦çš„ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mu</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="n">sync</span><span class="o">.</span><span class="n">Mutex</span><span class="p">)</span>
<span class="n">mu</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="n">mu</span> <span class="n">sync</span><span class="o">.</span><span class="n">Mutex</span>
<span class="n">mu</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</code></pre></div></div>

<p>å¦‚æœä½ ä½¿ç”¨ç»“æ„ä½“æŒ‡é’ˆï¼Œmutex å¯ä»¥éæŒ‡é’ˆå½¢å¼ä½œä¸ºç»“æ„ä½“çš„ç»„æˆå­—æ®µï¼Œæˆ–è€…æ›´å¥½çš„æ–¹å¼æ˜¯ç›´æ¥åµŒå…¥åˆ°ç»“æ„ä½“ä¸­ã€‚
å¦‚æœæ˜¯ç§æœ‰ç»“æ„ä½“ç±»å‹æˆ–æ˜¯è¦å®ç° Mutex æ¥å£çš„ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åµŒå…¥ mutex çš„æ–¹æ³•ï¼š</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">smap</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">sync</span><span class="o">.</span><span class="n">Mutex</span> <span class="c">// only for unexported typesï¼ˆä»…é€‚ç”¨äºéå¯¼å‡ºç±»å‹ï¼‰</span>

  <span class="n">data</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">newSMap</span><span class="p">()</span> <span class="o">*</span><span class="n">smap</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">&amp;</span><span class="n">smap</span><span class="p">{</span>
    <span class="n">data</span><span class="o">:</span> <span class="nb">make</span><span class="p">(</span><span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">),</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span><span class="n">smap</span><span class="p">)</span> <span class="n">Get</span><span class="p">(</span><span class="n">k</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="n">m</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
  <span class="k">defer</span> <span class="n">m</span><span class="o">.</span><span class="n">Unlock</span><span class="p">()</span>

  <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>
<p>ä¸ºç§æœ‰ç±»å‹æˆ–éœ€è¦å®ç°äº’æ–¥æ¥å£çš„ç±»å‹åµŒå…¥ã€‚</p>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">SMap</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">mu</span> <span class="n">sync</span><span class="o">.</span><span class="n">Mutex</span> <span class="c">// å¯¹äºå¯¼å‡ºç±»å‹ï¼Œè¯·ä½¿ç”¨ç§æœ‰é”</span>

  <span class="n">data</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">NewSMap</span><span class="p">()</span> <span class="o">*</span><span class="n">SMap</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">&amp;</span><span class="n">SMap</span><span class="p">{</span>
    <span class="n">data</span><span class="o">:</span> <span class="nb">make</span><span class="p">(</span><span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">),</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span><span class="n">SMap</span><span class="p">)</span> <span class="n">Get</span><span class="p">(</span><span class="n">k</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="n">m</span><span class="o">.</span><span class="n">mu</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
  <span class="k">defer</span> <span class="n">m</span><span class="o">.</span><span class="n">mu</span><span class="o">.</span><span class="n">Unlock</span><span class="p">()</span>

  <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>
<p>å¯¹äºå¯¼å‡ºçš„ç±»å‹ï¼Œè¯·ä½¿ç”¨ä¸“ç”¨å­—æ®µã€‚</p>

<h3 id="åœ¨è¾¹ç•Œå¤„æ‹·è´-slices-å’Œ-maps">åœ¨è¾¹ç•Œå¤„æ‹·è´ Slices å’Œ Maps</h3>

<p>slices å’Œ maps åŒ…å«äº†æŒ‡å‘åº•å±‚æ•°æ®çš„æŒ‡é’ˆï¼Œå› æ­¤åœ¨éœ€è¦å¤åˆ¶å®ƒä»¬æ—¶è¦ç‰¹åˆ«æ³¨æ„ã€‚</p>

<h4 id="æ¥æ”¶-slices-å’Œ-maps">æ¥æ”¶ Slices å’Œ Maps</h4>

<p>è¯·è®°ä½ï¼Œå½“ map æˆ– slice ä½œä¸ºå‡½æ•°å‚æ•°ä¼ å…¥æ—¶ï¼Œå¦‚æœæ‚¨å­˜å‚¨äº†å¯¹å®ƒä»¬çš„å¼•ç”¨ï¼Œåˆ™ç”¨æˆ·å¯ä»¥å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="p">(</span><span class="n">d</span> <span class="o">*</span><span class="n">Driver</span><span class="p">)</span> <span class="n">SetTrips</span><span class="p">(</span><span class="n">trips</span> <span class="p">[]</span><span class="n">Trip</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">d</span><span class="o">.</span><span class="n">trips</span> <span class="o">=</span> <span class="n">trips</span>
<span class="p">}</span>

<span class="n">trips</span> <span class="o">:=</span> <span class="o">...</span>
<span class="n">d1</span><span class="o">.</span><span class="n">SetTrips</span><span class="p">(</span><span class="n">trips</span><span class="p">)</span>

<span class="c">// ä½ æ˜¯è¦ä¿®æ”¹ d1.trips å—ï¼Ÿ</span>
<span class="n">trips</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="p">(</span><span class="n">d</span> <span class="o">*</span><span class="n">Driver</span><span class="p">)</span> <span class="n">SetTrips</span><span class="p">(</span><span class="n">trips</span> <span class="p">[]</span><span class="n">Trip</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">d</span><span class="o">.</span><span class="n">trips</span> <span class="o">=</span> <span class="nb">make</span><span class="p">([]</span><span class="n">Trip</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">trips</span><span class="p">))</span>
  <span class="nb">copy</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">trips</span><span class="p">,</span> <span class="n">trips</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">trips</span> <span class="o">:=</span> <span class="o">...</span>
<span class="n">d1</span><span class="o">.</span><span class="n">SetTrips</span><span class="p">(</span><span class="n">trips</span><span class="p">)</span>

<span class="c">// è¿™é‡Œæˆ‘ä»¬ä¿®æ”¹ trips[0]ï¼Œä½†ä¸ä¼šå½±å“åˆ° d1.trips</span>
<span class="n">trips</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span>
</code></pre></div></div>

<h4 id="è¿”å›-slices-æˆ–-maps">è¿”å› slices æˆ– maps</h4>

<p>åŒæ ·ï¼Œè¯·æ³¨æ„ç”¨æˆ·å¯¹æš´éœ²å†…éƒ¨çŠ¶æ€çš„ map æˆ– slice çš„ä¿®æ”¹ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Stats</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">mu</span> <span class="n">sync</span><span class="o">.</span><span class="n">Mutex</span>

  <span class="n">counters</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span>
<span class="p">}</span>

<span class="c">// Snapshot è¿”å›å½“å‰çŠ¶æ€ã€‚</span>
<span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span><span class="n">Stats</span><span class="p">)</span> <span class="n">Snapshot</span><span class="p">()</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span> <span class="p">{</span>
  <span class="n">s</span><span class="o">.</span><span class="n">mu</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
  <span class="k">defer</span> <span class="n">s</span><span class="o">.</span><span class="n">mu</span><span class="o">.</span><span class="n">Unlock</span><span class="p">()</span>

  <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">counters</span>
<span class="p">}</span>

<span class="c">// snapshot ä¸å†å—äº’æ–¥é”ä¿æŠ¤</span>
<span class="c">// å› æ­¤å¯¹ snapshot çš„ä»»ä½•è®¿é—®éƒ½å°†å—åˆ°æ•°æ®ç«äº‰çš„å½±å“</span>
<span class="c">// å½±å“ stats.counters</span>
<span class="n">snapshot</span> <span class="o">:=</span> <span class="n">stats</span><span class="o">.</span><span class="n">Snapshot</span><span class="p">()</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Stats</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">mu</span> <span class="n">sync</span><span class="o">.</span><span class="n">Mutex</span>

  <span class="n">counters</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span><span class="n">Stats</span><span class="p">)</span> <span class="n">Snapshot</span><span class="p">()</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span> <span class="p">{</span>
  <span class="n">s</span><span class="o">.</span><span class="n">mu</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
  <span class="k">defer</span> <span class="n">s</span><span class="o">.</span><span class="n">mu</span><span class="o">.</span><span class="n">Unlock</span><span class="p">()</span>

  <span class="n">result</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">int</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">counters</span><span class="p">))</span>
  <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">s</span><span class="o">.</span><span class="n">counters</span> <span class="p">{</span>
    <span class="n">result</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">result</span>
<span class="p">}</span>

<span class="c">// snapshot ç°åœ¨æ˜¯ä¸€ä¸ªæ‹·è´</span>
<span class="n">snapshot</span> <span class="o">:=</span> <span class="n">stats</span><span class="o">.</span><span class="n">Snapshot</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="ä½¿ç”¨-defer-é‡Šæ”¾èµ„æº">ä½¿ç”¨ defer é‡Šæ”¾èµ„æº</h3>

<p>ä½¿ç”¨ defer é‡Šæ”¾èµ„æºï¼Œè¯¸å¦‚æ–‡ä»¶å’Œé”ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">p</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
<span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">count</span> <span class="o">&lt;</span> <span class="m">10</span> <span class="p">{</span>
  <span class="n">p</span><span class="o">.</span><span class="n">Unlock</span><span class="p">()</span>
  <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">count</span>
<span class="p">}</span>

<span class="n">p</span><span class="o">.</span><span class="n">count</span><span class="o">++</span>
<span class="n">newCount</span> <span class="o">:=</span> <span class="n">p</span><span class="o">.</span><span class="n">count</span>
<span class="n">p</span><span class="o">.</span><span class="n">Unlock</span><span class="p">()</span>

<span class="k">return</span> <span class="n">newCount</span>

<span class="c">// å½“æœ‰å¤šä¸ª return åˆ†æ”¯æ—¶ï¼Œå¾ˆå®¹æ˜“é—å¿˜ unlock</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">p</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
<span class="k">defer</span> <span class="n">p</span><span class="o">.</span><span class="n">Unlock</span><span class="p">()</span>

<span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">count</span> <span class="o">&lt;</span> <span class="m">10</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">count</span>
<span class="p">}</span>

<span class="n">p</span><span class="o">.</span><span class="n">count</span><span class="o">++</span>
<span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">count</span>

<span class="c">// æ›´å¯è¯»</span>
</code></pre></div></div>

<p>Defer çš„å¼€é”€éå¸¸å°ï¼Œåªæœ‰åœ¨æ‚¨å¯ä»¥è¯æ˜å‡½æ•°æ‰§è¡Œæ—¶é—´å¤„äºçº³ç§’çº§çš„ç¨‹åº¦æ—¶ï¼Œæ‰åº”é¿å…è¿™æ ·åšã€‚ä½¿ç”¨ defer æå‡å¯è¯»æ€§æ˜¯å€¼å¾—çš„ï¼Œå› ä¸ºä½¿ç”¨å®ƒä»¬çš„æˆæœ¬å¾®ä¸è¶³é“ã€‚å°¤å…¶é€‚ç”¨äºé‚£äº›ä¸ä»…ä»…æ˜¯ç®€å•å†…å­˜è®¿é—®çš„è¾ƒå¤§çš„æ–¹æ³•ï¼Œåœ¨è¿™äº›æ–¹æ³•ä¸­å…¶ä»–è®¡ç®—çš„èµ„æºæ¶ˆè€—è¿œè¶…è¿‡ <code class="language-plaintext highlighter-rouge">defer</code>ã€‚</p>

<h3 id="channel-çš„-size-è¦ä¹ˆæ˜¯-1è¦ä¹ˆæ˜¯æ— ç¼“å†²çš„">Channel çš„ size è¦ä¹ˆæ˜¯ 1ï¼Œè¦ä¹ˆæ˜¯æ— ç¼“å†²çš„</h3>

<p>channel é€šå¸¸ size åº”ä¸º 1 æˆ–æ˜¯æ— ç¼“å†²çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œchannel æ˜¯æ— ç¼“å†²çš„ï¼Œå…¶ size ä¸ºé›¶ã€‚ä»»ä½•å…¶ä»–å°ºå¯¸éƒ½å¿…é¡»ç»è¿‡ä¸¥æ ¼çš„å®¡æŸ¥ã€‚æˆ‘ä»¬éœ€è¦è€ƒè™‘å¦‚ä½•ç¡®å®šå¤§å°ï¼Œè€ƒè™‘æ˜¯ä»€ä¹ˆé˜»æ­¢äº† channel åœ¨é«˜è´Ÿè½½ä¸‹å’Œé˜»å¡å†™æ—¶çš„å†™å…¥ï¼Œä»¥åŠå½“è¿™ç§æƒ…å†µå‘ç”Ÿæ—¶ç³»ç»Ÿé€»è¾‘æœ‰å“ªäº›å˜åŒ–ã€‚(ç¿»è¯‘è§£é‡Šï¼šæŒ‰ç…§åŸæ–‡æ„æ€æ˜¯éœ€è¦ç•Œå®šé€šé“è¾¹ç•Œï¼Œç«æ€æ¡ä»¶ï¼Œä»¥åŠé€»è¾‘ä¸Šä¸‹æ–‡æ¢³ç†)</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// åº”è¯¥è¶³ä»¥æ»¡è¶³ä»»ä½•æƒ…å†µï¼</span>
<span class="n">c</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">int</span><span class="p">,</span> <span class="m">64</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// å¤§å°ï¼š1</span>
<span class="n">c</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">int</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span> <span class="c">// æˆ–è€…</span>
<span class="c">// æ— ç¼“å†² channelï¼Œå¤§å°ä¸º 0</span>
<span class="n">c</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">chan</span> <span class="kt">int</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="æšä¸¾ä»-1-å¼€å§‹">æšä¸¾ä» 1 å¼€å§‹</h3>

<p>åœ¨ Go ä¸­å¼•å…¥æšä¸¾çš„æ ‡å‡†æ–¹æ³•æ˜¯å£°æ˜ä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹å’Œä¸€ä¸ªä½¿ç”¨äº† iota çš„ const ç»„ã€‚ç”±äºå˜é‡çš„é»˜è®¤å€¼ä¸º 0ï¼Œå› æ­¤é€šå¸¸åº”ä»¥éé›¶å€¼å¼€å¤´æšä¸¾ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Operation</span> <span class="kt">int</span>

<span class="k">const</span> <span class="p">(</span>
  <span class="n">Add</span> <span class="n">Operation</span> <span class="o">=</span> <span class="no">iota</span>
  <span class="n">Subtract</span>
  <span class="n">Multiply</span>
<span class="p">)</span>

<span class="c">// Add=0, Subtract=1, Multiply=2</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Operation</span> <span class="kt">int</span>

<span class="k">const</span> <span class="p">(</span>
  <span class="n">Add</span> <span class="n">Operation</span> <span class="o">=</span> <span class="no">iota</span> <span class="o">+</span> <span class="m">1</span>
  <span class="n">Subtract</span>
  <span class="n">Multiply</span>
<span class="p">)</span>

<span class="c">// Add=1, Subtract=2, Multiply=3</span>
</code></pre></div></div>

<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½¿ç”¨é›¶å€¼æ˜¯æœ‰æ„ä¹‰çš„ï¼ˆæšä¸¾ä»é›¶å¼€å§‹ï¼‰ï¼Œä¾‹å¦‚ï¼Œå½“é›¶å€¼æ˜¯ç†æƒ³çš„é»˜è®¤è¡Œä¸ºæ—¶ã€‚</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">LogOutput</span> <span class="kt">int</span>

<span class="k">const</span> <span class="p">(</span>
  <span class="n">LogToStdout</span> <span class="n">LogOutput</span> <span class="o">=</span> <span class="no">iota</span>
  <span class="n">LogToFile</span>
  <span class="n">LogToRemote</span>
<span class="p">)</span>

<span class="c">// LogToStdout=0, LogToFile=1, LogToRemote=2</span>
</code></pre></div></div>

<h3 id="ä½¿ç”¨-time-å¤„ç†æ—¶é—´">ä½¿ç”¨ time å¤„ç†æ—¶é—´</h3>

<p>æ—¶é—´å¤„ç†å¾ˆå¤æ‚ã€‚å…³äºæ—¶é—´çš„é”™è¯¯å‡è®¾é€šå¸¸åŒ…æ‹¬ä»¥ä¸‹å‡ ç‚¹ã€‚</p>

<ol>
  <li>ä¸€å¤©æœ‰ 24 å°æ—¶</li>
  <li>ä¸€å°æ—¶æœ‰ 60 åˆ†é’Ÿ</li>
  <li>ä¸€å‘¨æœ‰ä¸ƒå¤©</li>
  <li>ä¸€å¹´ 365 å¤©</li>
  <li><a href="https://infiniteundo.com/post/25326999628/falsehoods-programmers-believe-about-time">è¿˜æœ‰æ›´å¤š</a></li>
</ol>

<p>ä¾‹å¦‚ï¼Œ<em>1</em> è¡¨ç¤ºåœ¨ä¸€ä¸ªæ—¶é—´ç‚¹ä¸ŠåŠ ä¸Š 24 å°æ—¶å¹¶ä¸æ€»æ˜¯äº§ç”Ÿä¸€ä¸ªæ–°çš„æ—¥å†æ—¥ã€‚</p>

<p>å› æ­¤ï¼Œåœ¨å¤„ç†æ—¶é—´æ—¶å§‹ç»ˆä½¿ç”¨ <a href="https://golang.org/pkg/time/"><code class="language-plaintext highlighter-rouge">"time"</code></a> åŒ…ï¼Œå› ä¸ºå®ƒæœ‰åŠ©äºä»¥æ›´å®‰å…¨ã€æ›´å‡†ç¡®çš„æ–¹å¼å¤„ç†è¿™äº›ä¸æ­£ç¡®çš„å‡è®¾ã€‚</p>

<h4 id="ä½¿ç”¨-timetime-è¡¨è¾¾ç¬æ—¶æ—¶é—´">ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">time.Time</code> è¡¨è¾¾ç¬æ—¶æ—¶é—´</h4>

<p>åœ¨å¤„ç†æ—¶é—´çš„ç¬é—´æ—¶ä½¿ç”¨ <a href="https://golang.org/pkg/time/#Time"><code class="language-plaintext highlighter-rouge">time.time</code></a>ï¼Œåœ¨æ¯”è¾ƒã€æ·»åŠ æˆ–å‡å»æ—¶é—´æ—¶ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">time.Time</code> ä¸­çš„æ–¹æ³•ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">isActive</span><span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">start</span> <span class="o">&lt;=</span> <span class="n">now</span> <span class="o">&amp;&amp;</span> <span class="n">now</span> <span class="o">&lt;</span> <span class="n">stop</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">isActive</span><span class="p">(</span><span class="n">now</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="n">time</span><span class="o">.</span><span class="n">Time</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="n">start</span><span class="o">.</span><span class="n">Before</span><span class="p">(</span><span class="n">now</span><span class="p">)</span> <span class="o">||</span> <span class="n">start</span><span class="o">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">now</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="n">now</span><span class="o">.</span><span class="n">Before</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="ä½¿ç”¨-timeduration-è¡¨è¾¾æ—¶é—´æ®µ">ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">time.Duration</code> è¡¨è¾¾æ—¶é—´æ®µ</h4>

<p>åœ¨å¤„ç†æ—¶é—´æ®µæ—¶ä½¿ç”¨ <a href="https://golang.org/pkg/time/#Duration"><code class="language-plaintext highlighter-rouge">time.Duration</code></a> .</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">poll</span><span class="p">(</span><span class="n">delay</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">{</span>
    <span class="c">// ...</span>
    <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Millisecond</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">poll</span><span class="p">(</span><span class="m">10</span><span class="p">)</span> <span class="c">// æ˜¯å‡ ç§’é’Ÿè¿˜æ˜¯å‡ æ¯«ç§’?</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">poll</span><span class="p">(</span><span class="n">delay</span> <span class="n">time</span><span class="o">.</span><span class="n">Duration</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">{</span>
    <span class="c">// ...</span>
    <span class="n">time</span><span class="o">.</span><span class="n">Sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="n">poll</span><span class="p">(</span><span class="m">10</span><span class="o">*</span><span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">)</span>
</code></pre></div></div>

<p>å›åˆ°ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œåœ¨ä¸€ä¸ªæ—¶é—´ç¬é—´åŠ ä¸Š 24 å°æ—¶ï¼Œæˆ‘ä»¬ç”¨äºæ·»åŠ æ—¶é—´çš„æ–¹æ³•å–å†³äºæ„å›¾ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦ä¸‹ä¸€ä¸ªæ—¥å†æ—¥(å½“å‰å¤©çš„ä¸‹ä¸€å¤©)çš„åŒä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ <a href="https://golang.org/pkg/time/#Time.AddDate"><code class="language-plaintext highlighter-rouge">Time.AddDate</code></a>ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä¿è¯æŸä¸€æ—¶åˆ»æ¯”å‰ä¸€æ—¶åˆ»æ™š 24 å°æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ <a href="https://golang.org/pkg/time/#Time.Add"><code class="language-plaintext highlighter-rouge">Time.Add</code></a>ã€‚</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">newDay</span> <span class="o">:=</span> <span class="n">t</span><span class="o">.</span><span class="n">AddDate</span><span class="p">(</span><span class="m">0</span> <span class="c">/* years */</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="c">/* months */</span><span class="p">,</span> <span class="m">1</span> <span class="c">/* days */</span><span class="p">)</span>
<span class="n">maybeNewDay</span> <span class="o">:=</span> <span class="n">t</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="m">24</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Hour</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="å¯¹å¤–éƒ¨ç³»ç»Ÿä½¿ç”¨-timetime-å’Œ-timeduration">å¯¹å¤–éƒ¨ç³»ç»Ÿä½¿ç”¨ <code class="language-plaintext highlighter-rouge">time.Time</code> å’Œ <code class="language-plaintext highlighter-rouge">time.Duration</code></h4>

<p>å°½å¯èƒ½åœ¨ä¸å¤–éƒ¨ç³»ç»Ÿçš„äº¤äº’ä¸­ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">time.Duration</code> å’Œ <code class="language-plaintext highlighter-rouge">time.Time</code> ä¾‹å¦‚ :</p>

<ul>
  <li>Command-line æ ‡å¿—: <a href="https://golang.org/pkg/flag/"><code class="language-plaintext highlighter-rouge">flag</code></a> é€šè¿‡ <a href="https://golang.org/pkg/time/#ParseDuration"><code class="language-plaintext highlighter-rouge">time.ParseDuration</code></a> æ”¯æŒ <code class="language-plaintext highlighter-rouge">time.Duration</code></li>
  <li>JSON: <a href="https://golang.org/pkg/encoding/json/"><code class="language-plaintext highlighter-rouge">encoding/json</code></a> é€šè¿‡å…¶ <a href="https://golang.org/pkg/time/#Time.UnmarshalJSON"><code class="language-plaintext highlighter-rouge">UnmarshalJSON</code> method</a> æ–¹æ³•æ”¯æŒå°† <code class="language-plaintext highlighter-rouge">time.Time</code> ç¼–ç ä¸º <a href="https://tools.ietf.org/html/rfc3339">RFC 3339</a> å­—ç¬¦ä¸²</li>
  <li>SQL: <a href="https://golang.org/pkg/database/sql/"><code class="language-plaintext highlighter-rouge">database/sql</code></a> æ”¯æŒå°† <code class="language-plaintext highlighter-rouge">DATETIME</code> æˆ– <code class="language-plaintext highlighter-rouge">TIMESTAMP</code> åˆ—è½¬æ¢ä¸º <code class="language-plaintext highlighter-rouge">time.Time</code>ï¼Œå¦‚æœåº•å±‚é©±åŠ¨ç¨‹åºæ”¯æŒåˆ™è¿”å›</li>
  <li>
    <p>YAML: <a href="https://godoc.org/gopkg.in/yaml.v2"><code class="language-plaintext highlighter-rouge">gopkg.in/yaml.v2</code></a> æ”¯æŒå°† <code class="language-plaintext highlighter-rouge">time.Time</code> ä½œä¸º <a href="https://tools.ietf.org/html/rfc3339">RFC 3339</a> å­—ç¬¦ä¸²ï¼Œå¹¶é€šè¿‡ <a href="https://golang.org/pkg/time/#ParseDuration"><code class="language-plaintext highlighter-rouge">time.ParseDuration</code></a> æ”¯æŒ <code class="language-plaintext highlighter-rouge">time.Duration</code>ã€‚</p>

  </li>
</ul>

<p>å½“ä¸èƒ½åœ¨è¿™äº›äº¤äº’ä¸­ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">time.Duration</code> æ—¶ï¼Œè¯·ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">int</code> æˆ– <code class="language-plaintext highlighter-rouge">float64</code>ï¼Œå¹¶åœ¨å­—æ®µåç§°ä¸­åŒ…å«å•ä½ã€‚</p>

<p>ä¾‹å¦‚ï¼Œç”±äº <code class="language-plaintext highlighter-rouge">encoding/json</code> ä¸æ”¯æŒ <code class="language-plaintext highlighter-rouge">time.Duration</code>ï¼Œå› æ­¤è¯¥å•ä½åŒ…å«åœ¨å­—æ®µçš„åç§°ä¸­ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// {"interval": 2}</span>
<span class="k">type</span> <span class="n">Config</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">Interval</span> <span class="kt">int</span> <span class="s">`json:"interval"`</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// {"intervalMillis": 2000}</span>
<span class="k">type</span> <span class="n">Config</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">IntervalMillis</span> <span class="kt">int</span> <span class="s">`json:"intervalMillis"`</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å½“åœ¨è¿™äº›äº¤äº’ä¸­ä¸èƒ½ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">time.Time</code> æ—¶ï¼Œé™¤éè¾¾æˆä¸€è‡´ï¼Œå¦åˆ™ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">string</code> å’Œ <a href="https://tools.ietf.org/html/rfc3339">RFC 3339</a> ä¸­å®šä¹‰çš„æ ¼å¼æ—¶é—´æˆ³ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<a href="https://golang.org/pkg/time/#Time.UnmarshalText"><code class="language-plaintext highlighter-rouge">Time.UnmarshalText</code></a> ä½¿ç”¨æ­¤æ ¼å¼ï¼Œå¹¶å¯é€šè¿‡ <a href="https://golang.org/pkg/time/#RFC3339"><code class="language-plaintext highlighter-rouge">time.RFC3339</code></a> åœ¨ <code class="language-plaintext highlighter-rouge">Time.Format</code> å’Œ <code class="language-plaintext highlighter-rouge">time.Parse</code> ä¸­ä½¿ç”¨ã€‚</p>

<p>å°½ç®¡è¿™åœ¨å®è·µä¸­å¹¶ä¸æˆé—®é¢˜ï¼Œä½†è¯·è®°ä½ï¼Œ<code class="language-plaintext highlighter-rouge">"time"</code> åŒ…ä¸æ”¯æŒè§£æé—°ç§’æ—¶é—´æˆ³ï¼ˆ<a href="https://github.com/golang/go/issues/8728">8728</a>ï¼‰ï¼Œä¹Ÿä¸åœ¨è®¡ç®—ä¸­è€ƒè™‘é—°ç§’ï¼ˆ<a href="https://github.com/golang/go/issues/15190">15190</a>ï¼‰ã€‚å¦‚æœæ‚¨æ¯”è¾ƒä¸¤ä¸ªæ—¶é—´ç¬é—´ï¼Œåˆ™å·®å¼‚å°†ä¸åŒ…æ‹¬è¿™ä¸¤ä¸ªç¬é—´ä¹‹é—´å¯èƒ½å‘ç”Ÿçš„é—°ç§’ã€‚</p>

<!-- TODO: section on String methods for enums -->

<h3 id="é”™è¯¯ç±»å‹">é”™è¯¯ç±»å‹</h3>

<p>Go ä¸­æœ‰å¤šç§å£°æ˜é”™è¯¯ï¼ˆError) çš„é€‰é¡¹ï¼š</p>

<ul>
  <li><a href="https://golang.org/pkg/errors/#New"><code class="language-plaintext highlighter-rouge">errors.New</code></a> å¯¹äºç®€å•é™æ€å­—ç¬¦ä¸²çš„é”™è¯¯</li>
  <li><a href="https://golang.org/pkg/fmt/#Errorf"><code class="language-plaintext highlighter-rouge">fmt.Errorf</code></a> ç”¨äºæ ¼å¼åŒ–çš„é”™è¯¯å­—ç¬¦ä¸²</li>
  <li>å®ç° <code class="language-plaintext highlighter-rouge">Error()</code> æ–¹æ³•çš„è‡ªå®šä¹‰ç±»å‹</li>
  <li>ç”¨ <a href="https://godoc.org/github.com/pkg/errors#Wrap"><code class="language-plaintext highlighter-rouge">"pkg/errors".Wrap</code></a> çš„ Wrapped errors</li>
</ul>

<p>è¿”å›é”™è¯¯æ—¶ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹å› ç´ ä»¥ç¡®å®šæœ€ä½³é€‰æ‹©ï¼š</p>

<ul>
  <li>è¿™æ˜¯ä¸€ä¸ªä¸éœ€è¦é¢å¤–ä¿¡æ¯çš„ç®€å•é”™è¯¯å—ï¼Ÿå¦‚æœæ˜¯è¿™æ ·ï¼Œ<a href="https://golang.org/pkg/errors/#New"><code class="language-plaintext highlighter-rouge">errors.New</code></a> è¶³å¤Ÿäº†ã€‚</li>
  <li>å®¢æˆ·éœ€è¦æ£€æµ‹å¹¶å¤„ç†æ­¤é”™è¯¯å—ï¼Ÿå¦‚æœæ˜¯è¿™æ ·ï¼Œåˆ™åº”ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹å¹¶å®ç°è¯¥ <code class="language-plaintext highlighter-rouge">Error()</code> æ–¹æ³•ã€‚</li>
  <li>æ‚¨æ˜¯å¦æ­£åœ¨ä¼ æ’­ä¸‹æ¸¸å‡½æ•°è¿”å›çš„é”™è¯¯ï¼Ÿå¦‚æœæ˜¯è¿™æ ·ï¼Œè¯·æŸ¥çœ‹æœ¬æ–‡åé¢æœ‰å…³é”™è¯¯åŒ…è£… <a href="#é”™è¯¯åŒ…è£… (Error-Wrapping)">section on error wrapping</a> éƒ¨åˆ†çš„å†…å®¹ã€‚</li>
  <li>
    <p>å¦åˆ™ <a href="https://golang.org/pkg/fmt/#Errorf"><code class="language-plaintext highlighter-rouge">fmt.Errorf</code></a> å°±å¯ä»¥äº†ã€‚</p>

  </li>
</ul>

<p>å¦‚æœå®¢æˆ·ç«¯éœ€è¦æ£€æµ‹é”™è¯¯ï¼Œå¹¶ä¸”æ‚¨å·²ä½¿ç”¨åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„é”™è¯¯ <a href="https://golang.org/pkg/errors/#New"><code class="language-plaintext highlighter-rouge">errors.New</code></a>ï¼Œè¯·ä½¿ç”¨ä¸€ä¸ªé”™è¯¯å˜é‡ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// package foo</span>

<span class="k">func</span> <span class="n">Open</span><span class="p">()</span> <span class="kt">error</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s">"could not open"</span><span class="p">)</span>
<span class="p">}</span>

<span class="c">// package bar</span>

<span class="k">func</span> <span class="n">use</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">foo</span><span class="o">.</span><span class="n">Open</span><span class="p">();</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">err</span><span class="o">.</span><span class="n">Error</span><span class="p">()</span> <span class="o">==</span> <span class="s">"could not open"</span> <span class="p">{</span>
      <span class="c">// handle</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nb">panic</span><span class="p">(</span><span class="s">"unknown error"</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// package foo</span>

<span class="k">var</span> <span class="n">ErrCouldNotOpen</span> <span class="o">=</span> <span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s">"could not open"</span><span class="p">)</span>

<span class="k">func</span> <span class="n">Open</span><span class="p">()</span> <span class="kt">error</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">ErrCouldNotOpen</span>
<span class="p">}</span>

<span class="c">// package bar</span>

<span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">foo</span><span class="o">.</span><span class="n">Open</span><span class="p">();</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
  <span class="k">if</span> <span class="n">err</span> <span class="o">==</span> <span class="n">foo</span><span class="o">.</span><span class="n">ErrCouldNotOpen</span> <span class="p">{</span>
    <span class="c">// handle</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">panic</span><span class="p">(</span><span class="s">"unknown error"</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å¦‚æœæ‚¨æœ‰å¯èƒ½éœ€è¦å®¢æˆ·ç«¯æ£€æµ‹çš„é”™è¯¯ï¼Œå¹¶ä¸”æƒ³å‘å…¶ä¸­æ·»åŠ æ›´å¤šä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼Œå®ƒä¸æ˜¯é™æ€å­—ç¬¦ä¸²ï¼‰ï¼Œåˆ™åº”ä½¿ç”¨è‡ªå®šä¹‰ç±»å‹ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">open</span><span class="p">(</span><span class="n">file</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span><span class="s">"file %q not found"</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">use</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">open</span><span class="p">(</span><span class="s">"testfile.txt"</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">strings</span><span class="o">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">err</span><span class="o">.</span><span class="n">Error</span><span class="p">(),</span> <span class="s">"not found"</span><span class="p">)</span> <span class="p">{</span>
      <span class="c">// handle</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nb">panic</span><span class="p">(</span><span class="s">"unknown error"</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">errNotFound</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">file</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">e</span> <span class="n">errNotFound</span><span class="p">)</span> <span class="n">Error</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"file %q not found"</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">open</span><span class="p">(</span><span class="n">file</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">errNotFound</span><span class="p">{</span><span class="n">file</span><span class="o">:</span> <span class="n">file</span><span class="p">}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">use</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">open</span><span class="p">(</span><span class="s">"testfile.txt"</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">_</span><span class="p">,</span> <span class="n">ok</span> <span class="o">:=</span> <span class="n">err</span><span class="o">.</span><span class="p">(</span><span class="n">errNotFound</span><span class="p">);</span> <span class="n">ok</span> <span class="p">{</span>
      <span class="c">// handle</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nb">panic</span><span class="p">(</span><span class="s">"unknown error"</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ç›´æ¥å¯¼å‡ºè‡ªå®šä¹‰é”™è¯¯ç±»å‹æ—¶è¦å°å¿ƒï¼Œå› ä¸ºå®ƒä»¬å·²æˆä¸ºç¨‹åºåŒ…å…¬å…± API çš„ä¸€éƒ¨åˆ†ã€‚æœ€å¥½å…¬å¼€åŒ¹é…å™¨åŠŸèƒ½ä»¥æ£€æŸ¥é”™è¯¯ã€‚</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// package foo</span>

<span class="k">type</span> <span class="n">errNotFound</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">file</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">e</span> <span class="n">errNotFound</span><span class="p">)</span> <span class="n">Error</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"file %q not found"</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">file</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">IsNotFoundError</span><span class="p">(</span><span class="n">err</span> <span class="kt">error</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
  <span class="n">_</span><span class="p">,</span> <span class="n">ok</span> <span class="o">:=</span> <span class="n">err</span><span class="o">.</span><span class="p">(</span><span class="n">errNotFound</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">ok</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">Open</span><span class="p">(</span><span class="n">file</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">errNotFound</span><span class="p">{</span><span class="n">file</span><span class="o">:</span> <span class="n">file</span><span class="p">}</span>
<span class="p">}</span>

<span class="c">// package bar</span>

<span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">foo</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s">"foo"</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
  <span class="k">if</span> <span class="n">foo</span><span class="o">.</span><span class="n">IsNotFoundError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="c">// handle</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">panic</span><span class="p">(</span><span class="s">"unknown error"</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<!-- TODO: Exposing the information to callers with accessor functions. -->

<h3 id="é”™è¯¯åŒ…è£…-error-wrapping">é”™è¯¯åŒ…è£… (Error Wrapping)</h3>

<p>ä¸€ä¸ªï¼ˆå‡½æ•°/æ–¹æ³•ï¼‰è°ƒç”¨å¤±è´¥æ—¶ï¼Œæœ‰ä¸‰ç§ä¸»è¦çš„é”™è¯¯ä¼ æ’­æ–¹å¼ï¼š</p>

<ul>
  <li>å¦‚æœæ²¡æœ‰è¦æ·»åŠ çš„å…¶ä»–ä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸”æ‚¨æƒ³è¦ç»´æŠ¤åŸå§‹é”™è¯¯ç±»å‹ï¼Œåˆ™è¿”å›åŸå§‹é”™è¯¯ã€‚</li>
  <li>æ·»åŠ ä¸Šä¸‹æ–‡ï¼Œä½¿ç”¨ <a href="https://godoc.org/github.com/pkg/errors#Wrap"><code class="language-plaintext highlighter-rouge">"pkg/errors".Wrap</code></a> ä»¥ä¾¿é”™è¯¯æ¶ˆæ¯æä¾›æ›´å¤šä¸Šä¸‹æ–‡ ,<a href="https://godoc.org/github.com/pkg/errors#Cause"><code class="language-plaintext highlighter-rouge">"pkg/errors".Cause</code></a> å¯ç”¨äºæå–åŸå§‹é”™è¯¯ã€‚</li>
  <li>å¦‚æœè°ƒç”¨è€…ä¸éœ€è¦æ£€æµ‹æˆ–å¤„ç†çš„ç‰¹å®šé”™è¯¯æƒ…å†µï¼Œä½¿ç”¨ <a href="https://golang.org/pkg/fmt/#Errorf"><code class="language-plaintext highlighter-rouge">fmt.Errorf</code></a>ã€‚</li>
</ul>

<p>å»ºè®®åœ¨å¯èƒ½çš„åœ°æ–¹æ·»åŠ ä¸Šä¸‹æ–‡ï¼Œä»¥ä½¿æ‚¨è·å¾—è¯¸å¦‚â€œè°ƒç”¨æœåŠ¡ fooï¼šè¿æ¥è¢«æ‹’ç»â€ä¹‹ç±»çš„æ›´æœ‰ç”¨çš„é”™è¯¯ï¼Œè€Œä¸æ˜¯è¯¸å¦‚â€œè¿æ¥è¢«æ‹’ç»â€ä¹‹ç±»çš„æ¨¡ç³Šé”™è¯¯ã€‚</p>

<p>åœ¨å°†ä¸Šä¸‹æ–‡æ·»åŠ åˆ°è¿”å›çš„é”™è¯¯æ—¶ï¼Œè¯·é¿å…ä½¿ç”¨â€œfailed toâ€ä¹‹ç±»çš„çŸ­è¯­ä»¥ä¿æŒä¸Šä¸‹æ–‡ç®€æ´ï¼Œè¿™äº›çŸ­è¯­ä¼šé™ˆè¿°æ˜æ˜¾çš„å†…å®¹ï¼Œå¹¶éšç€é”™è¯¯åœ¨å †æ ˆä¸­çš„æ¸—é€è€Œé€æ¸å †ç§¯ï¼š</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">store</span><span class="o">.</span><span class="n">New</span><span class="p">()</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span>
        <span class="s">"failed to create new store: %s"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>
<p>failed to x: failed to y: failed to create new store: the error</p>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">store</span><span class="o">.</span><span class="n">New</span><span class="p">()</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Errorf</span><span class="p">(</span>
        <span class="s">"new store: %s"</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>
<p>x: y: new store: the error</p>

<p>ä½†æ˜¯ï¼Œä¸€æ—¦å°†é”™è¯¯å‘é€åˆ°å¦ä¸€ä¸ªç³»ç»Ÿï¼Œå°±åº”è¯¥æ˜ç¡®æ¶ˆæ¯æ˜¯é”™è¯¯æ¶ˆæ¯ï¼ˆä¾‹å¦‚ä½¿ç”¨<code class="language-plaintext highlighter-rouge">err</code>æ ‡è®°ï¼Œæˆ–åœ¨æ—¥å¿—ä¸­ä»¥â€Failedâ€ä¸ºå‰ç¼€ï¼‰ã€‚</p>

<p>å¦è¯·å‚è§ <a href="https://dave.cheney.net/2016/04/27/dont-just-check-errors-handle-them-gracefully">Donâ€™t just check errors, handle them gracefully</a>. ä¸è¦åªæ˜¯æ£€æŸ¥é”™è¯¯ï¼Œè¦ä¼˜é›…åœ°å¤„ç†é”™è¯¯</p>

<h3 id="å¤„ç†ç±»å‹æ–­è¨€å¤±è´¥">å¤„ç†ç±»å‹æ–­è¨€å¤±è´¥</h3>

<p><a href="https://golang.org/ref/spec#Type_assertions">type assertion</a> çš„å•ä¸ªè¿”å›å€¼å½¢å¼é’ˆå¯¹ä¸æ­£ç¡®çš„ç±»å‹å°†äº§ç”Ÿ panicã€‚å› æ­¤ï¼Œè¯·å§‹ç»ˆä½¿ç”¨â€œcomma okâ€çš„æƒ¯ç”¨æ³•ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t</span> <span class="o">:=</span> <span class="n">i</span><span class="o">.</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t</span><span class="p">,</span> <span class="n">ok</span> <span class="o">:=</span> <span class="n">i</span><span class="o">.</span><span class="p">(</span><span class="kt">string</span><span class="p">)</span>
<span class="k">if</span> <span class="o">!</span><span class="n">ok</span> <span class="p">{</span>
  <span class="c">// ä¼˜é›…åœ°å¤„ç†é”™è¯¯</span>
<span class="p">}</span>
</code></pre></div></div>

<!-- TODO: There are a few situations where the single assignment form is
fine. -->

<h3 id="ä¸è¦-panic">ä¸è¦ panic</h3>

<p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œçš„ä»£ç å¿…é¡»é¿å…å‡ºç° panicã€‚panic æ˜¯ <a href="https://en.wikipedia.org/wiki/Cascading_failure">cascading failures</a> çº§è”å¤±è´¥çš„ä¸»è¦æ ¹æº ã€‚å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œè¯¥å‡½æ•°å¿…é¡»è¿”å›é”™è¯¯ï¼Œå¹¶å…è®¸è°ƒç”¨æ–¹å†³å®šå¦‚ä½•å¤„ç†å®ƒã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">foo</span><span class="p">(</span><span class="n">bar</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span> <span class="o">==</span> <span class="m">0</span> <span class="p">{</span>
    <span class="nb">panic</span><span class="p">(</span><span class="s">"bar must not be empty"</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="c">// ...</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Args</span><span class="p">)</span> <span class="o">!=</span> <span class="m">2</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"USAGE: foo &lt;bar&gt;"</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="n">foo</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Args</span><span class="p">[</span><span class="m">1</span><span class="p">])</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">foo</span><span class="p">(</span><span class="n">bar</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span> <span class="o">==</span> <span class="m">0</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">errors</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s">"bar must not be empty"</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="c">// ...</span>
  <span class="k">return</span> <span class="no">nil</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Args</span><span class="p">)</span> <span class="o">!=</span> <span class="m">2</span> <span class="p">{</span>
    <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"USAGE: foo &lt;bar&gt;"</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">Exit</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">foo</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">Args</span><span class="p">[</span><span class="m">1</span><span class="p">]);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="nb">panic</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>panic/recover ä¸æ˜¯é”™è¯¯å¤„ç†ç­–ç•¥ã€‚ä»…å½“å‘ç”Ÿä¸å¯æ¢å¤çš„äº‹æƒ…ï¼ˆä¾‹å¦‚ï¼šnil å¼•ç”¨ï¼‰æ—¶ï¼Œç¨‹åºæ‰å¿…é¡» panicã€‚ç¨‹åºåˆå§‹åŒ–æ˜¯ä¸€ä¸ªä¾‹å¤–ï¼šç¨‹åºå¯åŠ¨æ—¶åº”ä½¿ç¨‹åºä¸­æ­¢çš„ä¸è‰¯æƒ…å†µå¯èƒ½ä¼šå¼•èµ· panicã€‚</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="n">_statusTemplate</span> <span class="o">=</span> <span class="n">template</span><span class="o">.</span><span class="n">Must</span><span class="p">(</span><span class="n">template</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="s">"name"</span><span class="p">)</span><span class="o">.</span><span class="n">Parse</span><span class="p">(</span><span class="s">"_statusHTML"</span><span class="p">))</span>
</code></pre></div></div>

<p>å³ä½¿åœ¨æµ‹è¯•ä»£ç ä¸­ï¼Œä¹Ÿä¼˜å…ˆä½¿ç”¨<code class="language-plaintext highlighter-rouge">t.Fatal</code>æˆ–è€…<code class="language-plaintext highlighter-rouge">t.FailNow</code>è€Œä¸æ˜¯ panic æ¥ç¡®ä¿å¤±è´¥è¢«æ ‡è®°ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// func TestFoo(t *testing.T)</span>

<span class="n">f</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">TempFile</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="s">"test"</span><span class="p">)</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
  <span class="nb">panic</span><span class="p">(</span><span class="s">"failed to set up test"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// func TestFoo(t *testing.T)</span>

<span class="n">f</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">TempFile</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="s">"test"</span><span class="p">)</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
  <span class="n">t</span><span class="o">.</span><span class="n">Fatal</span><span class="p">(</span><span class="s">"failed to set up test"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<!-- TODO: Explain how to use _test packages. -->

<h3 id="ä½¿ç”¨-gouberorgatomic">ä½¿ç”¨ go.uber.org/atomic</h3>

<p>ä½¿ç”¨ <a href="https://golang.org/pkg/sync/atomic/">sync/atomic</a> åŒ…çš„åŸå­æ“ä½œå¯¹åŸå§‹ç±»å‹ (<code class="language-plaintext highlighter-rouge">int32</code>, <code class="language-plaintext highlighter-rouge">int64</code>ç­‰ï¼‰è¿›è¡Œæ“ä½œï¼Œå› ä¸ºå¾ˆå®¹æ˜“å¿˜è®°ä½¿ç”¨åŸå­æ“ä½œæ¥è¯»å–æˆ–ä¿®æ”¹å˜é‡ã€‚</p>

<p><a href="https://godoc.org/go.uber.org/atomic">go.uber.org/atomic</a> é€šè¿‡éšè—åŸºç¡€ç±»å‹ä¸ºè¿™äº›æ“ä½œå¢åŠ äº†ç±»å‹å®‰å…¨æ€§ã€‚æ­¤å¤–ï¼Œå®ƒåŒ…æ‹¬ä¸€ä¸ªæ–¹ä¾¿çš„<code class="language-plaintext highlighter-rouge">atomic.Bool</code>ç±»å‹ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">foo</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">running</span> <span class="kt">int32</span>  <span class="c">// atomic</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">f</span><span class="o">*</span> <span class="n">foo</span><span class="p">)</span> <span class="n">start</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="n">atomic</span><span class="o">.</span><span class="n">SwapInt32</span><span class="p">(</span><span class="o">&amp;</span><span class="n">f</span><span class="o">.</span><span class="n">running</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span> <span class="o">==</span> <span class="m">1</span> <span class="p">{</span>
     <span class="c">// already runningâ€¦</span>
     <span class="k">return</span>
  <span class="p">}</span>
  <span class="c">// start the Foo</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span><span class="n">foo</span><span class="p">)</span> <span class="n">isRunning</span><span class="p">()</span> <span class="kt">bool</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">running</span> <span class="o">==</span> <span class="m">1</span>  <span class="c">// race!</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">foo</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">running</span> <span class="n">atomic</span><span class="o">.</span><span class="n">Bool</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span><span class="n">foo</span><span class="p">)</span> <span class="n">start</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">running</span><span class="o">.</span><span class="n">Swap</span><span class="p">(</span><span class="no">true</span><span class="p">)</span> <span class="p">{</span>
     <span class="c">// already runningâ€¦</span>
     <span class="k">return</span>
  <span class="p">}</span>
  <span class="c">// start the Foo</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">f</span> <span class="o">*</span><span class="n">foo</span><span class="p">)</span> <span class="n">isRunning</span><span class="p">()</span> <span class="kt">bool</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">running</span><span class="o">.</span><span class="n">Load</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="é¿å…å¯å˜å…¨å±€å˜é‡">é¿å…å¯å˜å…¨å±€å˜é‡</h3>

<p>ä½¿ç”¨é€‰æ‹©ä¾èµ–æ³¨å…¥æ–¹å¼é¿å…æ”¹å˜å…¨å±€å˜é‡ã€‚ 
æ—¢é€‚ç”¨äºå‡½æ•°æŒ‡é’ˆåˆé€‚ç”¨äºå…¶ä»–å€¼ç±»å‹</p>

<p><strong>bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// sign.go</span>
<span class="k">var</span> <span class="n">_timeNow</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span>
<span class="k">func</span> <span class="n">sign</span><span class="p">(</span><span class="n">msg</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="n">now</span> <span class="o">:=</span> <span class="n">_timeNow</span><span class="p">()</span>
  <span class="k">return</span> <span class="n">signWithTime</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">now</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// sign_test.go</span>
<span class="k">func</span> <span class="n">TestSign</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">testing</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">oldTimeNow</span> <span class="o">:=</span> <span class="n">_timeNow</span>
  <span class="n">_timeNow</span> <span class="o">=</span> <span class="k">func</span><span class="p">()</span> <span class="n">time</span><span class="o">.</span><span class="n">Time</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">someFixedTime</span>
  <span class="p">}</span>
  <span class="k">defer</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span> <span class="n">_timeNow</span> <span class="o">=</span> <span class="n">oldTimeNow</span> <span class="p">}()</span>
  <span class="n">assert</span><span class="o">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">want</span><span class="p">,</span> <span class="n">sign</span><span class="p">(</span><span class="n">give</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// sign.go</span>
<span class="k">type</span> <span class="n">signer</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">now</span> <span class="k">func</span><span class="p">()</span> <span class="n">time</span><span class="o">.</span><span class="n">Time</span>
<span class="p">}</span>
<span class="k">func</span> <span class="n">newSigner</span><span class="p">()</span> <span class="o">*</span><span class="n">signer</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">&amp;</span><span class="n">signer</span><span class="p">{</span>
    <span class="n">now</span><span class="o">:</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span><span class="n">signer</span><span class="p">)</span> <span class="n">Sign</span><span class="p">(</span><span class="n">msg</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="n">now</span> <span class="o">:=</span> <span class="n">s</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
  <span class="k">return</span> <span class="n">signWithTime</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">now</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// sign_test.go</span>
<span class="k">func</span> <span class="n">TestSigner</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">testing</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">s</span> <span class="o">:=</span> <span class="n">newSigner</span><span class="p">()</span>
  <span class="n">s</span><span class="o">.</span><span class="n">now</span> <span class="o">=</span> <span class="k">func</span><span class="p">()</span> <span class="n">time</span><span class="o">.</span><span class="n">Time</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">someFixedTime</span>
  <span class="p">}</span>
  <span class="n">assert</span><span class="o">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">want</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">Sign</span><span class="p">(</span><span class="n">give</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="é¿å…åœ¨å…¬å…±ç»“æ„ä¸­åµŒå…¥ç±»å‹">é¿å…åœ¨å…¬å…±ç»“æ„ä¸­åµŒå…¥ç±»å‹</h3>

<p>è¿™äº›åµŒå…¥çš„ç±»å‹æ³„æ¼å®ç°ç»†èŠ‚ã€ç¦æ­¢ç±»å‹æ¼”åŒ–å’Œæ¨¡ç³Šçš„æ–‡æ¡£ã€‚</p>

<p>å‡è®¾æ‚¨ä½¿ç”¨å…±äº«çš„ <code class="language-plaintext highlighter-rouge">AbstractList</code> å®ç°äº†å¤šç§åˆ—è¡¨ç±»å‹ï¼Œè¯·é¿å…åœ¨å…·ä½“çš„åˆ—è¡¨å®ç°ä¸­åµŒå…¥ <code class="language-plaintext highlighter-rouge">AbstractList</code>ã€‚
ç›¸åï¼Œåªéœ€æ‰‹åŠ¨å°†æ–¹æ³•å†™å…¥å…·ä½“çš„åˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨å°†å§”æ‰˜ç»™æŠ½è±¡åˆ—è¡¨ã€‚</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">AbstractList</span> <span class="k">struct</span> <span class="p">{}</span>
<span class="c">// æ·»åŠ å°†å®ä½“æ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚</span>
<span class="k">func</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span><span class="n">AbstractList</span><span class="p">)</span> <span class="n">Add</span><span class="p">(</span><span class="n">e</span> <span class="n">Entity</span><span class="p">)</span> <span class="p">{</span>
  <span class="c">// ...</span>
<span class="p">}</span>
<span class="c">// ç§»é™¤ä»åˆ—è¡¨ä¸­ç§»é™¤å®ä½“ã€‚</span>
<span class="k">func</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span><span class="n">AbstractList</span><span class="p">)</span> <span class="n">Remove</span><span class="p">(</span><span class="n">e</span> <span class="n">Entity</span><span class="p">)</span> <span class="p">{</span>
  <span class="c">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// ConcreteList æ˜¯ä¸€ä¸ªå®ä½“åˆ—è¡¨ã€‚</span>
<span class="k">type</span> <span class="n">ConcreteList</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="o">*</span><span class="n">AbstractList</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// ConcreteList æ˜¯ä¸€ä¸ªå®ä½“åˆ—è¡¨ã€‚</span>
<span class="k">type</span> <span class="n">ConcreteList</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">list</span> <span class="o">*</span><span class="n">AbstractList</span>
<span class="p">}</span>
<span class="c">// æ·»åŠ å°†å®ä½“æ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚</span>
<span class="k">func</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span><span class="n">ConcreteList</span><span class="p">)</span> <span class="n">Add</span><span class="p">(</span><span class="n">e</span> <span class="n">Entity</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">l</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="p">}</span>
<span class="c">// ç§»é™¤ä»åˆ—è¡¨ä¸­ç§»é™¤å®ä½“ã€‚</span>
<span class="k">func</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span><span class="n">ConcreteList</span><span class="p">)</span> <span class="n">Remove</span><span class="p">(</span><span class="n">e</span> <span class="n">Entity</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">l</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Go å…è®¸ <a href="https://golang.org/doc/effective_go.html#embedding">ç±»å‹åµŒå…¥</a> ä½œä¸ºç»§æ‰¿å’Œç»„åˆä¹‹é—´çš„æŠ˜è¡·ã€‚
å¤–éƒ¨ç±»å‹è·å–åµŒå…¥ç±»å‹çš„æ–¹æ³•çš„éšå¼å‰¯æœ¬ã€‚
é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›æ–¹æ³•å§”æ‰˜ç»™åµŒå…¥å®ä¾‹çš„åŒä¸€æ–¹æ³•ã€‚</p>

<p>ç»“æ„è¿˜è·å¾—ä¸ç±»å‹åŒåçš„å­—æ®µã€‚
æ‰€ä»¥ï¼Œå¦‚æœåµŒå…¥çš„ç±»å‹æ˜¯ publicï¼Œé‚£ä¹ˆå­—æ®µæ˜¯ publicã€‚ä¸ºäº†ä¿æŒå‘åå…¼å®¹æ€§ï¼Œå¤–éƒ¨ç±»å‹çš„æ¯ä¸ªæœªæ¥ç‰ˆæœ¬éƒ½å¿…é¡»ä¿ç•™åµŒå…¥ç±»å‹ã€‚</p>

<p>å¾ˆå°‘éœ€è¦åµŒå…¥ç±»å‹ã€‚
è¿™æ˜¯ä¸€ç§æ–¹ä¾¿ï¼Œå¯ä»¥å¸®åŠ©æ‚¨é¿å…ç¼–å†™å†—é•¿çš„å§”æ‰˜æ–¹æ³•ã€‚</p>

<p>å³ä½¿åµŒå…¥å…¼å®¹çš„æŠ½è±¡åˆ—è¡¨ <em>interface</em>ï¼Œè€Œä¸æ˜¯ç»“æ„ä½“ï¼Œè¿™å°†ä¸ºå¼€å‘äººå‘˜æä¾›æ›´å¤§çš„çµæ´»æ€§æ¥æ”¹å˜æœªæ¥ï¼Œä½†ä»ç„¶æ³„éœ²äº†å…·ä½“åˆ—è¡¨ä½¿ç”¨æŠ½è±¡å®ç°çš„ç»†èŠ‚ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// AbstractList æ˜¯å„ç§å®ä½“åˆ—è¡¨çš„é€šç”¨å®ç°ã€‚</span>
<span class="k">type</span> <span class="n">AbstractList</span> <span class="k">interface</span> <span class="p">{</span>
  <span class="n">Add</span><span class="p">(</span><span class="n">Entity</span><span class="p">)</span>
  <span class="n">Remove</span><span class="p">(</span><span class="n">Entity</span><span class="p">)</span>
<span class="p">}</span>
<span class="c">// ConcreteList æ˜¯ä¸€ä¸ªå®ä½“åˆ—è¡¨ã€‚</span>
<span class="k">type</span> <span class="n">ConcreteList</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">AbstractList</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// ConcreteList æ˜¯ä¸€ä¸ªå®ä½“åˆ—è¡¨ã€‚</span>
<span class="k">type</span> <span class="n">ConcreteList</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">list</span> <span class="o">*</span><span class="n">AbstractList</span>
<span class="p">}</span>
<span class="c">// æ·»åŠ å°†å®ä½“æ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚</span>
<span class="k">func</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span><span class="n">ConcreteList</span><span class="p">)</span> <span class="n">Add</span><span class="p">(</span><span class="n">e</span> <span class="n">Entity</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">l</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="p">}</span>
<span class="c">// ç§»é™¤ä»åˆ—è¡¨ä¸­ç§»é™¤å®ä½“ã€‚</span>
<span class="k">func</span> <span class="p">(</span><span class="n">l</span> <span class="o">*</span><span class="n">ConcreteList</span><span class="p">)</span> <span class="n">Remove</span><span class="p">(</span><span class="n">e</span> <span class="n">Entity</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">l</span><span class="o">.</span><span class="n">list</span><span class="o">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æ— è®ºæ˜¯ä½¿ç”¨åµŒå…¥å¼ç»“æ„è¿˜æ˜¯ä½¿ç”¨åµŒå…¥å¼æ¥å£ï¼ŒåµŒå…¥å¼ç±»å‹éƒ½ä¼šé™åˆ¶ç±»å‹çš„æ¼”åŒ–.</p>

<ul>
  <li>å‘åµŒå…¥å¼æ¥å£æ·»åŠ æ–¹æ³•æ˜¯ä¸€ä¸ªç ´åæ€§çš„æ”¹å˜ã€‚</li>
  <li>åˆ é™¤åµŒå…¥ç±»å‹æ˜¯ä¸€ä¸ªç ´åæ€§çš„æ”¹å˜ã€‚</li>
  <li>å³ä½¿ä½¿ç”¨æ»¡è¶³ç›¸åŒæ¥å£çš„æ›¿ä»£æ–¹æ³•æ›¿æ¢åµŒå…¥ç±»å‹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç ´åæ€§çš„æ”¹å˜ã€‚</li>
</ul>

<p>å°½ç®¡ç¼–å†™è¿™äº›å§”æ‰˜æ–¹æ³•æ˜¯ä¹å‘³çš„ï¼Œä½†æ˜¯é¢å¤–çš„å·¥ä½œéšè—äº†å®ç°ç»†èŠ‚ï¼Œç•™ä¸‹äº†æ›´å¤šçš„æ›´æ”¹æœºä¼šï¼Œè¿˜æ¶ˆé™¤äº†åœ¨æ–‡æ¡£ä¸­å‘ç°å®Œæ•´åˆ—è¡¨æ¥å£çš„é—´æ¥æ€§æ“ä½œã€‚</p>

<h2 id="æ€§èƒ½">æ€§èƒ½</h2>

<p>æ€§èƒ½æ–¹é¢çš„ç‰¹å®šå‡†åˆ™åªé€‚ç”¨äºé«˜é¢‘åœºæ™¯ã€‚</p>

<h3 id="ä¼˜å…ˆä½¿ç”¨-strconv-è€Œä¸æ˜¯-fmt">ä¼˜å…ˆä½¿ç”¨ strconv è€Œä¸æ˜¯ fmt</h3>

<p>å°†åŸè¯­è½¬æ¢ä¸ºå­—ç¬¦ä¸²æˆ–ä»å­—ç¬¦ä¸²è½¬æ¢æ—¶ï¼Œ<code class="language-plaintext highlighter-rouge">strconv</code>é€Ÿåº¦æ¯”<code class="language-plaintext highlighter-rouge">fmt</code>å¿«ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">b</span><span class="o">.</span><span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
  <span class="n">s</span> <span class="o">:=</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprint</span><span class="p">(</span><span class="n">rand</span><span class="o">.</span><span class="n">Int</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BenchmarkFmtSprint-4    143 ns/op    2 allocs/op
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">b</span><span class="o">.</span><span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
  <span class="n">s</span> <span class="o">:=</span> <span class="n">strconv</span><span class="o">.</span><span class="n">Itoa</span><span class="p">(</span><span class="n">rand</span><span class="o">.</span><span class="n">Int</span><span class="p">())</span>
<span class="p">}</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BenchmarkStrconv-4    64.2 ns/op    1 allocs/op
</code></pre></div></div>

<h3 id="é¿å…å­—ç¬¦ä¸²åˆ°å­—èŠ‚çš„è½¬æ¢">é¿å…å­—ç¬¦ä¸²åˆ°å­—èŠ‚çš„è½¬æ¢</h3>

<p>ä¸è¦åå¤ä»å›ºå®šå­—ç¬¦ä¸²åˆ›å»ºå­—èŠ‚ sliceã€‚ç›¸åï¼Œè¯·æ‰§è¡Œä¸€æ¬¡è½¬æ¢å¹¶æ•è·ç»“æœã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">b</span><span class="o">.</span><span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
  <span class="n">w</span><span class="o">.</span><span class="n">Write</span><span class="p">([]</span><span class="kt">byte</span><span class="p">(</span><span class="s">"Hello world"</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BenchmarkBad-4   50000000   22.2 ns/op
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">(</span><span class="s">"Hello world"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">b</span><span class="o">.</span><span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
  <span class="n">w</span><span class="o">.</span><span class="n">Write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BenchmarkGood-4  500000000   3.25 ns/op
</code></pre></div></div>

<h3 id="å°½é‡åˆå§‹åŒ–æ—¶æŒ‡å®š-map-å®¹é‡">å°½é‡åˆå§‹åŒ–æ—¶æŒ‡å®š Map å®¹é‡</h3>

<p>åœ¨å°½å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œåœ¨ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">make()</code> åˆå§‹åŒ–çš„æ—¶å€™æä¾›å®¹é‡ä¿¡æ¯</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">make</span><span class="p">(</span><span class="k">map</span><span class="p">[</span><span class="n">T1</span><span class="p">]</span><span class="n">T2</span><span class="p">,</span> <span class="n">hint</span><span class="p">)</span>
</code></pre></div></div>

<p>ä¸º <code class="language-plaintext highlighter-rouge">make()</code> æä¾›å®¹é‡ä¿¡æ¯ï¼ˆhintï¼‰å°è¯•åœ¨åˆå§‹åŒ–æ—¶è°ƒæ•´ map å¤§å°ï¼Œ
è¿™å‡å°‘äº†åœ¨å°†å…ƒç´ æ·»åŠ åˆ° map æ—¶å¢é•¿å’Œåˆ†é…çš„å¼€é”€ã€‚
æ³¨æ„ï¼Œmap ä¸èƒ½ä¿è¯åˆ†é… hint ä¸ªå®¹é‡ã€‚å› æ­¤ï¼Œå³ä½¿æä¾›äº†å®¹é‡ï¼Œæ·»åŠ å…ƒç´ ä»ç„¶å¯ä»¥è¿›è¡Œåˆ†é…ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="n">os</span><span class="o">.</span><span class="n">FileInfo</span><span class="p">)</span>

<span class="n">files</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">ReadDir</span><span class="p">(</span><span class="s">"./files"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">f</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">files</span> <span class="p">{</span>
    <span class="n">m</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">Name</span><span class="p">()]</span> <span class="o">=</span> <span class="n">f</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">files</span><span class="p">,</span> <span class="n">_</span> <span class="o">:=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">ReadDir</span><span class="p">(</span><span class="s">"./files"</span><span class="p">)</span>

<span class="n">m</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="n">os</span><span class="o">.</span><span class="n">FileInfo</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">))</span>
<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">f</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">files</span> <span class="p">{</span>
    <span class="n">m</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">Name</span><span class="p">()]</span> <span class="o">=</span> <span class="n">f</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">m</code> æ˜¯åœ¨æ²¡æœ‰å¤§å°æç¤ºçš„æƒ…å†µä¸‹åˆ›å»ºçš„ï¼› åœ¨è¿è¡Œæ—¶å¯èƒ½ä¼šæœ‰æ›´å¤šåˆ†é…ã€‚</p>

<p><code class="language-plaintext highlighter-rouge">m</code> æ˜¯æœ‰å¤§å°æç¤ºåˆ›å»ºçš„ï¼›åœ¨è¿è¡Œæ—¶å¯èƒ½ä¼šæœ‰æ›´å°‘çš„åˆ†é…ã€‚</p>

<h2 id="è§„èŒƒ">è§„èŒƒ</h2>

<h3 id="ä¸€è‡´æ€§">ä¸€è‡´æ€§</h3>

<p>æœ¬æ–‡ä¸­æ¦‚è¿°çš„ä¸€äº›æ ‡å‡†éƒ½æ˜¯å®¢è§‚æ€§çš„è¯„ä¼°ï¼Œæ˜¯æ ¹æ®åœºæ™¯ã€ä¸Šä¸‹æ–‡ã€æˆ–è€…ä¸»è§‚æ€§çš„åˆ¤æ–­ï¼›</p>

<p>ä½†æ˜¯æœ€é‡è¦çš„æ˜¯ï¼Œ<strong>ä¿æŒä¸€è‡´</strong>.</p>

<p>ä¸€è‡´æ€§çš„ä»£ç æ›´å®¹æ˜“ç»´æŠ¤ã€æ˜¯æ›´åˆç†çš„ã€éœ€è¦æ›´å°‘çš„å­¦ä¹ æˆæœ¬ã€å¹¶ä¸”éšç€æ–°çš„çº¦å®šå‡ºç°æˆ–è€…å‡ºç°é”™è¯¯åæ›´å®¹æ˜“è¿ç§»ã€æ›´æ–°ã€ä¿®å¤ bug</p>

<p>ç›¸åï¼Œä¸€ä¸ªå•ä¸€çš„ä»£ç åº“ä¼šå¯¼è‡´ç»´æŠ¤æˆæœ¬å¼€é”€ã€ä¸ç¡®å®šæ€§å’Œè®¤çŸ¥åå·®ã€‚æ‰€æœ‰è¿™äº›éƒ½ä¼šç›´æ¥å¯¼è‡´é€Ÿåº¦é™ä½ã€
ä»£ç å®¡æŸ¥ç—›è‹¦ã€è€Œä¸”å¢åŠ  bug æ•°é‡</p>

<p>å°†è¿™äº›æ ‡å‡†åº”ç”¨äºä»£ç åº“æ—¶ï¼Œå»ºè®®åœ¨ packageï¼ˆæˆ–æ›´å¤§ï¼‰çº§åˆ«è¿›è¡Œæ›´æ”¹ï¼Œå­åŒ…çº§åˆ«çš„åº”ç”¨ç¨‹åºé€šè¿‡å°†å¤šä¸ªæ ·å¼å¼•å…¥åˆ°åŒä¸€ä»£ç ä¸­ï¼Œè¿åäº†ä¸Šè¿°å…³æ³¨ç‚¹ã€‚</p>

<h3 id="ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€ç»„">ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€ç»„</h3>

<p>Go è¯­è¨€æ”¯æŒå°†ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€ä¸ªç»„å†…ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="s">"a"</span>
<span class="k">import</span> <span class="s">"b"</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">(</span>
  <span class="s">"a"</span>
  <span class="s">"b"</span>
<span class="p">)</span>
</code></pre></div></div>

<p>è¿™åŒæ ·é€‚ç”¨äºå¸¸é‡ã€å˜é‡å’Œç±»å‹å£°æ˜ï¼š</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">const</span> <span class="n">a</span> <span class="o">=</span> <span class="m">1</span>
<span class="k">const</span> <span class="n">b</span> <span class="o">=</span> <span class="m">2</span>

<span class="k">var</span> <span class="n">a</span> <span class="o">=</span> <span class="m">1</span>
<span class="k">var</span> <span class="n">b</span> <span class="o">=</span> <span class="m">2</span>

<span class="k">type</span> <span class="n">Area</span> <span class="kt">float64</span>
<span class="k">type</span> <span class="n">Volume</span> <span class="kt">float64</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="p">(</span>
  <span class="n">a</span> <span class="o">=</span> <span class="m">1</span>
  <span class="n">b</span> <span class="o">=</span> <span class="m">2</span>
<span class="p">)</span>

<span class="k">var</span> <span class="p">(</span>
  <span class="n">a</span> <span class="o">=</span> <span class="m">1</span>
  <span class="n">b</span> <span class="o">=</span> <span class="m">2</span>
<span class="p">)</span>

<span class="k">type</span> <span class="p">(</span>
  <span class="n">Area</span> <span class="kt">float64</span>
  <span class="n">Volume</span> <span class="kt">float64</span>
<span class="p">)</span>
</code></pre></div></div>

<p>ä»…å°†ç›¸å…³çš„å£°æ˜æ”¾åœ¨ä¸€ç»„ã€‚ä¸è¦å°†ä¸ç›¸å…³çš„å£°æ˜æ”¾åœ¨ä¸€ç»„ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Operation</span> <span class="kt">int</span>

<span class="k">const</span> <span class="p">(</span>
  <span class="n">Add</span> <span class="n">Operation</span> <span class="o">=</span> <span class="no">iota</span> <span class="o">+</span> <span class="m">1</span>
  <span class="n">Subtract</span>
  <span class="n">Multiply</span>
  <span class="n">ENV_VAR</span> <span class="o">=</span> <span class="s">"MY_ENV"</span>
<span class="p">)</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Operation</span> <span class="kt">int</span>

<span class="k">const</span> <span class="p">(</span>
  <span class="n">Add</span> <span class="n">Operation</span> <span class="o">=</span> <span class="no">iota</span> <span class="o">+</span> <span class="m">1</span>
  <span class="n">Subtract</span>
  <span class="n">Multiply</span>
<span class="p">)</span>

<span class="k">const</span> <span class="n">ENV_VAR</span> <span class="o">=</span> <span class="s">"MY_ENV"</span>
</code></pre></div></div>

<p>åˆ†ç»„ä½¿ç”¨çš„ä½ç½®æ²¡æœ‰é™åˆ¶ï¼Œä¾‹å¦‚ï¼šä½ å¯ä»¥åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨å®ƒä»¬ï¼š</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">f</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="k">var</span> <span class="n">red</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="m">0xff0000</span><span class="p">)</span>
  <span class="k">var</span> <span class="n">green</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="m">0x00ff00</span><span class="p">)</span>
  <span class="k">var</span> <span class="n">blue</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="m">0x0000ff</span><span class="p">)</span>

  <span class="o">...</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">f</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
  <span class="k">var</span> <span class="p">(</span>
    <span class="n">red</span>   <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="m">0xff0000</span><span class="p">)</span>
    <span class="n">green</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="m">0x00ff00</span><span class="p">)</span>
    <span class="n">blue</span>  <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">New</span><span class="p">(</span><span class="m">0x0000ff</span><span class="p">)</span>
  <span class="p">)</span>

  <span class="o">...</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="import-åˆ†ç»„">import åˆ†ç»„</h3>

<p>å¯¼å…¥åº”è¯¥åˆ†ä¸ºä¸¤ç»„ï¼š</p>

<ul>
  <li>æ ‡å‡†åº“</li>
  <li>å…¶ä»–åº“</li>
</ul>

<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™æ˜¯ goimports åº”ç”¨çš„åˆ†ç»„ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">(</span>
  <span class="s">"fmt"</span>
  <span class="s">"os"</span>
  <span class="s">"go.uber.org/atomic"</span>
  <span class="s">"golang.org/x/sync/errgroup"</span>
<span class="p">)</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">(</span>
  <span class="s">"fmt"</span>
  <span class="s">"os"</span>

  <span class="s">"go.uber.org/atomic"</span>
  <span class="s">"golang.org/x/sync/errgroup"</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="åŒ…å">åŒ…å</h3>

<p>å½“å‘½ååŒ…æ—¶ï¼Œè¯·æŒ‰ä¸‹é¢è§„åˆ™é€‰æ‹©ä¸€ä¸ªåç§°ï¼š</p>

<ul>
  <li>å…¨éƒ¨å°å†™ã€‚æ²¡æœ‰å¤§å†™æˆ–ä¸‹åˆ’çº¿ã€‚</li>
  <li>å¤§å¤šæ•°ä½¿ç”¨å‘½åå¯¼å…¥çš„æƒ…å†µä¸‹ï¼Œä¸éœ€è¦é‡å‘½åã€‚</li>
  <li>ç®€çŸ­è€Œç®€æ´ã€‚è¯·è®°ä½ï¼Œåœ¨æ¯ä¸ªä½¿ç”¨çš„åœ°æ–¹éƒ½å®Œæ•´æ ‡è¯†äº†è¯¥åç§°ã€‚</li>
  <li>ä¸ç”¨å¤æ•°ã€‚ä¾‹å¦‚<code class="language-plaintext highlighter-rouge">net/url</code>ï¼Œè€Œä¸æ˜¯<code class="language-plaintext highlighter-rouge">net/urls</code>ã€‚</li>
  <li>ä¸è¦ç”¨â€œcommonâ€ï¼Œâ€œutilâ€ï¼Œâ€œsharedâ€æˆ–â€œlibâ€ã€‚è¿™äº›æ˜¯ä¸å¥½çš„ï¼Œä¿¡æ¯é‡ä¸è¶³çš„åç§°ã€‚</li>
</ul>

<p>å¦è¯·å‚é˜… <a href="https://blog.golang.org/package-names">Package Names</a> å’Œ <a href="https://rakyll.org/style-packages/">Go åŒ…æ ·å¼æŒ‡å—</a>.</p>

<h3 id="å‡½æ•°å">å‡½æ•°å</h3>

<p>æˆ‘ä»¬éµå¾ª Go ç¤¾åŒºå…³äºä½¿ç”¨ <a href="https://golang.org/doc/effective_go.html#mixed-caps">MixedCaps ä½œä¸ºå‡½æ•°å</a> çš„çº¦å®šã€‚æœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œä¸ºäº†å¯¹ç›¸å…³çš„æµ‹è¯•ç”¨ä¾‹è¿›è¡Œåˆ†ç»„ï¼Œå‡½æ•°åå¯èƒ½åŒ…å«ä¸‹åˆ’çº¿ï¼Œå¦‚ï¼š<code class="language-plaintext highlighter-rouge">TestMyFunction_WhatIsBeingTested</code>.</p>

<h3 id="å¯¼å…¥åˆ«å">å¯¼å…¥åˆ«å</h3>

<p>å¦‚æœç¨‹åºåŒ…åç§°ä¸å¯¼å…¥è·¯å¾„çš„æœ€åä¸€ä¸ªå…ƒç´ ä¸åŒ¹é…ï¼Œåˆ™å¿…é¡»ä½¿ç”¨å¯¼å…¥åˆ«åã€‚</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">(</span>
  <span class="s">"net/http"</span>

  <span class="n">client</span> <span class="s">"example.com/client-go"</span>
  <span class="n">trace</span> <span class="s">"example.com/trace/v2"</span>
<span class="p">)</span>
</code></pre></div></div>

<p>åœ¨æ‰€æœ‰å…¶ä»–æƒ…å†µä¸‹ï¼Œé™¤éå¯¼å…¥ä¹‹é—´æœ‰ç›´æ¥å†²çªï¼Œå¦åˆ™åº”é¿å…å¯¼å…¥åˆ«åã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">(</span>
  <span class="s">"fmt"</span>
  <span class="s">"os"</span>

  <span class="n">nettrace</span> <span class="s">"golang.net/x/trace"</span>
<span class="p">)</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">(</span>
  <span class="s">"fmt"</span>
  <span class="s">"os"</span>
  <span class="s">"runtime/trace"</span>

  <span class="n">nettrace</span> <span class="s">"golang.net/x/trace"</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="å‡½æ•°åˆ†ç»„ä¸é¡ºåº">å‡½æ•°åˆ†ç»„ä¸é¡ºåº</h3>

<ul>
  <li>å‡½æ•°åº”æŒ‰ç²—ç•¥çš„è°ƒç”¨é¡ºåºæ’åºã€‚</li>
  <li>åŒä¸€æ–‡ä»¶ä¸­çš„å‡½æ•°åº”æŒ‰æ¥æ”¶è€…åˆ†ç»„ã€‚</li>
</ul>

<p>å› æ­¤ï¼Œå¯¼å‡ºçš„å‡½æ•°åº”å…ˆå‡ºç°åœ¨æ–‡ä»¶ä¸­ï¼Œæ”¾åœ¨<code class="language-plaintext highlighter-rouge">struct</code>, <code class="language-plaintext highlighter-rouge">const</code>, <code class="language-plaintext highlighter-rouge">var</code>å®šä¹‰çš„åé¢ã€‚</p>

<p>åœ¨å®šä¹‰ç±»å‹ä¹‹åï¼Œä½†åœ¨æ¥æ”¶è€…çš„å…¶ä½™æ–¹æ³•ä¹‹å‰ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">newXYZ()</code>/<code class="language-plaintext highlighter-rouge">NewXYZ()</code></p>

<p>ç”±äºå‡½æ•°æ˜¯æŒ‰æ¥æ”¶è€…åˆ†ç»„çš„ï¼Œå› æ­¤æ™®é€šå·¥å…·å‡½æ•°åº”åœ¨æ–‡ä»¶æœ«å°¾å‡ºç°ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span><span class="n">something</span><span class="p">)</span> <span class="n">Cost</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">calcCost</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">something</span> <span class="k">struct</span><span class="p">{</span> <span class="o">...</span> <span class="p">}</span>

<span class="k">func</span> <span class="n">calcCost</span><span class="p">(</span><span class="n">n</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span><span class="n">something</span><span class="p">)</span> <span class="n">Stop</span><span class="p">()</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>

<span class="k">func</span> <span class="n">newSomething</span><span class="p">()</span> <span class="o">*</span><span class="n">something</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="n">something</span><span class="p">{}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">something</span> <span class="k">struct</span><span class="p">{</span> <span class="o">...</span> <span class="p">}</span>

<span class="k">func</span> <span class="n">newSomething</span><span class="p">()</span> <span class="o">*</span><span class="n">something</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="n">something</span><span class="p">{}</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span><span class="n">something</span><span class="p">)</span> <span class="n">Cost</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">calcCost</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">s</span> <span class="o">*</span><span class="n">something</span><span class="p">)</span> <span class="n">Stop</span><span class="p">()</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>

<span class="k">func</span> <span class="n">calcCost</span><span class="p">(</span><span class="n">n</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
</code></pre></div></div>

<h3 id="å‡å°‘åµŒå¥—">å‡å°‘åµŒå¥—</h3>

<p>ä»£ç åº”é€šè¿‡å°½å¯èƒ½å…ˆå¤„ç†é”™è¯¯æƒ…å†µ/ç‰¹æ®Šæƒ…å†µå¹¶å°½æ—©è¿”å›æˆ–ç»§ç»­å¾ªç¯æ¥å‡å°‘åµŒå¥—ã€‚å‡å°‘åµŒå¥—å¤šä¸ªçº§åˆ«çš„ä»£ç çš„ä»£ç é‡ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">data</span> <span class="p">{</span>
  <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">F1</span> <span class="o">==</span> <span class="m">1</span> <span class="p">{</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">v</span><span class="o">.</span><span class="n">Call</span><span class="p">();</span> <span class="n">err</span> <span class="o">==</span> <span class="no">nil</span> <span class="p">{</span>
      <span class="n">v</span><span class="o">.</span><span class="n">Send</span><span class="p">()</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">err</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Invalid v: %v"</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">data</span> <span class="p">{</span>
  <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">F1</span> <span class="o">!=</span> <span class="m">1</span> <span class="p">{</span>
    <span class="n">log</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Invalid v: %v"</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="k">continue</span>
  <span class="p">}</span>

  <span class="n">v</span> <span class="o">=</span> <span class="n">process</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">v</span><span class="o">.</span><span class="n">Call</span><span class="p">();</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">err</span>
  <span class="p">}</span>
  <span class="n">v</span><span class="o">.</span><span class="n">Send</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="ä¸å¿…è¦çš„-else">ä¸å¿…è¦çš„ else</h3>

<p>å¦‚æœåœ¨ if çš„ä¸¤ä¸ªåˆ†æ”¯ä¸­éƒ½è®¾ç½®äº†å˜é‡ï¼Œåˆ™å¯ä»¥å°†å…¶æ›¿æ¢ä¸ºå•ä¸ª ifã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="n">a</span> <span class="kt">int</span>
<span class="k">if</span> <span class="n">b</span> <span class="p">{</span>
  <span class="n">a</span> <span class="o">=</span> <span class="m">100</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="n">a</span> <span class="o">=</span> <span class="m">10</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span> <span class="o">:=</span> <span class="m">10</span>
<span class="k">if</span> <span class="n">b</span> <span class="p">{</span>
  <span class="n">a</span> <span class="o">=</span> <span class="m">100</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="é¡¶å±‚å˜é‡å£°æ˜">é¡¶å±‚å˜é‡å£°æ˜</h3>

<p>åœ¨é¡¶å±‚ï¼Œä½¿ç”¨æ ‡å‡†<code class="language-plaintext highlighter-rouge">var</code>å…³é”®å­—ã€‚è¯·å‹¿æŒ‡å®šç±»å‹ï¼Œé™¤éå®ƒä¸è¡¨è¾¾å¼çš„ç±»å‹ä¸åŒã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="n">_s</span> <span class="kt">string</span> <span class="o">=</span> <span class="n">F</span><span class="p">()</span>

<span class="k">func</span> <span class="n">F</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span> <span class="k">return</span> <span class="s">"A"</span> <span class="p">}</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="n">_s</span> <span class="o">=</span> <span class="n">F</span><span class="p">()</span>
<span class="c">// ç”±äº F å·²ç»æ˜ç¡®äº†è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹ï¼Œå› æ­¤æˆ‘ä»¬æ²¡æœ‰å¿…è¦æ˜¾å¼æŒ‡å®š_s çš„ç±»å‹</span>
<span class="c">// è¿˜æ˜¯é‚£ç§ç±»å‹</span>

<span class="k">func</span> <span class="n">F</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span> <span class="k">return</span> <span class="s">"A"</span> <span class="p">}</span>
</code></pre></div></div>

<p>å¦‚æœè¡¨è¾¾å¼çš„ç±»å‹ä¸æ‰€éœ€çš„ç±»å‹ä¸å®Œå…¨åŒ¹é…ï¼Œè¯·æŒ‡å®šç±»å‹ã€‚</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">myError</span> <span class="k">struct</span><span class="p">{}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">myError</span><span class="p">)</span> <span class="n">Error</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span> <span class="k">return</span> <span class="s">"error"</span> <span class="p">}</span>

<span class="k">func</span> <span class="n">F</span><span class="p">()</span> <span class="n">myError</span> <span class="p">{</span> <span class="k">return</span> <span class="n">myError</span><span class="p">{}</span> <span class="p">}</span>

<span class="k">var</span> <span class="n">_e</span> <span class="kt">error</span> <span class="o">=</span> <span class="n">F</span><span class="p">()</span>
<span class="c">// F è¿”å›ä¸€ä¸ª myError ç±»å‹çš„å®ä¾‹ï¼Œä½†æ˜¯æˆ‘ä»¬è¦ error ç±»å‹</span>
</code></pre></div></div>

<h3 id="å¯¹äºæœªå¯¼å‡ºçš„é¡¶å±‚å¸¸é‡å’Œå˜é‡ä½¿ç”¨_ä½œä¸ºå‰ç¼€">å¯¹äºæœªå¯¼å‡ºçš„é¡¶å±‚å¸¸é‡å’Œå˜é‡ï¼Œä½¿ç”¨_ä½œä¸ºå‰ç¼€</h3>

<p>åœ¨æœªå¯¼å‡ºçš„é¡¶çº§<code class="language-plaintext highlighter-rouge">vars</code>å’Œ<code class="language-plaintext highlighter-rouge">consts</code>ï¼Œ å‰é¢åŠ ä¸Šå‰ç¼€_ï¼Œä»¥ä½¿å®ƒä»¬åœ¨ä½¿ç”¨æ—¶æ˜ç¡®è¡¨ç¤ºå®ƒä»¬æ˜¯å…¨å±€ç¬¦å·ã€‚</p>

<p>ä¾‹å¤–ï¼šæœªå¯¼å‡ºçš„é”™è¯¯å€¼ï¼Œåº”ä»¥<code class="language-plaintext highlighter-rouge">err</code>å¼€å¤´ã€‚</p>

<p>åŸºæœ¬ä¾æ®ï¼šé¡¶çº§å˜é‡å’Œå¸¸é‡å…·æœ‰åŒ…èŒƒå›´ä½œç”¨åŸŸã€‚ä½¿ç”¨é€šç”¨åç§°å¯èƒ½å¾ˆå®¹æ˜“åœ¨å…¶ä»–æ–‡ä»¶ä¸­æ„å¤–ä½¿ç”¨é”™è¯¯çš„å€¼ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// foo.go</span>

<span class="k">const</span> <span class="p">(</span>
  <span class="n">defaultPort</span> <span class="o">=</span> <span class="m">8080</span>
  <span class="n">defaultUser</span> <span class="o">=</span> <span class="s">"user"</span>
<span class="p">)</span>

<span class="c">// bar.go</span>

<span class="k">func</span> <span class="n">Bar</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">defaultPort</span> <span class="o">:=</span> <span class="m">9090</span>
  <span class="o">...</span>
  <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Default port"</span><span class="p">,</span> <span class="n">defaultPort</span><span class="p">)</span>

  <span class="c">// We will not see a compile error if the first line of</span>
  <span class="c">// Bar() is deleted.</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// foo.go</span>

<span class="k">const</span> <span class="p">(</span>
  <span class="n">_defaultPort</span> <span class="o">=</span> <span class="m">8080</span>
  <span class="n">_defaultUser</span> <span class="o">=</span> <span class="s">"user"</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="ç»“æ„ä½“ä¸­çš„åµŒå…¥">ç»“æ„ä½“ä¸­çš„åµŒå…¥</h3>

<p>åµŒå…¥å¼ç±»å‹ï¼ˆä¾‹å¦‚ mutexï¼‰åº”ä½äºç»“æ„ä½“å†…çš„å­—æ®µåˆ—è¡¨çš„é¡¶éƒ¨ï¼Œå¹¶ä¸”å¿…é¡»æœ‰ä¸€ä¸ªç©ºè¡Œå°†åµŒå…¥å¼å­—æ®µä¸å¸¸è§„å­—æ®µåˆ†éš”å¼€ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Client</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">version</span> <span class="kt">int</span>
  <span class="n">http</span><span class="o">.</span><span class="n">Client</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Client</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">http</span><span class="o">.</span><span class="n">Client</span>

  <span class="n">version</span> <span class="kt">int</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="ä½¿ç”¨å­—æ®µååˆå§‹åŒ–ç»“æ„ä½“">ä½¿ç”¨å­—æ®µååˆå§‹åŒ–ç»“æ„ä½“</h3>

<p>åˆå§‹åŒ–ç»“æ„ä½“æ—¶ï¼Œå‡ ä¹å§‹ç»ˆåº”è¯¥æŒ‡å®šå­—æ®µåç§°ã€‚ç°åœ¨ç”± <a href="https://golang.org/cmd/vet/"><code class="language-plaintext highlighter-rouge">go vet</code></a> å¼ºåˆ¶æ‰§è¡Œã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">k</span> <span class="o">:=</span> <span class="n">User</span><span class="p">{</span><span class="s">"John"</span><span class="p">,</span> <span class="s">"Doe"</span><span class="p">,</span> <span class="no">true</span><span class="p">}</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">k</span> <span class="o">:=</span> <span class="n">User</span><span class="p">{</span>
    <span class="n">FirstName</span><span class="o">:</span> <span class="s">"John"</span><span class="p">,</span>
    <span class="n">LastName</span><span class="o">:</span> <span class="s">"Doe"</span><span class="p">,</span>
    <span class="n">Admin</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ä¾‹å¤–ï¼šå¦‚æœæœ‰ 3 ä¸ªæˆ–æ›´å°‘çš„å­—æ®µï¼Œåˆ™å¯ä»¥åœ¨æµ‹è¯•è¡¨ä¸­çœç•¥å­—æ®µåç§°ã€‚</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tests</span> <span class="o">:=</span> <span class="p">[]</span><span class="k">struct</span><span class="p">{</span>
  <span class="n">op</span> <span class="n">Operation</span>
  <span class="n">want</span> <span class="kt">string</span>
<span class="p">}{</span>
  <span class="p">{</span><span class="n">Add</span><span class="p">,</span> <span class="s">"add"</span><span class="p">},</span>
  <span class="p">{</span><span class="n">Subtract</span><span class="p">,</span> <span class="s">"subtract"</span><span class="p">},</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="æœ¬åœ°å˜é‡å£°æ˜">æœ¬åœ°å˜é‡å£°æ˜</h3>

<p>å¦‚æœå°†å˜é‡æ˜ç¡®è®¾ç½®ä¸ºæŸä¸ªå€¼ï¼Œåˆ™åº”ä½¿ç”¨çŸ­å˜é‡å£°æ˜å½¢å¼ (<code class="language-plaintext highlighter-rouge">:=</code>)ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="n">s</span> <span class="o">=</span> <span class="s">"foo"</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">:=</span> <span class="s">"foo"</span>
</code></pre></div></div>

<p>ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œ<code class="language-plaintext highlighter-rouge">var</code> ä½¿ç”¨å…³é”®å­—æ—¶é»˜è®¤å€¼ä¼šæ›´æ¸…æ™°ã€‚ä¾‹å¦‚ï¼Œå£°æ˜ç©ºåˆ‡ç‰‡ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">f</span><span class="p">(</span><span class="n">list</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">filtered</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{}</span>
  <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">list</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="m">10</span> <span class="p">{</span>
      <span class="n">filtered</span> <span class="o">=</span> <span class="nb">append</span><span class="p">(</span><span class="n">filtered</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">f</span><span class="p">(</span><span class="n">list</span> <span class="p">[]</span><span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">var</span> <span class="n">filtered</span> <span class="p">[]</span><span class="kt">int</span>
  <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">list</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="m">10</span> <span class="p">{</span>
      <span class="n">filtered</span> <span class="o">=</span> <span class="nb">append</span><span class="p">(</span><span class="n">filtered</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="nil-æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„-slice">nil æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ slice</h3>

<p><code class="language-plaintext highlighter-rouge">nil</code> æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„é•¿åº¦ä¸º 0 çš„ sliceï¼Œè¿™æ„å‘³ç€ï¼Œ</p>

<ul>
  <li>
    <p>æ‚¨ä¸åº”æ˜ç¡®è¿”å›é•¿åº¦ä¸ºé›¶çš„åˆ‡ç‰‡ã€‚åº”è¯¥è¿”å›<code class="language-plaintext highlighter-rouge">nil</code> æ¥ä»£æ›¿ã€‚</p>

    <p><strong>Bad</strong></p>
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s">""</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{}</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <p><strong>Good</strong></p>
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s">""</span> <span class="p">{</span>
  <span class="k">return</span> <span class="no">nil</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>è¦æ£€æŸ¥åˆ‡ç‰‡æ˜¯å¦ä¸ºç©ºï¼Œè¯·å§‹ç»ˆä½¿ç”¨<code class="language-plaintext highlighter-rouge">len(s) == 0</code>ã€‚è€Œé <code class="language-plaintext highlighter-rouge">nil</code>ã€‚</p>

    <p><strong>Bad</strong></p>
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">isEmpty</span><span class="p">(</span><span class="n">s</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">s</span> <span class="o">==</span> <span class="no">nil</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <p><strong>Good</strong></p>
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="n">isEmpty</span><span class="p">(</span><span class="n">s</span> <span class="p">[]</span><span class="kt">string</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="m">0</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>é›¶å€¼åˆ‡ç‰‡ï¼ˆç”¨<code class="language-plaintext highlighter-rouge">var</code>å£°æ˜çš„åˆ‡ç‰‡ï¼‰å¯ç«‹å³ä½¿ç”¨ï¼Œæ— éœ€è°ƒç”¨<code class="language-plaintext highlighter-rouge">make()</code>åˆ›å»ºã€‚</p>

    <p><strong>Bad</strong></p>
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nums</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">int</span><span class="p">{}</span>
<span class="c">// or, nums := make([]int)</span>

<span class="k">if</span> <span class="n">add1</span> <span class="p">{</span>
  <span class="n">nums</span> <span class="o">=</span> <span class="nb">append</span><span class="p">(</span><span class="n">nums</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">if</span> <span class="n">add2</span> <span class="p">{</span>
  <span class="n">nums</span> <span class="o">=</span> <span class="nb">append</span><span class="p">(</span><span class="n">nums</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <p><strong>Good</strong></p>
    <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="n">nums</span> <span class="p">[]</span><span class="kt">int</span>

<span class="k">if</span> <span class="n">add1</span> <span class="p">{</span>
  <span class="n">nums</span> <span class="o">=</span> <span class="nb">append</span><span class="p">(</span><span class="n">nums</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">if</span> <span class="n">add2</span> <span class="p">{</span>
  <span class="n">nums</span> <span class="o">=</span> <span class="nb">append</span><span class="p">(</span><span class="n">nums</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
</ul>

<p>è®°ä½ï¼Œè™½ç„¶nilåˆ‡ç‰‡æ˜¯æœ‰æ•ˆçš„åˆ‡ç‰‡ï¼Œä½†å®ƒä¸ç­‰äºé•¿åº¦ä¸º0çš„åˆ‡ç‰‡ï¼ˆä¸€ä¸ªä¸ºnilï¼Œå¦ä¸€ä¸ªä¸æ˜¯ï¼‰ï¼Œå¹¶ä¸”åœ¨ä¸åŒçš„æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚åºåˆ—åŒ–ï¼‰ï¼Œè¿™ä¸¤ä¸ªåˆ‡ç‰‡çš„å¤„ç†æ–¹å¼å¯èƒ½ä¸åŒã€‚</p>

<h3 id="ç¼©å°å˜é‡ä½œç”¨åŸŸ">ç¼©å°å˜é‡ä½œç”¨åŸŸ</h3>

<p>å¦‚æœæœ‰å¯èƒ½ï¼Œå°½é‡ç¼©å°å˜é‡ä½œç”¨èŒƒå›´ã€‚é™¤éå®ƒä¸ <a href="#å‡å°‘åµŒå¥—">å‡å°‘åµŒå¥—</a>çš„è§„åˆ™å†²çªã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">err</span> <span class="o">:=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">WriteFile</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="m">0644</span><span class="p">)</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
 <span class="k">return</span> <span class="n">err</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">WriteFile</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="m">0644</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
 <span class="k">return</span> <span class="n">err</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å¦‚æœéœ€è¦åœ¨ if ä¹‹å¤–ä½¿ç”¨å‡½æ•°è°ƒç”¨çš„ç»“æœï¼Œåˆ™ä¸åº”å°è¯•ç¼©å°èŒƒå›´ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">data</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">ReadFile</span><span class="p">(</span><span class="n">name</span><span class="p">);</span> <span class="n">err</span> <span class="o">==</span> <span class="no">nil</span> <span class="p">{</span>
  <span class="n">err</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">Decode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">err</span>
  <span class="p">}</span>

  <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
  <span class="k">return</span> <span class="no">nil</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">err</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">ioutil</span><span class="o">.</span><span class="n">ReadFile</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
   <span class="k">return</span> <span class="n">err</span>
<span class="p">}</span>

<span class="k">if</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">cfg</span><span class="o">.</span><span class="n">Decode</span><span class="p">(</span><span class="n">data</span><span class="p">);</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">err</span>
<span class="p">}</span>

<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
<span class="k">return</span> <span class="no">nil</span>
</code></pre></div></div>

<h3 id="é¿å…å‚æ•°è¯­ä¹‰ä¸æ˜ç¡®avoid-naked-parameters">é¿å…å‚æ•°è¯­ä¹‰ä¸æ˜ç¡®(Avoid Naked Parameters)</h3>

<p>å‡½æ•°è°ƒç”¨ä¸­çš„<code class="language-plaintext highlighter-rouge">æ„ä¹‰ä¸æ˜ç¡®çš„å‚æ•°</code>å¯èƒ½ä¼šæŸå®³å¯è¯»æ€§ã€‚å½“å‚æ•°åç§°çš„å«ä¹‰ä¸æ˜æ˜¾æ—¶ï¼Œè¯·ä¸ºå‚æ•°æ·»åŠ  C æ ·å¼æ³¨é‡Š (<code class="language-plaintext highlighter-rouge">/* ... */</code>)</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// func printInfo(name string, isLocal, done bool)</span>

<span class="n">printInfo</span><span class="p">(</span><span class="s">"foo"</span><span class="p">,</span> <span class="no">true</span><span class="p">,</span> <span class="no">true</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// func printInfo(name string, isLocal, done bool)</span>

<span class="n">printInfo</span><span class="p">(</span><span class="s">"foo"</span><span class="p">,</span> <span class="no">true</span> <span class="c">/* isLocal */</span><span class="p">,</span> <span class="no">true</span> <span class="c">/* done */</span><span class="p">)</span>
</code></pre></div></div>

<p>å¯¹äºä¸Šé¢çš„ç¤ºä¾‹ä»£ç ï¼Œè¿˜æœ‰ä¸€ç§æ›´å¥½çš„å¤„ç†æ–¹å¼æ˜¯å°†ä¸Šé¢çš„ <code class="language-plaintext highlighter-rouge">bool</code> ç±»å‹æ¢æˆè‡ªå®šä¹‰ç±»å‹ã€‚å°†æ¥ï¼Œè¯¥å‚æ•°å¯ä»¥æ”¯æŒä¸ä»…ä»…å±€é™äºä¸¤ä¸ªçŠ¶æ€ï¼ˆtrue/falseï¼‰ã€‚</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">Region</span> <span class="kt">int</span>

<span class="k">const</span> <span class="p">(</span>
  <span class="n">UnknownRegion</span> <span class="n">Region</span> <span class="o">=</span> <span class="no">iota</span>
  <span class="n">Local</span>
<span class="p">)</span>

<span class="k">type</span> <span class="n">Status</span> <span class="kt">int</span>

<span class="k">const</span> <span class="p">(</span>
  <span class="n">StatusReady</span> <span class="n">Status</span><span class="o">=</span> <span class="no">iota</span> <span class="o">+</span> <span class="m">1</span>
  <span class="n">StatusDone</span>
  <span class="c">// Maybe we will have a StatusInProgress in the future.</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">printInfo</span><span class="p">(</span><span class="n">name</span> <span class="kt">string</span><span class="p">,</span> <span class="n">region</span> <span class="n">Region</span><span class="p">,</span> <span class="n">status</span> <span class="n">Status</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼é¿å…è½¬ä¹‰">ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼ï¼Œé¿å…è½¬ä¹‰</h3>

<p>Go æ”¯æŒä½¿ç”¨ <a href="https://golang.org/ref/spec#raw_string_lit">åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼</a>ï¼Œä¹Ÿå°±æ˜¯ â€œ ` â€œ æ¥è¡¨ç¤ºåŸç”Ÿå­—ç¬¦ä¸²ï¼Œåœ¨éœ€è¦è½¬ä¹‰çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡ä½¿ç”¨è¿™ç§æ–¹æ¡ˆæ¥æ›¿æ¢ã€‚</p>

<p>å¯ä»¥è·¨è¶Šå¤šè¡Œå¹¶åŒ…å«å¼•å·ã€‚ä½¿ç”¨è¿™äº›å­—ç¬¦ä¸²å¯ä»¥é¿å…æ›´éš¾é˜…è¯»çš„æ‰‹å·¥è½¬ä¹‰çš„å­—ç¬¦ä¸²ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">wantError</span> <span class="o">:=</span> <span class="s">"unknown name:</span><span class="se">\"</span><span class="s">test</span><span class="se">\"</span><span class="s">"</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">wantError</span> <span class="o">:=</span> <span class="s">`unknown error:"test"`</span>
</code></pre></div></div>

<h3 id="åˆå§‹åŒ–-struct-å¼•ç”¨">åˆå§‹åŒ– Struct å¼•ç”¨</h3>

<p>åœ¨åˆå§‹åŒ–ç»“æ„å¼•ç”¨æ—¶ï¼Œè¯·ä½¿ç”¨<code class="language-plaintext highlighter-rouge">&amp;T{}</code>ä»£æ›¿<code class="language-plaintext highlighter-rouge">new(T)</code>ï¼Œä»¥ä½¿å…¶ä¸ç»“æ„ä½“åˆå§‹åŒ–ä¸€è‡´ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sval</span> <span class="o">:=</span> <span class="n">T</span><span class="p">{</span><span class="n">Name</span><span class="o">:</span> <span class="s">"foo"</span><span class="p">}</span>

<span class="c">// inconsistent</span>
<span class="n">sptr</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="n">sptr</span><span class="o">.</span><span class="n">Name</span> <span class="o">=</span> <span class="s">"bar"</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sval</span> <span class="o">:=</span> <span class="n">T</span><span class="p">{</span><span class="n">Name</span><span class="o">:</span> <span class="s">"foo"</span><span class="p">}</span>

<span class="n">sptr</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">T</span><span class="p">{</span><span class="n">Name</span><span class="o">:</span> <span class="s">"bar"</span><span class="p">}</span>
</code></pre></div></div>

<h3 id="åˆå§‹åŒ–-maps">åˆå§‹åŒ– Maps</h3>

<p>å¯¹äºç©º map è¯·ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">make(..)</code> åˆå§‹åŒ–ï¼Œ å¹¶ä¸” map æ˜¯é€šè¿‡ç¼–ç¨‹æ–¹å¼å¡«å……çš„ã€‚
è¿™ä½¿å¾— map åˆå§‹åŒ–åœ¨è¡¨ç°ä¸Šä¸åŒäºå£°æ˜ï¼Œå¹¶ä¸”å®ƒè¿˜å¯ä»¥æ–¹ä¾¿åœ°åœ¨ make åæ·»åŠ å¤§å°æç¤ºã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="p">(</span>
  <span class="c">// m1 è¯»å†™å®‰å…¨;</span>
  <span class="c">// m2 åœ¨å†™å…¥æ—¶ä¼š panic</span>
  <span class="n">m1</span> <span class="o">=</span> <span class="k">map</span><span class="p">[</span><span class="n">T1</span><span class="p">]</span><span class="n">T2</span><span class="p">{}</span>
  <span class="n">m2</span> <span class="k">map</span><span class="p">[</span><span class="n">T1</span><span class="p">]</span><span class="n">T2</span>
<span class="p">)</span>
</code></pre></div></div>
<p>å£°æ˜å’Œåˆå§‹åŒ–çœ‹èµ·æ¥éå¸¸ç›¸ä¼¼çš„ã€‚</p>

<p>åœ¨å°½å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œè¯·åœ¨åˆå§‹åŒ–æ—¶æä¾› map å®¹é‡å¤§å°ï¼Œè¯¦ç»†è¯·çœ‹ <a href="#å°½é‡åˆå§‹åŒ–æ—¶æŒ‡å®š-Map-å®¹é‡">å°½é‡åˆå§‹åŒ–æ—¶æŒ‡å®š Map å®¹é‡</a>ã€‚</p>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">var</span> <span class="p">(</span>
  <span class="c">// m1 è¯»å†™å®‰å…¨;</span>
  <span class="c">// m2 åœ¨å†™å…¥æ—¶ä¼š panic</span>
  <span class="n">m1</span> <span class="o">=</span> <span class="nb">make</span><span class="p">(</span><span class="k">map</span><span class="p">[</span><span class="n">T1</span><span class="p">]</span><span class="n">T2</span><span class="p">)</span>
  <span class="n">m2</span> <span class="k">map</span><span class="p">[</span><span class="n">T1</span><span class="p">]</span><span class="n">T2</span>
<span class="p">)</span>
</code></pre></div></div>
<p>å£°æ˜å’Œåˆå§‹åŒ–çœ‹èµ·æ¥å·®åˆ«éå¸¸å¤§ã€‚</p>

<p>å¦å¤–ï¼Œå¦‚æœ map åŒ…å«å›ºå®šçš„å…ƒç´ åˆ—è¡¨ï¼Œåˆ™ä½¿ç”¨ map literals(map åˆå§‹åŒ–åˆ—è¡¨) åˆå§‹åŒ–æ˜ å°„ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="k">map</span><span class="p">[</span><span class="n">T1</span><span class="p">]</span><span class="n">T2</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
<span class="n">m</span><span class="p">[</span><span class="n">k1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v1</span>
<span class="n">m</span><span class="p">[</span><span class="n">k2</span><span class="p">]</span> <span class="o">=</span> <span class="n">v2</span>
<span class="n">m</span><span class="p">[</span><span class="n">k3</span><span class="p">]</span> <span class="o">=</span> <span class="n">v3</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">m</span> <span class="o">:=</span> <span class="k">map</span><span class="p">[</span><span class="n">T1</span><span class="p">]</span><span class="n">T2</span><span class="p">{</span>
  <span class="n">k1</span><span class="o">:</span> <span class="n">v1</span><span class="p">,</span>
  <span class="n">k2</span><span class="o">:</span> <span class="n">v2</span><span class="p">,</span>
  <span class="n">k3</span><span class="o">:</span> <span class="n">v3</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div></div>

<p>åŸºæœ¬å‡†åˆ™æ˜¯ï¼šåœ¨åˆå§‹åŒ–æ—¶ä½¿ç”¨ map åˆå§‹åŒ–åˆ—è¡¨ æ¥æ·»åŠ ä¸€ç»„å›ºå®šçš„å…ƒç´ ã€‚å¦åˆ™ä½¿ç”¨ <code class="language-plaintext highlighter-rouge">make</code> (å¦‚æœå¯ä»¥ï¼Œè¯·å°½é‡æŒ‡å®š map å®¹é‡)ã€‚</p>

<h3 id="å­—ç¬¦ä¸²-string-format">å­—ç¬¦ä¸² string format</h3>

<p>å¦‚æœä½ åœ¨å‡½æ•°å¤–å£°æ˜<code class="language-plaintext highlighter-rouge">Printf</code>-style å‡½æ•°çš„æ ¼å¼å­—ç¬¦ä¸²ï¼Œè¯·å°†å…¶è®¾ç½®ä¸º<code class="language-plaintext highlighter-rouge">const</code>å¸¸é‡ã€‚</p>

<p>è¿™æœ‰åŠ©äº<code class="language-plaintext highlighter-rouge">go vet</code>å¯¹æ ¼å¼å­—ç¬¦ä¸²æ‰§è¡Œé™æ€åˆ†æã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">msg</span> <span class="o">:=</span> <span class="s">"unexpected values %v, %v</span><span class="se">\n</span><span class="s">"</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">const</span> <span class="n">msg</span> <span class="o">=</span> <span class="s">"unexpected values %v, %v</span><span class="se">\n</span><span class="s">"</span>
<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="å‘½å-printf-æ ·å¼çš„å‡½æ•°">å‘½å Printf æ ·å¼çš„å‡½æ•°</h3>

<p>å£°æ˜<code class="language-plaintext highlighter-rouge">Printf</code>-style å‡½æ•°æ—¶ï¼Œè¯·ç¡®ä¿<code class="language-plaintext highlighter-rouge">go vet</code>å¯ä»¥æ£€æµ‹åˆ°å®ƒå¹¶æ£€æŸ¥æ ¼å¼å­—ç¬¦ä¸²ã€‚</p>

<p>è¿™æ„å‘³ç€æ‚¨åº”å°½å¯èƒ½ä½¿ç”¨é¢„å®šä¹‰çš„<code class="language-plaintext highlighter-rouge">Printf</code>-style å‡½æ•°åç§°ã€‚<code class="language-plaintext highlighter-rouge">go vet</code>å°†é»˜è®¤æ£€æŸ¥è¿™äº›ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ <a href="https://golang.org/cmd/vet/#hdr-Printf_family">Printf ç³»åˆ—</a>ã€‚</p>

<p>å¦‚æœä¸èƒ½ä½¿ç”¨é¢„å®šä¹‰çš„åç§°ï¼Œè¯·ä»¥ f ç»“æŸé€‰æ‹©çš„åç§°ï¼š<code class="language-plaintext highlighter-rouge">Wrapf</code>ï¼Œè€Œä¸æ˜¯<code class="language-plaintext highlighter-rouge">Wrap</code>ã€‚<code class="language-plaintext highlighter-rouge">go vet</code>å¯ä»¥è¦æ±‚æ£€æŸ¥ç‰¹å®šçš„ Printf æ ·å¼åç§°ï¼Œä½†åç§°å¿…é¡»ä»¥<code class="language-plaintext highlighter-rouge">f</code>ç»“å°¾ã€‚</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>go vet <span class="nt">-printfuncs</span><span class="o">=</span>wrapf,statusf
</code></pre></div></div>

<p>å¦è¯·å‚é˜… <a href="https://kuzminva.wordpress.com/2017/11/07/go-vet-printf-family-check/">go vet: Printf family check</a>.</p>

<h2 id="ç¼–ç¨‹æ¨¡å¼">ç¼–ç¨‹æ¨¡å¼</h2>

<h3 id="è¡¨é©±åŠ¨æµ‹è¯•">è¡¨é©±åŠ¨æµ‹è¯•</h3>

<p>å½“æµ‹è¯•é€»è¾‘æ˜¯é‡å¤çš„æ—¶å€™ï¼Œé€šè¿‡  <a href="https://blog.golang.org/subtests">subtests</a> ä½¿ç”¨ table é©±åŠ¨çš„æ–¹å¼ç¼–å†™ case ä»£ç çœ‹ä¸Šå»ä¼šæ›´ç®€æ´ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// func TestSplitHostPort(t *testing.T)</span>

<span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">net</span><span class="o">.</span><span class="n">SplitHostPort</span><span class="p">(</span><span class="s">"192.0.2.0:8000"</span><span class="p">)</span>
<span class="n">require</span><span class="o">.</span><span class="n">NoError</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
<span class="n">assert</span><span class="o">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s">"192.0.2.0"</span><span class="p">,</span> <span class="n">host</span><span class="p">)</span>
<span class="n">assert</span><span class="o">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s">"8000"</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>

<span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">SplitHostPort</span><span class="p">(</span><span class="s">"192.0.2.0:http"</span><span class="p">)</span>
<span class="n">require</span><span class="o">.</span><span class="n">NoError</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
<span class="n">assert</span><span class="o">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s">"192.0.2.0"</span><span class="p">,</span> <span class="n">host</span><span class="p">)</span>
<span class="n">assert</span><span class="o">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s">"http"</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>

<span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">SplitHostPort</span><span class="p">(</span><span class="s">":8000"</span><span class="p">)</span>
<span class="n">require</span><span class="o">.</span><span class="n">NoError</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
<span class="n">assert</span><span class="o">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="n">host</span><span class="p">)</span>
<span class="n">assert</span><span class="o">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s">"8000"</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>

<span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">net</span><span class="o">.</span><span class="n">SplitHostPort</span><span class="p">(</span><span class="s">"1:8"</span><span class="p">)</span>
<span class="n">require</span><span class="o">.</span><span class="n">NoError</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
<span class="n">assert</span><span class="o">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s">"1"</span><span class="p">,</span> <span class="n">host</span><span class="p">)</span>
<span class="n">assert</span><span class="o">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s">"8"</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// func TestSplitHostPort(t *testing.T)</span>

<span class="n">tests</span> <span class="o">:=</span> <span class="p">[]</span><span class="k">struct</span><span class="p">{</span>
  <span class="n">give</span>     <span class="kt">string</span>
  <span class="n">wantHost</span> <span class="kt">string</span>
  <span class="n">wantPort</span> <span class="kt">string</span>
<span class="p">}{</span>
  <span class="p">{</span>
    <span class="n">give</span><span class="o">:</span>     <span class="s">"192.0.2.0:8000"</span><span class="p">,</span>
    <span class="n">wantHost</span><span class="o">:</span> <span class="s">"192.0.2.0"</span><span class="p">,</span>
    <span class="n">wantPort</span><span class="o">:</span> <span class="s">"8000"</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="n">give</span><span class="o">:</span>     <span class="s">"192.0.2.0:http"</span><span class="p">,</span>
    <span class="n">wantHost</span><span class="o">:</span> <span class="s">"192.0.2.0"</span><span class="p">,</span>
    <span class="n">wantPort</span><span class="o">:</span> <span class="s">"http"</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="n">give</span><span class="o">:</span>     <span class="s">":8000"</span><span class="p">,</span>
    <span class="n">wantHost</span><span class="o">:</span> <span class="s">""</span><span class="p">,</span>
    <span class="n">wantPort</span><span class="o">:</span> <span class="s">"8000"</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="n">give</span><span class="o">:</span>     <span class="s">"1:8"</span><span class="p">,</span>
    <span class="n">wantHost</span><span class="o">:</span> <span class="s">"1"</span><span class="p">,</span>
    <span class="n">wantPort</span><span class="o">:</span> <span class="s">"8"</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">tt</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">tests</span> <span class="p">{</span>
  <span class="n">t</span><span class="o">.</span><span class="n">Run</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">give</span><span class="p">,</span> <span class="k">func</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">testing</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">net</span><span class="o">.</span><span class="n">SplitHostPort</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">give</span><span class="p">)</span>
    <span class="n">require</span><span class="o">.</span><span class="n">NoError</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
    <span class="n">assert</span><span class="o">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">wantHost</span><span class="p">,</span> <span class="n">host</span><span class="p">)</span>
    <span class="n">assert</span><span class="o">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">tt</span><span class="o">.</span><span class="n">wantPort</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å¾ˆæ˜æ˜¾ï¼Œä½¿ç”¨ test table çš„æ–¹å¼åœ¨ä»£ç é€»è¾‘æ‰©å±•çš„æ—¶å€™ï¼Œæ¯”å¦‚æ–°å¢ test caseï¼Œéƒ½ä¼šæ˜¾å¾—æ›´åŠ çš„æ¸…æ™°ã€‚</p>

<p>æˆ‘ä»¬éµå¾ªè¿™æ ·çš„çº¦å®šï¼šå°†ç»“æ„ä½“åˆ‡ç‰‡ç§°ä¸º<code class="language-plaintext highlighter-rouge">tests</code>ã€‚ æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ç§°ä¸º<code class="language-plaintext highlighter-rouge">tt</code>ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬é¼“åŠ±ä½¿ç”¨<code class="language-plaintext highlighter-rouge">give</code>å’Œ<code class="language-plaintext highlighter-rouge">want</code>å‰ç¼€è¯´æ˜æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹çš„è¾“å…¥å’Œè¾“å‡ºå€¼ã€‚</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tests</span> <span class="o">:=</span> <span class="p">[]</span><span class="k">struct</span><span class="p">{</span>
  <span class="n">give</span>     <span class="kt">string</span>
  <span class="n">wantHost</span> <span class="kt">string</span>
  <span class="n">wantPort</span> <span class="kt">string</span>
<span class="p">}{</span>
  <span class="c">// ...</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">tt</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">tests</span> <span class="p">{</span>
  <span class="c">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="åŠŸèƒ½é€‰é¡¹">åŠŸèƒ½é€‰é¡¹</h3>

<p>åŠŸèƒ½é€‰é¡¹æ˜¯ä¸€ç§æ¨¡å¼ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­å£°æ˜ä¸€ä¸ªä¸é€æ˜ Option ç±»å‹ï¼Œè¯¥ç±»å‹åœ¨æŸäº›å†…éƒ¨ç»“æ„ä¸­è®°å½•ä¿¡æ¯ã€‚æ‚¨æ¥å—è¿™äº›é€‰é¡¹çš„å¯å˜ç¼–å·ï¼Œå¹¶æ ¹æ®å†…éƒ¨ç»“æ„ä¸Šçš„é€‰é¡¹è®°å½•çš„å…¨éƒ¨ä¿¡æ¯é‡‡å–è¡ŒåŠ¨ã€‚</p>

<p>å°†æ­¤æ¨¡å¼ç”¨äºæ‚¨éœ€è¦æ‰©å±•çš„æ„é€ å‡½æ•°å’Œå…¶ä»–å…¬å…± API ä¸­çš„å¯é€‰å‚æ•°ï¼Œå°¤å…¶æ˜¯åœ¨è¿™äº›åŠŸèƒ½ä¸Šå·²ç»å…·æœ‰ä¸‰ä¸ªæˆ–æ›´å¤šå‚æ•°çš„æƒ…å†µä¸‹ã€‚</p>

<p><strong>Bad</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// package db</span>

<span class="k">func</span> <span class="n">Open</span><span class="p">(</span>
  <span class="n">addr</span> <span class="kt">string</span><span class="p">,</span>
  <span class="n">cache</span> <span class="kt">bool</span><span class="p">,</span>
  <span class="n">logger</span> <span class="o">*</span><span class="n">zap</span><span class="o">.</span><span class="n">Logger</span>
<span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">Connection</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="c">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å¿…é¡»å§‹ç»ˆæä¾›ç¼“å­˜å’Œè®°å½•å™¨å‚æ•°ï¼Œå³ä½¿ç”¨æˆ·å¸Œæœ›ä½¿ç”¨é»˜è®¤å€¼ã€‚</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">DefaultCache</span><span class="p">,</span> <span class="n">zap</span><span class="o">.</span><span class="n">NewNop</span><span class="p">())</span>
<span class="n">db</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">DefaultCache</span><span class="p">,</span> <span class="n">log</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="no">false</span> <span class="c">/* cache */</span><span class="p">,</span> <span class="n">zap</span><span class="o">.</span><span class="n">NewNop</span><span class="p">())</span>
<span class="n">db</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="no">false</span> <span class="c">/* cache */</span><span class="p">,</span> <span class="n">log</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Good</strong></p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// package db</span>

<span class="k">type</span> <span class="n">Option</span> <span class="k">interface</span> <span class="p">{</span>
  <span class="c">// ...</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">WithCache</span><span class="p">(</span><span class="n">c</span> <span class="kt">bool</span><span class="p">)</span> <span class="n">Option</span> <span class="p">{</span>
  <span class="c">// ...</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">WithLogger</span><span class="p">(</span><span class="n">log</span> <span class="o">*</span><span class="n">zap</span><span class="o">.</span><span class="n">Logger</span><span class="p">)</span> <span class="n">Option</span> <span class="p">{</span>
  <span class="c">// ...</span>
<span class="p">}</span>

<span class="c">// Open creates a connection.</span>
<span class="k">func</span> <span class="n">Open</span><span class="p">(</span>
  <span class="n">addr</span> <span class="kt">string</span><span class="p">,</span>
  <span class="n">opts</span> <span class="o">...</span><span class="n">Option</span><span class="p">,</span>
<span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">Connection</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="c">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>åªæœ‰åœ¨éœ€è¦æ—¶æ‰æä¾›é€‰é¡¹ã€‚</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">WithLogger</span><span class="p">(</span><span class="n">log</span><span class="p">))</span>
<span class="n">db</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">WithCache</span><span class="p">(</span><span class="no">false</span><span class="p">))</span>
<span class="n">db</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span>
  <span class="n">addr</span><span class="p">,</span>
  <span class="n">db</span><span class="o">.</span><span class="n">WithCache</span><span class="p">(</span><span class="no">false</span><span class="p">),</span>
  <span class="n">db</span><span class="o">.</span><span class="n">WithLogger</span><span class="p">(</span><span class="n">log</span><span class="p">),</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Our suggested way of implementing this pattern is with an <code class="language-plaintext highlighter-rouge">Option</code> interface
that holds an unexported method, recording options on an unexported <code class="language-plaintext highlighter-rouge">options</code>
struct.</p>

<p>æˆ‘ä»¬å»ºè®®å®ç°æ­¤æ¨¡å¼çš„æ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ä¸ª <code class="language-plaintext highlighter-rouge">Option</code> æ¥å£ï¼Œè¯¥æ¥å£ä¿å­˜ä¸€ä¸ªæœªå¯¼å‡ºçš„æ–¹æ³•ï¼Œåœ¨ä¸€ä¸ªæœªå¯¼å‡ºçš„ <code class="language-plaintext highlighter-rouge">options</code> ç»“æ„ä¸Šè®°å½•é€‰é¡¹ã€‚</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="n">options</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">cache</span>  <span class="kt">bool</span>
  <span class="n">logger</span> <span class="o">*</span><span class="n">zap</span><span class="o">.</span><span class="n">Logger</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">Option</span> <span class="k">interface</span> <span class="p">{</span>
  <span class="n">apply</span><span class="p">(</span><span class="o">*</span><span class="n">options</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">cacheOption</span> <span class="kt">bool</span>

<span class="k">func</span> <span class="p">(</span><span class="n">c</span> <span class="n">cacheOption</span><span class="p">)</span> <span class="n">apply</span><span class="p">(</span><span class="n">opts</span> <span class="o">*</span><span class="n">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">opts</span><span class="o">.</span><span class="n">cache</span> <span class="o">=</span> <span class="kt">bool</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">WithCache</span><span class="p">(</span><span class="n">c</span> <span class="kt">bool</span><span class="p">)</span> <span class="n">Option</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">cacheOption</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">type</span> <span class="n">loggerOption</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="n">Log</span> <span class="o">*</span><span class="n">zap</span><span class="o">.</span><span class="n">Logger</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">l</span> <span class="n">loggerOption</span><span class="p">)</span> <span class="n">apply</span><span class="p">(</span><span class="n">opts</span> <span class="o">*</span><span class="n">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">opts</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">Log</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">WithLogger</span><span class="p">(</span><span class="n">log</span> <span class="o">*</span><span class="n">zap</span><span class="o">.</span><span class="n">Logger</span><span class="p">)</span> <span class="n">Option</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">loggerOption</span><span class="p">{</span><span class="n">Log</span><span class="o">:</span> <span class="n">log</span><span class="p">}</span>
<span class="p">}</span>

<span class="c">// Open creates a connection.</span>
<span class="k">func</span> <span class="n">Open</span><span class="p">(</span>
  <span class="n">addr</span> <span class="kt">string</span><span class="p">,</span>
  <span class="n">opts</span> <span class="o">...</span><span class="n">Option</span><span class="p">,</span>
<span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">Connection</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">options</span> <span class="o">:=</span> <span class="n">options</span><span class="p">{</span>
    <span class="n">cache</span><span class="o">:</span>  <span class="n">defaultCache</span><span class="p">,</span>
    <span class="n">logger</span><span class="o">:</span> <span class="n">zap</span><span class="o">.</span><span class="n">NewNop</span><span class="p">(),</span>
  <span class="p">}</span>

  <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">o</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">opts</span> <span class="p">{</span>
    <span class="n">o</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="o">&amp;</span><span class="n">options</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="c">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æ³¨æ„: è¿˜æœ‰ä¸€ç§ä½¿ç”¨é—­åŒ…å®ç°è¿™ä¸ªæ¨¡å¼çš„æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬ç›¸ä¿¡ä¸Šé¢çš„æ¨¡å¼ä¸ºä½œè€…æä¾›äº†æ›´å¤šçš„çµæ´»æ€§ï¼Œå¹¶ä¸”æ›´å®¹æ˜“å¯¹ç”¨æˆ·è¿›è¡Œè°ƒè¯•å’Œæµ‹è¯•ã€‚ç‰¹åˆ«æ˜¯ï¼Œåœ¨ä¸å¯èƒ½è¿›è¡Œæ¯”è¾ƒçš„æƒ…å†µä¸‹å®ƒå…è®¸åœ¨æµ‹è¯•å’Œæ¨¡æ‹Ÿä¸­å¯¹é€‰é¡¹è¿›è¡Œæ¯”è¾ƒã€‚æ­¤å¤–ï¼Œå®ƒè¿˜å…è®¸é€‰é¡¹å®ç°å…¶ä»–æ¥å£ï¼ŒåŒ…æ‹¬ <code class="language-plaintext highlighter-rouge">fmt.Stringer</code>ï¼Œå…è®¸ç”¨æˆ·è¯»å–é€‰é¡¹çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚</p>

<p>è¿˜å¯ä»¥å‚è€ƒä¸‹é¢èµ„æ–™ï¼š</p>

<ul>
  <li><a href="https://commandcenter.blogspot.com/2014/01/self-referential-functions-and-design.html">Self-referential functions and the design of options</a></li>
  <li>
    <p><a href="https://dave.cheney.net/2014/10/17/functional-options-for-friendly-apis">Functional options for friendly APIs</a></p>

  </li>
</ul>

<!-- TODO: replace this with parameter structs and functional options, when to
use one vs other -->

<h2 id="stargazers-over-time">Stargazers over time</h2>

<p><a href="https://starchart.cc/xxjwxc/uber_go_guide_cn"><img src="https://starchart.cc/xxjwxc/uber_go_guide_cn.svg" alt="Stargazers over time" /></a></p>

<h3 id="å¼•ç”¨">å¼•ç”¨</h3>

<ul>
  <li>[1] <a href="https://github.com/xxjwxc/uber_go_guide_cn">Uber Go è¯­è¨€ç¼–ç è§„èŒƒä¸­æ–‡ç‰ˆ. The Uber Go Style Guide</a></li>
</ul>
:ET