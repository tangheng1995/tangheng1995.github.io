I"{Î<ul id="markdown-toc">
  <li><a href="#ä»‹ç»" id="markdown-toc-ä»‹ç»">ä»‹ç»</a></li>
  <li><a href="#golangå †æ ˆ" id="markdown-toc-golangå †æ ˆ">Golangå †æ ˆ</a>    <ul>
      <li><a href="#ä»€ä¹ˆæ˜¯å †æ ˆ" id="markdown-toc-ä»€ä¹ˆæ˜¯å †æ ˆ">ä»€ä¹ˆæ˜¯å †æ ˆ</a>        <ul>
          <li><a href="#æ•°æ®ç»“æ„çš„å †æ ˆ" id="markdown-toc-æ•°æ®ç»“æ„çš„å †æ ˆ">æ•°æ®ç»“æ„çš„å †æ ˆ</a></li>
          <li><a href="#å†…å­˜åˆ†é…ä¸­çš„å †å’Œæ ˆ" id="markdown-toc-å†…å­˜åˆ†é…ä¸­çš„å †å’Œæ ˆ">å†…å­˜åˆ†é…ä¸­çš„å †å’Œæ ˆ</a></li>
        </ul>
      </li>
      <li><a href="#å †æ ˆç¼“å­˜æ–¹å¼" id="markdown-toc-å †æ ˆç¼“å­˜æ–¹å¼">å †æ ˆç¼“å­˜æ–¹å¼</a></li>
      <li><a href="#å †æ ˆè·Ÿè¸ª" id="markdown-toc-å †æ ˆè·Ÿè¸ª">å †æ ˆè·Ÿè¸ª</a>        <ul>
          <li><a href="#methods" id="markdown-toc-methods">Methods</a></li>
          <li><a href="#packing" id="markdown-toc-packing">Packing</a></li>
        </ul>
      </li>
      <li><a href="#å˜é‡æ˜¯å †heapè¿˜æ˜¯å †æ ˆstack" id="markdown-toc-å˜é‡æ˜¯å †heapè¿˜æ˜¯å †æ ˆstack">å˜é‡æ˜¯å †ï¼ˆheapï¼‰è¿˜æ˜¯å †æ ˆï¼ˆstackï¼‰</a></li>
      <li><a href="#å¼•ç”¨" id="markdown-toc-å¼•ç”¨">å¼•ç”¨</a></li>
    </ul>
  </li>
</ul>

<h2 id="ä»‹ç»">ä»‹ç»</h2>

<p>Golangå †æ ˆã€‚</p>

<h2 id="golangå †æ ˆ">Golangå †æ ˆ</h2>

<h3 id="ä»€ä¹ˆæ˜¯å †æ ˆ">ä»€ä¹ˆæ˜¯å †æ ˆ</h3>

<p>åœ¨è®¡ç®—æœºä¸­å †æ ˆçš„æ¦‚å¿µåˆ†ä¸ºï¼šæ•°æ®ç»“æ„çš„å †æ ˆå’Œå†…å­˜åˆ†é…ä¸­å †æ ˆã€‚</p>

<h4 id="æ•°æ®ç»“æ„çš„å †æ ˆ">æ•°æ®ç»“æ„çš„å †æ ˆ</h4>

<p>å †ï¼šå †å¯ä»¥è¢«çœ‹æˆæ˜¯ä¸€æ£µæ ‘ï¼Œå¦‚ï¼šå †æ’åºã€‚åœ¨é˜Ÿåˆ—ä¸­ï¼Œè°ƒåº¦ç¨‹åºåå¤æå–é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªä½œä¸šå¹¶è¿è¡Œï¼Œå› ä¸ºå®é™…æƒ…å†µä¸­æŸäº›æ—¶é—´è¾ƒçŸ­çš„ä»»åŠ¡å°†ç­‰å¾…å¾ˆé•¿æ—¶é—´æ‰èƒ½ç»“æŸï¼Œæˆ–è€…æŸäº›ä¸çŸ­å°ï¼Œä½†å…·æœ‰é‡è¦æ€§çš„ä½œä¸šï¼ŒåŒæ ·åº”å½“å…·æœ‰ä¼˜å…ˆæƒã€‚å †å³ä¸ºè§£å†³æ­¤ç±»é—®é¢˜è®¾è®¡çš„ä¸€ç§æ•°æ®ç»“æ„ã€‚</p>

<p>æ ˆï¼šä¸€ç§å…ˆè¿›åå‡ºçš„æ•°æ®ç»“æ„ã€‚</p>

<p>è¿™é‡Œç€é‡è®²çš„æ˜¯å†…å­˜åˆ†é…ä¸­çš„å †å’Œæ ˆã€‚</p>

<h4 id="å†…å­˜åˆ†é…ä¸­çš„å †å’Œæ ˆ">å†…å­˜åˆ†é…ä¸­çš„å †å’Œæ ˆ</h4>

<p>æ ˆï¼ˆæ“ä½œç³»ç»Ÿï¼‰ï¼šç”±æ“ä½œç³»ç»Ÿè‡ªåŠ¨åˆ†é…é‡Šæ”¾ ï¼Œå­˜æ”¾å‡½æ•°çš„å‚æ•°å€¼ï¼Œå±€éƒ¨å˜é‡çš„å€¼ç­‰ã€‚å…¶æ“ä½œæ–¹å¼ç±»ä¼¼äºæ•°æ®ç»“æ„ä¸­çš„æ ˆã€‚</p>

<p>å †ï¼ˆæ“ä½œç³»ç»Ÿï¼‰ï¼š ä¸€èˆ¬ç”±ç¨‹åºå‘˜åˆ†é…é‡Šæ”¾ï¼Œ è‹¥ç¨‹åºå‘˜ä¸é‡Šæ”¾ï¼Œç¨‹åºç»“æŸæ—¶å¯èƒ½ç”±OSå›æ”¶ï¼Œåˆ†é…æ–¹å¼å€’æ˜¯ç±»ä¼¼äºé“¾è¡¨ã€‚</p>

<h3 id="å †æ ˆç¼“å­˜æ–¹å¼">å †æ ˆç¼“å­˜æ–¹å¼</h3>

<p>æ ˆä½¿ç”¨çš„æ˜¯ä¸€çº§ç¼“å­˜ï¼Œ ä»–ä»¬é€šå¸¸éƒ½æ˜¯è¢«è°ƒç”¨æ—¶å¤„äºå­˜å‚¨ç©ºé—´ä¸­ï¼Œè°ƒç”¨å®Œæ¯•ç«‹å³é‡Šæ”¾ã€‚</p>

<p>å †åˆ™æ˜¯å­˜æ”¾åœ¨äºŒçº§ç¼“å­˜ä¸­ï¼Œç”Ÿå‘½å‘¨æœŸç”±è™šæ‹Ÿæœºçš„åƒåœ¾å›æ”¶ç®—æ³•æ¥å†³å®šï¼ˆå¹¶ä¸æ˜¯ä¸€æ—¦æˆä¸ºå­¤å„¿å¯¹è±¡å°±èƒ½è¢«å›æ”¶ï¼‰ã€‚æ‰€ä»¥è°ƒç”¨è¿™äº›å¯¹è±¡çš„é€Ÿåº¦è¦ç›¸å¯¹æ¥å¾—ä½ä¸€äº›ã€‚</p>

<h3 id="å †æ ˆè·Ÿè¸ª">å †æ ˆè·Ÿè¸ª</h3>

<p>ä¸‹é¢è®¨è®ºå †æ ˆè·Ÿè¸ªä¿¡æ¯ä»¥åŠå¦‚ä½•åœ¨å †æ ˆä¸­è¯†åˆ«å‡½æ•°æ‰€ä¼ é€’çš„å‚æ•°ã€‚</p>

<p>ä»¥ä¸‹æµ‹è¯•æ¡ˆä¾‹çš„ç‰ˆæœ¬æ˜¯Go 1.11</p>

<p>ç¤ºä¾‹ï¼š</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="s">"runtime/debug"</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="n">slice</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">string</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">)</span>
   <span class="n">Example</span><span class="p">(</span><span class="n">slice</span><span class="p">,</span> <span class="s">"hello"</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">func</span> <span class="n">Example</span><span class="p">(</span><span class="n">slice</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="n">str</span> <span class="kt">string</span><span class="p">,</span> <span class="n">i</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">debug</span><span class="o">.</span><span class="n">PrintStack</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>åˆ—è¡¨1æ˜¯ä¸€ä¸ªç®€å•çš„ç¨‹åºï¼Œ mainå‡½æ•°åœ¨ç¬¬5è¡Œè°ƒç”¨Exampleå‡½æ•°ã€‚Exampleå‡½æ•°åœ¨ç¬¬9è¡Œå£°æ˜ï¼Œå®ƒæœ‰ä¸‰ä¸ªå‚æ•°ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²slice,ä¸€ä¸ªå­—ç¬¦ä¸²å’Œä¸€ä¸ªæ•´æ•°ã€‚å®ƒçš„æ–¹æ³•ä½“ä¹Ÿå¾ˆç®€å•ï¼Œåªæœ‰ä¸€è¡Œï¼Œdebug.PrintStackï¼ˆï¼‰ï¼Œè¿™ä¼šç«‹å³äº§ç”Ÿä¸€ä¸ªå †æ ˆè·Ÿè¸ªä¿¡æ¯:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">goroutine</span> <span class="m">1</span> <span class="p">[</span><span class="n">running</span><span class="p">]</span><span class="o">:</span>
<span class="n">runtime</span><span class="o">/</span><span class="n">debug</span><span class="o">.</span><span class="n">Stack</span><span class="p">(</span><span class="m">0x1</span><span class="p">,</span> <span class="m">0x0</span><span class="p">,</span> <span class="m">0x0</span><span class="p">)</span>
    <span class="n">C</span><span class="o">:/</span><span class="n">Go</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">stack</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">24</span> <span class="o">+</span><span class="m">0xae</span>
<span class="n">runtime</span><span class="o">/</span><span class="n">debug</span><span class="o">.</span><span class="n">PrintStack</span><span class="p">()</span>
    <span class="n">C</span><span class="o">:/</span><span class="n">Go</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">stack</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">16</span> <span class="o">+</span><span class="m">0x29</span>
<span class="n">main</span><span class="o">.</span><span class="n">Example</span><span class="p">(</span><span class="m">0xc000077f48</span><span class="p">,</span> <span class="m">0x2</span><span class="p">,</span> <span class="m">0x4</span><span class="p">,</span> <span class="m">0x4abd9e</span><span class="p">,</span> <span class="m">0x5</span><span class="p">,</span> <span class="m">0xa</span><span class="p">)</span>
    <span class="n">D</span><span class="o">:/</span><span class="n">gopath</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">example</span><span class="o">/</span><span class="n">example</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">10</span> <span class="o">+</span><span class="m">0x27</span>
<span class="n">main</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
    <span class="n">D</span><span class="o">:/</span><span class="n">gopath</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">example</span><span class="o">/</span><span class="n">example</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">7</span> <span class="o">+</span><span class="m">0x79</span>
</code></pre></div></div>

<p>å †æ ˆè·Ÿè¸ªä¿¡æ¯ï¼š</p>

<p>ç¬¬ä¸€è¡Œæ˜¾ç¤ºè¿è¡Œçš„goroutineæ˜¯idä¸º 1çš„goroutineã€‚</p>

<p>ç¬¬äºŒè¡Œ debug.Stack()è¢«è°ƒç”¨</p>

<p>ç¬¬å››è¡Œ debug.PrintStack() è¢«è°ƒç”¨</p>

<p>ç¬¬å…­è¡Œ è°ƒç”¨debug.PrintStack()çš„ä»£ç ä½ç½®ï¼Œä½äºmain packageä¸‹çš„Exampleå‡½æ•°ã€‚å®ƒä¹Ÿæ˜¾ç¤ºäº†ä»£ç æ‰€åœ¨çš„æ–‡ä»¶å’Œè·¯å¾„ï¼Œä»¥åŠdebug.PrintStack()å‘ç”Ÿçš„è¡Œæ•°(ç¬¬10è¡Œ)ã€‚</p>

<p>ç¬¬å…«è¡Œ ä¹Ÿè°ƒç”¨Exampleçš„å‡½æ•°çš„åå­—ï¼Œå®ƒæ˜¯main packageçš„mainå‡½æ•°ã€‚å®ƒä¹Ÿæ˜¾ç¤ºäº†æ–‡ä»¶åå’Œè·¯å¾„ï¼Œä»¥åŠè°ƒç”¨Exampleå‡½æ•°çš„è¡Œæ•°ã€‚</p>

<p>ä¸‹é¢ä¸»è¦åˆ†æ ä¼ é€’Exampleå‡½æ•°ä¼ å‚ä¿¡æ¯</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// Declaration</span>
<span class="n">main</span><span class="o">.</span><span class="n">Example</span><span class="p">(</span><span class="n">slice</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="n">str</span> <span class="kt">string</span><span class="p">,</span> <span class="n">i</span> <span class="kt">int</span><span class="p">)</span>
<span class="c">// Call to Example by main.</span>
<span class="n">slice</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">string</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">)</span>
<span class="n">Example</span><span class="p">(</span><span class="n">slice</span><span class="p">,</span> <span class="s">"hello"</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
<span class="c">// Stack trace</span>
<span class="n">main</span><span class="o">.</span><span class="n">Example</span><span class="p">(</span><span class="m">0x2080c3f50</span><span class="p">,</span> <span class="m">0x2</span><span class="p">,</span> <span class="m">0x4</span><span class="p">,</span> <span class="m">0x425c0</span><span class="p">,</span> <span class="m">0x5</span><span class="p">,</span> <span class="m">0xa</span><span class="p">)</span>
</code></pre></div></div>

<p>ä¸Šé¢åˆ—ä¸¾äº†Exampleå‡½æ•°çš„å£°æ˜ï¼Œè°ƒç”¨ä»¥åŠä¼ é€’ç»™å®ƒçš„å€¼çš„ä¿¡æ¯ã€‚å½“ä½ æ¯”è¾ƒå‡½æ•°çš„å£°æ˜ä»¥åŠä¼ é€’çš„å€¼æ—¶ï¼Œå‘ç°å®ƒä»¬å¹¶ä¸ä¸€è‡´ã€‚å‡½æ•°å£°æ˜åªæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œè€Œå †æ ˆä¸­å´æ˜¾ç¤º6ä¸ª16è¿›åˆ¶è¡¨ç¤ºçš„å€¼ã€‚ç†è§£è¿™ä¸€ç‚¹çš„å…³é”®æ˜¯è¦çŸ¥é“æ¯ä¸ªå‚æ•°ç±»å‹çš„å®ç°æœºåˆ¶ã€‚</p>

<p>è®©æˆ‘ä»¬çœ‹ç¬¬ä¸€ä¸ª[]stringç±»å‹çš„å‚æ•°ã€‚sliceæ˜¯å¼•ç”¨ç±»å‹ï¼Œè¿™æ„å‘³ç€é‚£ä¸ªå€¼æ˜¯ä¸€ä¸ªæŒ‡é’ˆçš„å¤´ä¿¡æ¯(header value)ï¼Œå®ƒæŒ‡å‘ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚å¯¹äºslice,å®ƒçš„å¤´æ˜¯ä¸‰ä¸ªwordæ•°ï¼ŒæŒ‡å‘ä¸€ä¸ªæ•°ç»„ã€‚å› æ­¤å‰ä¸‰ä¸ªå€¼ä»£è¡¨è¿™ä¸ªsliceã€‚</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// Slice parameter value</span>
<span class="n">slice</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">string</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">)</span>
<span class="c">// Slice header values</span>
<span class="n">Pointer</span><span class="o">:</span>  <span class="m">0xc00006df48</span>
<span class="n">Length</span><span class="o">:</span>   <span class="m">0x2</span>
<span class="n">Capacity</span><span class="o">:</span> <span class="m">0x4</span>
<span class="c">// Declaration</span>
<span class="n">main</span><span class="o">.</span><span class="n">Example</span><span class="p">(</span><span class="n">slice</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="n">str</span> <span class="kt">string</span><span class="p">,</span> <span class="n">i</span> <span class="kt">int</span><span class="p">)</span>
<span class="c">// Stack trace</span>
<span class="n">main</span><span class="o">.</span><span class="n">Example</span><span class="p">(</span><span class="m">0xc00006df48</span><span class="p">,</span> <span class="m">0x2</span><span class="p">,</span> <span class="m">0x4</span><span class="p">,</span> <span class="m">0x4abd9e</span><span class="p">,</span> <span class="m">0x5</span><span class="p">,</span> <span class="m">0xa</span><span class="p">)</span>
</code></pre></div></div>

<p>æ˜¾ç¤ºäº†0xc00006df48ä»£è¡¨ç¬¬ä¸€ä¸ªå‚æ•°[]stringçš„æŒ‡é’ˆï¼Œ0x2ä»£è¡¨sliceé•¿åº¦ï¼Œ0x4ä»£è¡¨å®¹é‡ã€‚è¿™ä¸‰ä¸ªå€¼ä»£è¡¨ç¬¬ä¸€ä¸ªå‚æ•°ã€‚</p>

<p><img src="/assets/images/2019/2019-10-04-1.png" alt="å›¾ä¸€" /></p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// String parameter value</span>
<span class="err">â€œ</span><span class="n">hello</span><span class="err">â€</span>
<span class="c">// String header values</span>
<span class="n">Pointer</span><span class="o">:</span> <span class="m">0x4abd9e</span>
<span class="n">Length</span><span class="o">:</span>  <span class="m">0x5</span>
<span class="c">// Declaration</span>
<span class="n">main</span><span class="o">.</span><span class="n">Example</span><span class="p">(</span><span class="n">slice</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="n">str</span> <span class="kt">string</span><span class="p">,</span> <span class="n">i</span> <span class="kt">int</span><span class="p">)</span>
<span class="c">// Stack trace</span>
<span class="n">main</span><span class="o">.</span><span class="n">Example</span><span class="p">(</span><span class="m">0xc00006df48</span><span class="p">,</span> <span class="m">0x2</span><span class="p">,</span> <span class="m">0x4</span><span class="p">,</span> <span class="m">0x4abd9e</span><span class="p">,</span> <span class="m">0x5</span><span class="p">,</span> <span class="m">0xa</span><span class="p">)</span>
</code></pre></div></div>

<p>æ˜¾ç¤ºå †æ ˆè·Ÿè¸ªä¿¡æ¯ä¸­çš„ç¬¬4ä¸ªå’Œç¬¬5ä¸ªå‚æ•°ä»£è¡¨å­—ç¬¦ä¸²çš„å‚æ•°ã€‚0x4abd9eæ˜¯æŒ‡å‘è¿™ä¸ªå­—ç¬¦ä¸²åº•å±‚æ•°ç»„çš„æŒ‡é’ˆï¼Œ0x5æ˜¯â€helloâ€å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œä»–ä»¬ä¿©ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚</p>

<p><img src="/assets/images/2019/2019-10-04-2.png" alt="å›¾äºŒ" /></p>

<p>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œå®ƒæ˜¯ä¸€ä¸ªç®€å•çš„wordå€¼</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// Integer parameter value</span>
<span class="m">10</span>
<span class="c">// Integer value</span>
<span class="n">Base</span> <span class="m">16</span><span class="o">:</span> <span class="m">0xa</span>
<span class="c">// Declaration</span>
<span class="n">main</span><span class="o">.</span><span class="n">Example</span><span class="p">(</span><span class="n">slice</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="n">str</span> <span class="kt">string</span><span class="p">,</span> <span class="n">i</span> <span class="kt">int</span><span class="p">)</span>
<span class="c">// Stack trace</span>
<span class="n">main</span><span class="o">.</span><span class="n">Example</span><span class="p">(</span><span class="m">0xc00006df48</span><span class="p">,</span> <span class="m">0x2</span><span class="p">,</span> <span class="m">0x4</span><span class="p">,</span> <span class="m">0x4abd9e</span><span class="p">,</span> <span class="m">0x5</span><span class="p">,</span> <span class="m">0xa</span><span class="p">)</span>
</code></pre></div></div>

<p>æ˜¾ç¤ºå †æ ˆä¸­çš„æœ€åä¸€ä¸ªå‚æ•°å°±æ˜¯Exampleå£°æ˜ä¸­çš„ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå®ƒçš„å€¼æ˜¯0xaï¼Œä¹Ÿå°±æ˜¯æ•´æ•°10ã€‚</p>

<p><img src="/assets/images/2019/2019-10-04-3.png" alt="å›¾ä¸‰" /></p>

<h4 id="methods">Methods</h4>

<p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬ç¨å¾®æ”¹åŠ¨ä¸€ä¸‹ç¨‹åºï¼Œè®©Exampleå˜æˆæ–¹æ³•ã€‚</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
   <span class="s">"fmt"</span>
   <span class="s">"runtime/debug"</span>
<span class="p">)</span>

<span class="k">type</span> <span class="n">trace</span> <span class="k">struct</span><span class="p">{}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="n">slice</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">string</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">4</span><span class="p">)</span>
   <span class="k">var</span> <span class="n">t</span> <span class="n">trace</span>
   <span class="n">t</span><span class="o">.</span><span class="n">Example</span><span class="p">(</span><span class="n">slice</span><span class="p">,</span> <span class="s">"hello"</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">func</span> <span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">trace</span><span class="p">)</span> <span class="n">Example</span><span class="p">(</span><span class="n">slice</span> <span class="p">[]</span><span class="kt">string</span><span class="p">,</span> <span class="n">str</span> <span class="kt">string</span><span class="p">,</span> <span class="n">i</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"Receiver Address: %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
   <span class="n">debug</span><span class="o">.</span><span class="n">PrintStack</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ä¸Šä¾‹åœ¨ç¬¬8è¡Œæ–°å¢åŠ äº†ä¸€ä¸ªç±»å‹traceï¼Œåœ¨ç¬¬15å°†exampleæ”¹å˜ä¸ºtraceçš„pointer receiverçš„ä¸€ä¸ªæ–¹æ³•ã€‚ç¬¬12è¡Œå£°æ˜tçš„ç±»å‹ä¸ºtraceï¼Œç¬¬13è¡Œè°ƒç”¨å®ƒçš„æ–¹æ³•ã€‚</p>

<p>å› ä¸ºè¿™ä¸ªæ–¹æ³•å£°æ˜ä¸ºpointer receiverçš„æ–¹æ³•ï¼ŒGoä½¿ç”¨tçš„æŒ‡é’ˆæ¥æ”¯æŒreceiver typeï¼Œå³ä½¿ä»£ç ä¸­ä½¿ç”¨å€¼æ¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚å½“ç¨‹åºè¿è¡Œæ—¶ï¼Œå †æ ˆè·Ÿè¸ªä¿¡æ¯å¦‚ä¸‹ï¼š</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Receiver</span> <span class="n">Address</span><span class="o">:</span> <span class="m">0x5781c8</span>
<span class="n">goroutine</span> <span class="m">1</span> <span class="p">[</span><span class="n">running</span><span class="p">]</span><span class="o">:</span>
<span class="n">runtime</span><span class="o">/</span><span class="n">debug</span><span class="o">.</span><span class="n">Stack</span><span class="p">(</span><span class="m">0x15</span><span class="p">,</span> <span class="m">0xc000071ef0</span><span class="p">,</span> <span class="m">0x1</span><span class="p">)</span>
    <span class="n">C</span><span class="o">:/</span><span class="n">Go</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">stack</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">24</span> <span class="o">+</span><span class="m">0xae</span>
<span class="n">runtime</span><span class="o">/</span><span class="n">debug</span><span class="o">.</span><span class="n">PrintStack</span><span class="p">()</span>
    <span class="n">C</span><span class="o">:/</span><span class="n">Go</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">stack</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">16</span> <span class="o">+</span><span class="m">0x29</span>
<span class="n">main</span><span class="o">.</span><span class="p">(</span><span class="o">*</span><span class="n">trace</span><span class="p">)</span><span class="o">.</span><span class="n">Example</span><span class="p">(</span><span class="m">0x5781c8</span><span class="p">,</span> <span class="m">0xc000071f48</span><span class="p">,</span> <span class="m">0x2</span><span class="p">,</span> <span class="m">0x4</span><span class="p">,</span> <span class="m">0x4c04bb</span><span class="p">,</span> <span class="m">0x5</span><span class="p">,</span> <span class="m">0xa</span><span class="p">)</span>
    <span class="n">D</span><span class="o">:/</span><span class="n">gopath</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">example</span><span class="o">/</span><span class="n">example</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">17</span> <span class="o">+</span><span class="m">0x7c</span>
<span class="n">main</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
    <span class="n">D</span><span class="o">:/</span><span class="n">gopath</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">example</span><span class="o">/</span><span class="n">example</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">13</span> <span class="o">+</span><span class="m">0x9a</span>
</code></pre></div></div>

<p>ç¬¬7è¡Œæ¸…æ™°çš„è¡¨æ˜æ–¹æ³•çš„receiverä¸ºpointer typeã€‚æ–¹æ³•åå’ŒæŠ¥åŒ…åä¸­é—´æœ‰(*trace)ã€‚ç¬¬äºŒä¸ªå€¼å¾—æ³¨æ„çš„æ˜¯å †æ ˆä¿¡æ¯ä¸­æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºreceiverçš„å€¼ã€‚æ–¹æ³•è°ƒç”¨æ€»æ˜¯è½¬æ¢æˆå‡½æ•°è°ƒç”¨ï¼Œå¹¶å°†receiverçš„å€¼ä½œä¸ºå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚æˆ‘ä»¬å¯ä»¥æ€»å †æ ˆä¿¡æ¯ä¸­çœ‹åˆ°å®ç°çš„ç»†èŠ‚ã€‚</p>

<h4 id="packing">Packing</h4>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">(</span>
   <span class="s">"runtime/debug"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="n">Example</span><span class="p">(</span><span class="no">true</span><span class="p">,</span> <span class="no">false</span><span class="p">,</span> <span class="no">true</span><span class="p">,</span> <span class="m">25</span><span class="p">)</span>
<span class="p">}</span>
<span class="k">func</span> <span class="n">Example</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">b3</span> <span class="kt">bool</span><span class="p">,</span> <span class="n">i</span> <span class="kt">uint8</span><span class="p">)</span> <span class="p">{</span>

   <span class="n">debug</span><span class="o">.</span><span class="n">PrintStack</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å†æ¬¡æ”¹å˜Exampleçš„æ–¹æ³•ï¼Œè®©å®ƒæ¥æ”¶4ä¸ªå‚æ•°ã€‚å‰ä¸‰ä¸ªå‚æ•°æ˜¯å¸ƒå°”ç±»å‹çš„ï¼Œç¬¬å››ä¸ªå‚æ•°æ˜¯8bitæ— ç¬¦å·æ•´æ•°ã€‚å¸ƒå°”ç±»å‹ä¹Ÿæ˜¯8bitè¡¨ç¤ºçš„ï¼Œæ‰€ä»¥è¿™å››ä¸ªå‚æ•°å¯ä»¥è¢«æ‰“åŒ…æˆä¸€ä¸ªwordï¼ŒåŒ…æ‹¬32ä½æ¶æ„å’Œ64ä½æ¶æ„ã€‚å½“ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œä¼šäº§ç”Ÿæœ‰è¶£çš„å †æ ˆï¼š</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">goroutine</span> <span class="m">1</span> <span class="p">[</span><span class="n">running</span><span class="p">]</span><span class="o">:</span>
<span class="n">runtime</span><span class="o">/</span><span class="n">debug</span><span class="o">.</span><span class="n">Stack</span><span class="p">(</span><span class="m">0x4</span><span class="p">,</span> <span class="m">0xc00007a010</span><span class="p">,</span> <span class="m">0xc000077f88</span><span class="p">)</span>
    <span class="n">C</span><span class="o">:/</span><span class="n">Go</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">stack</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">24</span> <span class="o">+</span><span class="m">0xae</span>
<span class="n">runtime</span><span class="o">/</span><span class="n">debug</span><span class="o">.</span><span class="n">PrintStack</span><span class="p">()</span>
    <span class="n">C</span><span class="o">:/</span><span class="n">Go</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">runtime</span><span class="o">/</span><span class="n">debug</span><span class="o">/</span><span class="n">stack</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">16</span> <span class="o">+</span><span class="m">0x29</span>
<span class="n">main</span><span class="o">.</span><span class="n">Example</span><span class="p">(</span><span class="m">0xc019010001</span><span class="p">)</span>
    <span class="n">D</span><span class="o">:/</span><span class="n">gopath</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">example</span><span class="o">/</span><span class="n">example</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">12</span> <span class="o">+</span><span class="m">0x27</span>
<span class="n">main</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
    <span class="n">D</span><span class="o">:/</span><span class="n">gopath</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">example</span><span class="o">/</span><span class="n">example</span><span class="o">/</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">8</span> <span class="o">+</span><span class="m">0x30</span>
</code></pre></div></div>

<p>å¯ä»¥çœ‹åˆ°å››ä¸ªå€¼è¢«æ‰“åŒ…æˆä¸€ä¸ªå•ä¸€çš„å€¼äº†0xc019010001</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// Parameter values</span>
<span class="no">true</span><span class="p">,</span> <span class="no">false</span><span class="p">,</span> <span class="no">true</span><span class="p">,</span> <span class="m">25</span>

<span class="c">// Word value</span>
<span class="n">Bits</span>    <span class="n">Binary</span>      <span class="n">Hex</span>   <span class="n">Value</span>
<span class="m">00</span><span class="o">-</span><span class="m">07</span>   <span class="m">0000</span> <span class="m">0001</span>   <span class="m">01</span>    <span class="no">true</span>
<span class="m">08</span><span class="o">-</span><span class="m">15</span>   <span class="m">0000</span> <span class="m">0000</span>   <span class="m">00</span>    <span class="no">false</span>
<span class="m">16</span><span class="o">-</span><span class="m">23</span>   <span class="m">0000</span> <span class="m">0001</span>   <span class="m">01</span>    <span class="no">true</span>
<span class="m">24</span><span class="o">-</span><span class="m">31</span>   <span class="m">0001</span> <span class="m">1001</span>   <span class="m">19</span>    <span class="m">25</span>

<span class="c">// Declaration</span>
<span class="n">main</span><span class="o">.</span><span class="n">Example</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">b3</span> <span class="kt">bool</span><span class="p">,</span> <span class="n">i</span> <span class="kt">uint8</span><span class="p">)</span>

<span class="c">// Stack trace</span>
<span class="n">main</span><span class="o">.</span><span class="n">Example</span><span class="p">(</span><span class="m">0x19010001</span><span class="p">)</span>
</code></pre></div></div>

<p>æ˜¾ç¤ºäº†å †æ ˆçš„å€¼å¦‚ä½•å’Œå‚æ•°è¿›è¡ŒåŒ¹é…çš„ã€‚trueç”¨1è¡¨ç¤ºï¼Œå 8bit, falseç”¨0è¡¨ç¤ºï¼Œå 8bit,uint8å€¼25çš„16è¿›åˆ¶ä¸ºx19,ç”¨8bitè¡¨ç¤ºã€‚æˆ‘ä»¬è¯¾å“Ÿçœ‹åˆ°å®ƒä»¬æ˜¯å¦‚ä½•è¡¨ç¤ºæˆä¸€ä¸ªwordå€¼çš„ã€‚</p>

<p>Goè¿è¡Œæ—¶æä¾›äº†è¯¦ç»†çš„ä¿¡æ¯æ¥å¸®åŠ©æˆ‘ä»¬è°ƒè¯•ç¨‹åºã€‚é€šè¿‡å †æ ˆè·Ÿè¸ªä¿¡æ¯stack traceï¼Œè§£ç ä¼ é€’ä¸ªå †æ ˆä¸­çš„æ–¹æ³•çš„å‚æ•°æœ‰åŠ©äºæˆ‘ä»¬å¿«é€Ÿå®šä½BUGã€‚</p>

<h3 id="å˜é‡æ˜¯å †heapè¿˜æ˜¯å †æ ˆstack">å˜é‡æ˜¯å †ï¼ˆheapï¼‰è¿˜æ˜¯å †æ ˆï¼ˆstackï¼‰</h3>

<p>Goä¸­çš„æ¯ä¸ªå˜é‡éƒ½å­˜åœ¨ï¼Œåªè¦æœ‰å¯¹å®ƒçš„å¼•ç”¨å³å¯ã€‚å®ç°é€‰æ‹©çš„å­˜å‚¨ä½ç½®ä¸è¯­è¨€çš„è¯­ä¹‰æ— å…³ã€‚</p>

<p>å­˜å‚¨ä½ç½®ç¡®å®ä¼šå½±å“ç¼–å†™é«˜æ•ˆçš„ç¨‹åºã€‚å¦‚æœå¯èƒ½ï¼ŒGoç¼–è¯‘å™¨å°†ä¸ºè¯¥å‡½æ•°çš„å †æ ˆå¸§ä¸­çš„å‡½æ•°åˆ†é…æœ¬åœ°å˜é‡ã€‚ä½†æ˜¯ï¼Œå¦‚æœç¼–è¯‘å™¨åœ¨å‡½æ•°è¿”å›åæ— æ³•è¯æ˜å˜é‡æœªè¢«å¼•ç”¨ï¼Œåˆ™ç¼–è¯‘å™¨å¿…é¡»åœ¨åƒåœ¾æ”¶é›†å †ä¸Šåˆ†é…å˜é‡ä»¥é¿å…æ‚¬ç©ºæŒ‡é’ˆé”™è¯¯ã€‚æ­¤å¤–ï¼Œå¦‚æœå±€éƒ¨å˜é‡éå¸¸å¤§ï¼Œå°†å®ƒå­˜å‚¨åœ¨å †è€Œä¸æ˜¯å †æ ˆä¸Šå¯èƒ½æ›´æœ‰æ„ä¹‰ã€‚</p>

<p>åœ¨å½“å‰çš„ç¼–è¯‘å™¨ä¸­ï¼Œå¦‚æœå˜é‡å…·æœ‰å…¶åœ°å€ï¼Œåˆ™è¯¥å˜é‡æ˜¯å †ä¸Šåˆ†é…çš„å€™é€‰å˜é‡ã€‚ä½†æ˜¯ï¼ŒåŸºç¡€çš„é€ƒé€¸åˆ†æå¯ä»¥å°†é‚£äº›ç”Ÿå­˜ä¸è¶…è¿‡å‡½æ•°è¿”å›å€¼çš„å˜é‡è¯†åˆ«å‡ºæ¥ï¼Œå¹¶ä¸”å› æ­¤å¯ä»¥åˆ†é…åœ¨æ ˆä¸Šã€‚</p>

<p>Goçš„ç¼–è¯‘å™¨ä¼šå†³å®šåœ¨å“ª(å †oræ ˆ)åˆ†é…å†…å­˜ï¼Œä¿è¯ç¨‹åºçš„æ­£ç¡®æ€§ã€‚</p>

<p>ä¸‹é¢é€šè¿‡åæ±‡ç¼–æŸ¥çœ‹å…·ä½“å†…å­˜åˆ†é…æƒ…å†µï¼š</p>

<p>æ–°å»º main.go</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="s">"fmt"</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="k">var</span> <span class="n">a</span> <span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="kt">int</span>
   <span class="n">c</span> <span class="o">:=</span> <span class="n">a</span><span class="p">[</span><span class="o">:</span><span class="p">]</span>
   <span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>æŸ¥çœ‹æ±‡ç¼–ä»£ç </p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">go</span> <span class="n">tool</span> <span class="n">compile</span> <span class="o">-</span><span class="n">S</span> <span class="n">main</span><span class="o">.</span><span class="k">go</span>
</code></pre></div></div>

<p>è¾“å‡ºï¼š</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">localhost</span> <span class="n">example</span><span class="p">]</span><span class="err">#</span> <span class="k">go</span> <span class="n">tool</span> <span class="n">compile</span> <span class="o">-</span><span class="n">S</span> <span class="n">main</span><span class="o">.</span><span class="k">go</span>
<span class="s">""</span><span class="o">.</span><span class="n">main</span> <span class="n">STEXT</span> <span class="n">size</span><span class="o">=</span><span class="m">183</span> <span class="n">args</span><span class="o">=</span><span class="m">0x0</span> <span class="n">locals</span><span class="o">=</span><span class="m">0x60</span>
    <span class="m">0x0000</span> <span class="m">00000</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">5</span><span class="p">)</span>    <span class="n">TEXT</span>    <span class="s">""</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">SB</span><span class="p">),</span> <span class="err">$</span><span class="m">96</span><span class="o">-</span><span class="m">0</span>
    <span class="m">0x0000</span> <span class="m">00000</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">5</span><span class="p">)</span>    <span class="n">MOVQ</span>    <span class="p">(</span><span class="n">TLS</span><span class="p">),</span> <span class="n">CX</span>
    <span class="m">0x0009</span> <span class="m">00009</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">5</span><span class="p">)</span>    <span class="n">CMPQ</span>    <span class="n">SP</span><span class="p">,</span> <span class="m">16</span><span class="p">(</span><span class="n">CX</span><span class="p">)</span>
    <span class="m">0x000d</span> <span class="m">00013</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">5</span><span class="p">)</span>    <span class="n">JLS</span>    <span class="m">173</span>
    <span class="m">0x0013</span> <span class="m">00019</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">5</span><span class="p">)</span>    <span class="n">SUBQ</span>    <span class="err">$</span><span class="m">96</span><span class="p">,</span> <span class="n">SP</span>
    <span class="m">0x0017</span> <span class="m">00023</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">5</span><span class="p">)</span>    <span class="n">MOVQ</span>    <span class="n">BP</span><span class="p">,</span> <span class="m">88</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span>
    <span class="m">0x001c</span> <span class="m">00028</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">5</span><span class="p">)</span>    <span class="n">LEAQ</span>    <span class="m">88</span><span class="p">(</span><span class="n">SP</span><span class="p">),</span> <span class="n">BP</span>
    <span class="m">0x0021</span> <span class="m">00033</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">5</span><span class="p">)</span>    <span class="n">FUNCDATA</span>    <span class="err">$</span><span class="m">0</span><span class="p">,</span> <span class="n">gclocals</span><span class="err">Â·</span><span class="n">f6bd6b3389b872033d462029172c8612</span><span class="p">(</span><span class="n">SB</span><span class="p">)</span>
    <span class="m">0x0021</span> <span class="m">00033</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">5</span><span class="p">)</span>    <span class="n">FUNCDATA</span>    <span class="err">$</span><span class="m">1</span><span class="p">,</span> <span class="n">gclocals</span><span class="err">Â·</span><span class="m">3</span><span class="n">ea58e42e2dc6c51a9f33c0d03361a27</span><span class="p">(</span><span class="n">SB</span><span class="p">)</span>
    <span class="m">0x0021</span> <span class="m">00033</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">5</span><span class="p">)</span>    <span class="n">FUNCDATA</span>    <span class="err">$</span><span class="m">3</span><span class="p">,</span> <span class="n">gclocals</span><span class="err">Â·</span><span class="m">9</span><span class="n">fb7f0986f647f17cb53dda1484e0f7a</span><span class="p">(</span><span class="n">SB</span><span class="p">)</span>
    <span class="m">0x0021</span> <span class="m">00033</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">6</span><span class="p">)</span>    <span class="n">PCDATA</span>    <span class="err">$</span><span class="m">2</span><span class="p">,</span> <span class="err">$</span><span class="m">1</span>
    <span class="m">0x0021</span> <span class="m">00033</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">6</span><span class="p">)</span>    <span class="n">PCDATA</span>    <span class="err">$</span><span class="m">0</span><span class="p">,</span> <span class="err">$</span><span class="m">0</span>
    <span class="m">0x0021</span> <span class="m">00033</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">6</span><span class="p">)</span>    <span class="n">LEAQ</span>    <span class="k">type</span><span class="o">.</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="kt">int</span><span class="p">(</span><span class="n">SB</span><span class="p">),</span> <span class="n">AX</span>
    <span class="m">0x0028</span> <span class="m">00040</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">6</span><span class="p">)</span>    <span class="n">PCDATA</span>    <span class="err">$</span><span class="m">2</span><span class="p">,</span> <span class="err">$</span><span class="m">0</span>
    <span class="m">0x0028</span> <span class="m">00040</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">6</span><span class="p">)</span>    <span class="n">MOVQ</span>    <span class="n">AX</span><span class="p">,</span> <span class="p">(</span><span class="n">SP</span><span class="p">)</span>
    <span class="m">0x002c</span> <span class="m">00044</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">6</span><span class="p">)</span>    <span class="n">CALL</span>    <span class="n">runtime</span><span class="o">.</span><span class="n">newobject</span><span class="p">(</span><span class="n">SB</span><span class="p">)</span>
    <span class="m">0x0031</span> <span class="m">00049</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">6</span><span class="p">)</span>    <span class="n">PCDATA</span>    <span class="err">$</span><span class="m">2</span><span class="p">,</span> <span class="err">$</span><span class="m">1</span>
    <span class="m">0x0031</span> <span class="m">00049</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">6</span><span class="p">)</span>    <span class="n">MOVQ</span>    <span class="m">8</span><span class="p">(</span><span class="n">SP</span><span class="p">),</span> <span class="n">AX</span>
    <span class="m">0x0036</span> <span class="m">00054</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">8</span><span class="p">)</span>    <span class="n">PCDATA</span>    <span class="err">$</span><span class="m">2</span><span class="p">,</span> <span class="err">$</span><span class="m">0</span>
    <span class="m">0x0036</span> <span class="m">00054</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">8</span><span class="p">)</span>    <span class="n">PCDATA</span>    <span class="err">$</span><span class="m">0</span><span class="p">,</span> <span class="err">$</span><span class="m">1</span>
    <span class="m">0x0036</span> <span class="m">00054</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">8</span><span class="p">)</span>    <span class="n">MOVQ</span>    <span class="n">AX</span><span class="p">,</span> <span class="s">""</span><span class="o">..</span><span class="n">autotmp_4</span><span class="o">+</span><span class="m">64</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span>
</code></pre></div></div>

<p>æ³¨æ„åˆ°æœ‰è°ƒç”¨newobjectï¼å…¶ä¸­main.go:6è¯´æ˜å˜é‡açš„å†…å­˜æ˜¯åœ¨å †ä¸Šåˆ†é…çš„!</p>

<p>ä¿®æ”¹main.go</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="k">var</span> <span class="n">a</span> <span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="kt">int</span>
   <span class="n">c</span> <span class="o">:=</span> <span class="n">a</span><span class="p">[</span><span class="o">:</span><span class="p">]</span>
   <span class="nb">println</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<p>å†æŸ¥çœ‹æ±‡ç¼–ä»£ç </p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">localhost</span> <span class="n">example</span><span class="p">]</span><span class="err">#</span> <span class="k">go</span> <span class="n">tool</span> <span class="n">compile</span> <span class="o">-</span><span class="n">S</span> <span class="n">main</span><span class="o">.</span><span class="k">go</span>
<span class="err">\</span><span class="s">""</span><span class="o">.</span><span class="n">main</span> <span class="n">STEXT</span> <span class="n">size</span><span class="o">=</span><span class="m">102</span> <span class="n">args</span><span class="o">=</span><span class="m">0x0</span> <span class="n">locals</span><span class="o">=</span><span class="m">0x28</span>
    <span class="m">0x0000</span> <span class="m">00000</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">3</span><span class="p">)</span>    <span class="n">TEXT</span>    <span class="s">""</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="n">SB</span><span class="p">),</span> <span class="err">$</span><span class="m">40</span><span class="o">-</span><span class="m">0</span>
    <span class="m">0x0000</span> <span class="m">00000</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">3</span><span class="p">)</span>    <span class="n">MOVQ</span>    <span class="p">(</span><span class="n">TLS</span><span class="p">),</span> <span class="n">CX</span>
    <span class="m">0x0009</span> <span class="m">00009</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">3</span><span class="p">)</span>    <span class="n">CMPQ</span>    <span class="n">SP</span><span class="p">,</span> <span class="m">16</span><span class="p">(</span><span class="n">CX</span><span class="p">)</span>
    <span class="m">0x000d</span> <span class="m">00013</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">3</span><span class="p">)</span>    <span class="n">JLS</span>    <span class="m">95</span>
    <span class="m">0x000f</span> <span class="m">00015</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">3</span><span class="p">)</span>    <span class="n">SUBQ</span>    <span class="err">$</span><span class="m">40</span><span class="p">,</span> <span class="n">SP</span>
    <span class="m">0x0013</span> <span class="m">00019</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">3</span><span class="p">)</span>    <span class="n">MOVQ</span>    <span class="n">BP</span><span class="p">,</span> <span class="m">32</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span>
    <span class="m">0x0018</span> <span class="m">00024</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">3</span><span class="p">)</span>    <span class="n">LEAQ</span>    <span class="m">32</span><span class="p">(</span><span class="n">SP</span><span class="p">),</span> <span class="n">BP</span>
    <span class="m">0x001d</span> <span class="m">00029</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">3</span><span class="p">)</span>    <span class="n">FUNCDATA</span>    <span class="err">$</span><span class="m">0</span><span class="p">,</span> <span class="n">gclocals</span><span class="err">Â·</span><span class="m">33</span><span class="n">cdeccccebe80329f1fdbee7f5874cb</span><span class="p">(</span><span class="n">SB</span><span class="p">)</span>
    <span class="m">0x001d</span> <span class="m">00029</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">3</span><span class="p">)</span>    <span class="n">FUNCDATA</span>    <span class="err">$</span><span class="m">1</span><span class="p">,</span> <span class="n">gclocals</span><span class="err">Â·</span><span class="m">33</span><span class="n">cdeccccebe80329f1fdbee7f5874cb</span><span class="p">(</span><span class="n">SB</span><span class="p">)</span>
    <span class="m">0x001d</span> <span class="m">00029</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">3</span><span class="p">)</span>    <span class="n">FUNCDATA</span>    <span class="err">$</span><span class="m">3</span><span class="p">,</span> <span class="n">gclocals</span><span class="err">Â·</span><span class="m">9</span><span class="n">fb7f0986f647f17cb53dda1484e0f7a</span><span class="p">(</span><span class="n">SB</span><span class="p">)</span>
    <span class="m">0x001d</span> <span class="m">00029</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">4</span><span class="p">)</span>    <span class="n">PCDATA</span>    <span class="err">$</span><span class="m">2</span><span class="p">,</span> <span class="err">$</span><span class="m">0</span>
    <span class="m">0x001d</span> <span class="m">00029</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">4</span><span class="p">)</span>    <span class="n">PCDATA</span>    <span class="err">$</span><span class="m">0</span><span class="p">,</span> <span class="err">$</span><span class="m">0</span>
    <span class="m">0x001d</span> <span class="m">00029</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">4</span><span class="p">)</span>    <span class="n">MOVQ</span>    <span class="err">$</span><span class="m">0</span><span class="p">,</span> <span class="s">""</span><span class="o">.</span><span class="n">a</span><span class="o">+</span><span class="m">24</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span>
    <span class="m">0x0026</span> <span class="m">00038</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">6</span><span class="p">)</span>    <span class="n">CALL</span>    <span class="n">runtime</span><span class="o">.</span><span class="n">printlock</span><span class="p">(</span><span class="n">SB</span><span class="p">)</span>
    <span class="m">0x002b</span> <span class="m">00043</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">6</span><span class="p">)</span>    <span class="n">PCDATA</span>    <span class="err">$</span><span class="m">2</span><span class="p">,</span> <span class="err">$</span><span class="m">1</span>
    <span class="m">0x002b</span> <span class="m">00043</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">6</span><span class="p">)</span>    <span class="n">LEAQ</span>    <span class="s">""</span><span class="o">.</span><span class="n">a</span><span class="o">+</span><span class="m">24</span><span class="p">(</span><span class="n">SP</span><span class="p">),</span> <span class="n">AX</span>
    <span class="m">0x0030</span> <span class="m">00048</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">6</span><span class="p">)</span>    <span class="n">PCDATA</span>    <span class="err">$</span><span class="m">2</span><span class="p">,</span> <span class="err">$</span><span class="m">0</span>
    <span class="m">0x0030</span> <span class="m">00048</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">6</span><span class="p">)</span>    <span class="n">MOVQ</span>    <span class="n">AX</span><span class="p">,</span> <span class="p">(</span><span class="n">SP</span><span class="p">)</span>
    <span class="m">0x0034</span> <span class="m">00052</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">6</span><span class="p">)</span>    <span class="n">MOVQ</span>    <span class="err">$</span><span class="m">1</span><span class="p">,</span> <span class="m">8</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span>
    <span class="m">0x003d</span> <span class="m">00061</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">6</span><span class="p">)</span>    <span class="n">MOVQ</span>    <span class="err">$</span><span class="m">1</span><span class="p">,</span> <span class="m">16</span><span class="p">(</span><span class="n">SP</span><span class="p">)</span>
    <span class="m">0x0046</span> <span class="m">00070</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">6</span><span class="p">)</span>    <span class="n">CALL</span>    <span class="n">runtime</span><span class="o">.</span><span class="n">printslice</span><span class="p">(</span><span class="n">SB</span><span class="p">)</span>
    <span class="m">0x004b</span> <span class="m">00075</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">6</span><span class="p">)</span>    <span class="n">CALL</span>    <span class="n">runtime</span><span class="o">.</span><span class="n">printnl</span><span class="p">(</span><span class="n">SB</span><span class="p">)</span>
    <span class="m">0x0050</span> <span class="m">00080</span> <span class="p">(</span><span class="n">main</span><span class="o">.</span><span class="k">go</span><span class="o">:</span><span class="m">6</span><span class="p">)</span>    <span class="n">CALL</span>    <span class="n">runtime</span><span class="o">.</span><span class="n">printunlock</span><span class="p">(</span><span class="n">SB</span><span class="p">)</span>
</code></pre></div></div>

<p>æ²¡æœ‰å‘ç°è°ƒç”¨newobjectï¼Œè¿™æ®µä»£ç aæ˜¯åœ¨å †æ ˆä¸Šåˆ†é…çš„ã€‚</p>

<p>ç»“è®ºï¼š</p>

<p>Go ç¼–è¯‘å™¨è‡ªè¡Œå†³å®šå˜é‡åˆ†é…åœ¨å †æ ˆæˆ–å †ä¸Šï¼Œä»¥ä¿è¯ç¨‹åºçš„æ­£ç¡®æ€§ã€‚</p>

<h3 id="å¼•ç”¨">å¼•ç”¨</h3>

<ul>
  <li>[1] <a href="https://www.ardanlabs.com/blog/2015/01/stack-traces-in-go.html">Stack Traces In Go</a></li>
  <li>[2] <a href="https://segmentfault.com/a/1190000017498101">Goå †æ ˆçš„ç†è§£</a></li>
</ul>
:ET