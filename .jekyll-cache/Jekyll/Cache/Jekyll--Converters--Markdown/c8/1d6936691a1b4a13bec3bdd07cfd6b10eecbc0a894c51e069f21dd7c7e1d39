I"/<ul id="markdown-toc">
  <li><a href="#ä»‹ç»" id="markdown-toc-ä»‹ç»">ä»‹ç»</a></li>
  <li><a href="#ubuntu-å®‰è£…-nginxé…ç½®sslåŠ å¯†" id="markdown-toc-ubuntu-å®‰è£…-nginxé…ç½®sslåŠ å¯†">Ubuntu å®‰è£… nginxï¼Œé…ç½®SSLåŠ å¯†</a>    <ul>
      <li><a href="#å®‰è£…nginx" id="markdown-toc-å®‰è£…nginx">å®‰è£…nginx</a></li>
      <li><a href="#ä¿®æ”¹nginxé…ç½®æ–‡ä»¶" id="markdown-toc-ä¿®æ”¹nginxé…ç½®æ–‡ä»¶">ä¿®æ”¹nginxé…ç½®æ–‡ä»¶</a></li>
      <li><a href="#é…ç½®sslè¯ä¹¦" id="markdown-toc-é…ç½®sslè¯ä¹¦">é…ç½®SSLè¯ä¹¦</a>        <ul>
          <li><a href="#æ·»åŠ -certbot-ppa" id="markdown-toc-æ·»åŠ -certbot-ppa">æ·»åŠ  Certbot PPA</a></li>
          <li><a href="#å®‰è£…certbot" id="markdown-toc-å®‰è£…certbot">å®‰è£…Certbot</a></li>
          <li><a href="#é€‰æ‹©è·å–è¯ä¹¦è¿˜æ˜¯å®‰è£…è¯ä¹¦" id="markdown-toc-é€‰æ‹©è·å–è¯ä¹¦è¿˜æ˜¯å®‰è£…è¯ä¹¦">é€‰æ‹©è·å–è¯ä¹¦è¿˜æ˜¯å®‰è£…è¯ä¹¦</a></li>
          <li><a href="#éªŒè¯è‡ªåŠ¨æ›´æ–°è¯ä¹¦" id="markdown-toc-éªŒè¯è‡ªåŠ¨æ›´æ–°è¯ä¹¦">éªŒè¯è‡ªåŠ¨æ›´æ–°è¯ä¹¦</a></li>
          <li><a href="#éªŒè¯ä½ çš„ç½‘ç«™æ˜¯å¦ç”Ÿæ•ˆ" id="markdown-toc-éªŒè¯ä½ çš„ç½‘ç«™æ˜¯å¦ç”Ÿæ•ˆ">éªŒè¯ä½ çš„ç½‘ç«™æ˜¯å¦ç”Ÿæ•ˆ</a></li>
        </ul>
      </li>
      <li><a href="#æŸ¥çœ‹è¢«certbotä¿®æ”¹åçš„nginxé…ç½®æ–‡ä»¶" id="markdown-toc-æŸ¥çœ‹è¢«certbotä¿®æ”¹åçš„nginxé…ç½®æ–‡ä»¶">æŸ¥çœ‹è¢«Certbotä¿®æ”¹åçš„nginxé…ç½®æ–‡ä»¶</a></li>
      <li><a href="#å¼•ç”¨" id="markdown-toc-å¼•ç”¨">å¼•ç”¨</a></li>
    </ul>
  </li>
</ul>

<h2 id="ä»‹ç»">ä»‹ç»</h2>

<p>Ubuntu å®‰è£… nginxï¼Œé…ç½®SSLåŠ å¯†ã€‚</p>

<h2 id="ubuntu-å®‰è£…-nginxé…ç½®sslåŠ å¯†">Ubuntu å®‰è£… nginxï¼Œé…ç½®SSLåŠ å¯†</h2>

<h3 id="å®‰è£…nginx">å®‰è£…nginx</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get nginx
</code></pre></div></div>

<h3 id="ä¿®æ”¹nginxé…ç½®æ–‡ä»¶">ä¿®æ”¹nginxé…ç½®æ–‡ä»¶</h3>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># è¿›å…¥ `/etc/nginx/sites-enabled` ç›®å½•ï¼Œå¯æŸ¥çœ‹nginxé…ç½®æ–‡ä»¶ `default -&gt; /etc/nginx/sites-available/default`
# åˆ›å»ºæ–°é…ç½®æ–‡ä»¶ go.conf
</span><span class="n">server</span> {
        <span class="n">listen</span>       <span class="m">80</span>;
        <span class="n">server_name</span>  <span class="n">blog</span>.<span class="n">heygolang</span>.<span class="n">cn</span>;
        <span class="n">location</span> / {
                <span class="n">proxy_pass</span> <span class="n">https</span>://<span class="n">tangheng1995</span>.<span class="n">github</span>.<span class="n">io</span>/;
        }
  <span class="n">location</span> /<span class="n">admin</span> {
                <span class="n">proxy_pass</span> <span class="n">http</span>://<span class="m">127</span>.<span class="m">0</span>.<span class="m">0</span>.<span class="m">1</span>:<span class="m">9000</span>;
        }
        <span class="n">error_page</span> <span class="m">404</span> /<span class="m">404</span>.<span class="n">html</span>;
            <span class="n">location</span> = /<span class="m">40</span><span class="n">x</span>.<span class="n">html</span> {
        }
    }
<span class="n">server</span> {
        <span class="n">listen</span>       <span class="m">80</span>;
        <span class="n">server_name</span>  <span class="n">admin</span>.<span class="n">heygolang</span>.<span class="n">cn</span>;
  <span class="n">location</span> / {
                <span class="n">proxy_pass</span> <span class="n">http</span>://<span class="m">127</span>.<span class="m">0</span>.<span class="m">0</span>.<span class="m">1</span>:<span class="m">9000</span>;
        }
        <span class="n">error_page</span> <span class="m">404</span> /<span class="m">404</span>.<span class="n">html</span>;
            <span class="n">location</span> = /<span class="m">40</span><span class="n">x</span>.<span class="n">html</span> {
        }
    }
</code></pre></div></div>

<h3 id="é…ç½®sslè¯ä¹¦">é…ç½®SSLè¯ä¹¦</h3>

<blockquote>
  <p>æœ¬æ¬¡é€‰ç”¨çš„SSLè¯ä¹¦æ˜¯ç”± <a href="https://letsencrypt.org/">Letâ€™s Encrypt</a> æä¾›çš„ï¼Œæœ¬æ¬¡ç³»ç»ŸåŠç¯å¢ƒä¸º Ubuntu 18.04 å’Œ nginx
é…ç½®è¯¦æƒ…é¡µä¸º <a href="https://certbot.eff.org/lets-encrypt/ubuntubionic-nginx">certbot instructions</a></p>
</blockquote>

<h4 id="æ·»åŠ -certbot-ppa">æ·»åŠ  Certbot PPA</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get update
<span class="nb">sudo </span>apt-get <span class="nb">install </span>software-properties-common
<span class="nb">sudo </span>add-apt-repository universe
<span class="nb">sudo </span>add-apt-repository ppa:certbot/certbot
<span class="nb">sudo </span>apt-get update
</code></pre></div></div>

<h4 id="å®‰è£…certbot">å®‰è£…Certbot</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get <span class="nb">install </span>certbot python-certbot-nginx
</code></pre></div></div>

<h4 id="é€‰æ‹©è·å–è¯ä¹¦è¿˜æ˜¯å®‰è£…è¯ä¹¦">é€‰æ‹©è·å–è¯ä¹¦è¿˜æ˜¯å®‰è£…è¯ä¹¦</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># å®‰è£…è¯ä¹¦</span>
<span class="nb">sudo </span>certbot <span class="nt">--nginx</span>
<span class="c"># è·å–è¯ä¹¦</span>
<span class="nb">sudo </span>certbot certonly <span class="nt">--nginx</span>
</code></pre></div></div>

<h4 id="éªŒè¯è‡ªåŠ¨æ›´æ–°è¯ä¹¦">éªŒè¯è‡ªåŠ¨æ›´æ–°è¯ä¹¦</h4>

<blockquote>
  <p>Certbot ä¼šåœ¨è¯ä¹¦è¿‡æœŸå‰è‡ªåŠ¨æ›´æ–°è¯ä¹¦ï¼Œé™¤éä½ ä¿®æ”¹äº†é…ç½®</p>
</blockquote>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># éªŒè¯è‡ªåŠ¨æ›´æ–°è¯ä¹¦</span>
<span class="nb">sudo </span>certbot renew <span class="nt">--dry-run</span>
</code></pre></div></div>

<p>æ­¤å‘½ä»¤ä¼šæ›´æ–°ä»¥ä¸‹ç›®å½•ä¸‹å®‰è£…çš„é…ç½®ï¼š</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/etc/crontab/
/etc/cron.<span class="k">*</span>/<span class="k">*</span>
systemctl list-timers
</code></pre></div></div>

<h4 id="éªŒè¯ä½ çš„ç½‘ç«™æ˜¯å¦ç”Ÿæ•ˆ">éªŒè¯ä½ çš„ç½‘ç«™æ˜¯å¦ç”Ÿæ•ˆ</h4>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://yourwebsite.com/
</code></pre></div></div>

<h3 id="æŸ¥çœ‹è¢«certbotä¿®æ”¹åçš„nginxé…ç½®æ–‡ä»¶">æŸ¥çœ‹è¢«Certbotä¿®æ”¹åçš„nginxé…ç½®æ–‡ä»¶</h3>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">server</span> {
        <span class="n">server_name</span>  <span class="n">blog</span>.<span class="n">heygolang</span>.<span class="n">cn</span>;
        <span class="n">location</span> / {
                <span class="n">proxy_pass</span> <span class="n">https</span>://<span class="n">tangheng1995</span>.<span class="n">github</span>.<span class="n">io</span>/;
        }
        <span class="n">error_page</span> <span class="m">404</span> /<span class="m">404</span>.<span class="n">html</span>;
            <span class="n">location</span> = /<span class="m">40</span><span class="n">x</span>.<span class="n">html</span> {
        }
    <span class="n">listen</span> <span class="m">443</span> <span class="n">ssl</span>; <span class="c"># managed by Certbot
</span>    <span class="n">ssl_certificate</span> /<span class="n">etc</span>/<span class="n">letsencrypt</span>/<span class="n">live</span>/<span class="n">admin</span>.<span class="n">heygolang</span>.<span class="n">cn</span>/<span class="n">fullchain</span>.<span class="n">pem</span>; <span class="c"># managed by Certbot
</span>    <span class="n">ssl_certificate_key</span> /<span class="n">etc</span>/<span class="n">letsencrypt</span>/<span class="n">live</span>/<span class="n">admin</span>.<span class="n">heygolang</span>.<span class="n">cn</span>/<span class="n">privkey</span>.<span class="n">pem</span>; <span class="c"># managed by Certbot
</span>    <span class="n">include</span> /<span class="n">etc</span>/<span class="n">letsencrypt</span>/<span class="n">options</span>-<span class="n">ssl</span>-<span class="n">nginx</span>.<span class="n">conf</span>; <span class="c"># managed by Certbot
</span>    <span class="n">ssl_dhparam</span> /<span class="n">etc</span>/<span class="n">letsencrypt</span>/<span class="n">ssl</span>-<span class="n">dhparams</span>.<span class="n">pem</span>; <span class="c"># managed by Certbot
</span>}
<span class="n">server</span> {
        <span class="n">server_name</span>  <span class="n">admin</span>.<span class="n">heygolang</span>.<span class="n">cn</span>;
        <span class="n">location</span> / {
                <span class="n">proxy_pass</span> <span class="n">http</span>://<span class="m">127</span>.<span class="m">0</span>.<span class="m">0</span>.<span class="m">1</span>:<span class="m">9000</span>;
        }
        <span class="n">error_page</span> <span class="m">404</span> /<span class="m">404</span>.<span class="n">html</span>;
            <span class="n">location</span> = /<span class="m">40</span><span class="n">x</span>.<span class="n">html</span> {
        }
    <span class="n">listen</span> <span class="m">443</span> <span class="n">ssl</span>; <span class="c"># managed by Certbot
</span>    <span class="n">ssl_certificate</span> /<span class="n">etc</span>/<span class="n">letsencrypt</span>/<span class="n">live</span>/<span class="n">admin</span>.<span class="n">heygolang</span>.<span class="n">cn</span>/<span class="n">fullchain</span>.<span class="n">pem</span>; <span class="c"># managed by Certbot
</span>    <span class="n">ssl_certificate_key</span> /<span class="n">etc</span>/<span class="n">letsencrypt</span>/<span class="n">live</span>/<span class="n">admin</span>.<span class="n">heygolang</span>.<span class="n">cn</span>/<span class="n">privkey</span>.<span class="n">pem</span>; <span class="c"># managed by Certbot
</span>    <span class="n">include</span> /<span class="n">etc</span>/<span class="n">letsencrypt</span>/<span class="n">options</span>-<span class="n">ssl</span>-<span class="n">nginx</span>.<span class="n">conf</span>; <span class="c"># managed by Certbot
</span>    <span class="n">ssl_dhparam</span> /<span class="n">etc</span>/<span class="n">letsencrypt</span>/<span class="n">ssl</span>-<span class="n">dhparams</span>.<span class="n">pem</span>; <span class="c"># managed by Certbot
</span>
}
<span class="n">server</span> {
    <span class="n">if</span> ($<span class="n">host</span> = <span class="n">admin</span>.<span class="n">heygolang</span>.<span class="n">cn</span>) {
        <span class="n">return</span> <span class="m">301</span> <span class="n">https</span>://$<span class="n">host</span>$<span class="n">request_uri</span>;
    } <span class="c"># managed by Certbot
</span>        <span class="n">listen</span>       <span class="m">80</span>;
        <span class="n">server_name</span>  <span class="n">admin</span>.<span class="n">heygolang</span>.<span class="n">cn</span>;
    <span class="n">return</span> <span class="m">404</span>; <span class="c"># managed by Certbot
</span>}<span class="n">server</span> {
    <span class="n">if</span> ($<span class="n">host</span> = <span class="n">blog</span>.<span class="n">heygolang</span>.<span class="n">cn</span>) {
        <span class="n">return</span> <span class="m">301</span> <span class="n">https</span>://$<span class="n">host</span>$<span class="n">request_uri</span>;
    } <span class="c"># managed by Certbot
</span>        <span class="n">listen</span>       <span class="m">80</span>;
        <span class="n">server_name</span>  <span class="n">blog</span>.<span class="n">heygolang</span>.<span class="n">cn</span>;
    <span class="n">return</span> <span class="m">404</span>; <span class="c"># managed by Certbot
</span>}
</code></pre></div></div>

<h3 id="å¼•ç”¨">å¼•ç”¨</h3>

<ul>
  <li>[1] <a href="https://caddyserver.com/">Caddy</a>, å¯ä»¥è‡ªåŠ¨ç»™httpåŠ å¯†æˆhttps</li>
</ul>
:ET